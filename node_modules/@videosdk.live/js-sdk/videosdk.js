/*! For license information please see videosdk.js.LICENSE.txt */
!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var a in r)("object"==typeof exports?exports:e)[a]=r[a]}}(window,(function(){return function(e){var t={};function r(a){if(t[a])return t[a].exports;var n=t[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(a,n,function(t){return e[t]}.bind(null,n));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=86)}([function(e,t,r){e.exports=r(51)},function(e,t){function r(e,t,r,a,n,i,s){try{var o=e[i](s),c=o.value}catch(e){return void r(e)}o.done?t(c):Promise.resolve(c).then(a,n)}e.exports=function(e){return function(){var t=this,a=arguments;return new Promise((function(n,i){var s=e.apply(t,a);function o(e){r(s,n,i,o,c,"next",e)}function c(e){r(s,n,i,o,c,"throw",e)}o(void 0)}))}},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t){e.exports=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t){function r(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}e.exports=function(e,t,a){return t&&r(e.prototype,t),a&&r(e,a),e},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=void 0;const n=a(r(12)),i="mediasoup-client";t.Logger=class{constructor(e){e?(this._debug=n.default(`${i}:${e}`),this._warn=n.default(`${i}:WARN:${e}`),this._error=n.default(`${i}:ERROR:${e}`)):(this._debug=n.default(i),this._warn=n.default(`${i}:WARN`),this._error=n.default(`${i}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateRandomNumber=t.clone=void 0,t.clone=function(e,t){return void 0===e?t:JSON.parse(JSON.stringify(e))},t.generateRandomNumber=function(){return Math.round(1e7*Math.random())}},function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.hasOwnProperty.call(e,r)&&a(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.canReceive=t.canSend=t.generateProbatorRtpParameters=t.reduceCodecs=t.getSendingRemoteRtpParameters=t.getSendingRtpParameters=t.getRecvRtpCapabilities=t.getExtendedRtpCapabilities=t.validateSctpStreamParameters=t.validateSctpParameters=t.validateNumSctpStreams=t.validateSctpCapabilities=t.validateRtcpParameters=t.validateRtpEncodingParameters=t.validateRtpHeaderExtensionParameters=t.validateRtpCodecParameters=t.validateRtpParameters=t.validateRtpHeaderExtension=t.validateRtcpFeedback=t.validateRtpCodecCapability=t.validateRtpCapabilities=void 0;const s=i(r(64)),o=i(r(6));function c(e){const t=new RegExp("^(audio|video)/(.+)","i");if("object"!=typeof e)throw new TypeError("codec is not an object");if(!e.mimeType||"string"!=typeof e.mimeType)throw new TypeError("missing codec.mimeType");const r=t.exec(e.mimeType);if(!r)throw new TypeError("invalid codec.mimeType");if(e.kind=r[1].toLowerCase(),e.preferredPayloadType&&"number"!=typeof e.preferredPayloadType)throw new TypeError("invalid codec.preferredPayloadType");if("number"!=typeof e.clockRate)throw new TypeError("missing codec.clockRate");"audio"===e.kind?"number"!=typeof e.channels&&(e.channels=1):delete e.channels,e.parameters&&"object"==typeof e.parameters||(e.parameters={});for(const t of Object.keys(e.parameters)){let r=e.parameters[t];if(void 0===r&&(e.parameters[t]="",r=""),"string"!=typeof r&&"number"!=typeof r)throw new TypeError(`invalid codec parameter [key:${t}s, value:${r}]`);if("apt"===t&&"number"!=typeof r)throw new TypeError("invalid codec apt parameter")}e.rtcpFeedback&&Array.isArray(e.rtcpFeedback)||(e.rtcpFeedback=[]);for(const t of e.rtcpFeedback)d(t)}function d(e){if("object"!=typeof e)throw new TypeError("fb is not an object");if(!e.type||"string"!=typeof e.type)throw new TypeError("missing fb.type");e.parameter&&"string"==typeof e.parameter||(e.parameter="")}function p(e){if("object"!=typeof e)throw new TypeError("ext is not an object");if("audio"!==e.kind&&"video"!==e.kind)throw new TypeError("invalid ext.kind");if(!e.uri||"string"!=typeof e.uri)throw new TypeError("missing ext.uri");if("number"!=typeof e.preferredId)throw new TypeError("missing ext.preferredId");if(e.preferredEncrypt&&"boolean"!=typeof e.preferredEncrypt)throw new TypeError("invalid ext.preferredEncrypt");if(e.preferredEncrypt||(e.preferredEncrypt=!1),e.direction&&"string"!=typeof e.direction)throw new TypeError("invalid ext.direction");e.direction||(e.direction="sendrecv")}function u(e){if("object"!=typeof e)throw new TypeError("params is not an object");if(e.mid&&"string"!=typeof e.mid)throw new TypeError("params.mid is not a string");if(!Array.isArray(e.codecs))throw new TypeError("missing params.codecs");for(const t of e.codecs)l(t);if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("params.headerExtensions is not an array");e.headerExtensions||(e.headerExtensions=[]);for(const t of e.headerExtensions)h(t);if(e.encodings&&!Array.isArray(e.encodings))throw new TypeError("params.encodings is not an array");e.encodings||(e.encodings=[]);for(const t of e.encodings)m(t);if(e.rtcp&&"object"!=typeof e.rtcp)throw new TypeError("params.rtcp is not an object");e.rtcp||(e.rtcp={}),f(e.rtcp)}function l(e){const t=new RegExp("^(audio|video)/(.+)","i");if("object"!=typeof e)throw new TypeError("codec is not an object");if(!e.mimeType||"string"!=typeof e.mimeType)throw new TypeError("missing codec.mimeType");const r=t.exec(e.mimeType);if(!r)throw new TypeError("invalid codec.mimeType");if("number"!=typeof e.payloadType)throw new TypeError("missing codec.payloadType");if("number"!=typeof e.clockRate)throw new TypeError("missing codec.clockRate");"audio"===r[1].toLowerCase()?"number"!=typeof e.channels&&(e.channels=1):delete e.channels,e.parameters&&"object"==typeof e.parameters||(e.parameters={});for(const t of Object.keys(e.parameters)){let r=e.parameters[t];if(void 0===r&&(e.parameters[t]="",r=""),"string"!=typeof r&&"number"!=typeof r)throw new TypeError(`invalid codec parameter [key:${t}s, value:${r}]`);if("apt"===t&&"number"!=typeof r)throw new TypeError("invalid codec apt parameter")}e.rtcpFeedback&&Array.isArray(e.rtcpFeedback)||(e.rtcpFeedback=[]);for(const t of e.rtcpFeedback)d(t)}function h(e){if("object"!=typeof e)throw new TypeError("ext is not an object");if(!e.uri||"string"!=typeof e.uri)throw new TypeError("missing ext.uri");if("number"!=typeof e.id)throw new TypeError("missing ext.id");if(e.encrypt&&"boolean"!=typeof e.encrypt)throw new TypeError("invalid ext.encrypt");e.encrypt||(e.encrypt=!1),e.parameters&&"object"==typeof e.parameters||(e.parameters={});for(const t of Object.keys(e.parameters)){let r=e.parameters[t];if(void 0===r&&(e.parameters[t]="",r=""),"string"!=typeof r&&"number"!=typeof r)throw new TypeError("invalid header extension parameter")}}function m(e){if("object"!=typeof e)throw new TypeError("encoding is not an object");if(e.ssrc&&"number"!=typeof e.ssrc)throw new TypeError("invalid encoding.ssrc");if(e.rid&&"string"!=typeof e.rid)throw new TypeError("invalid encoding.rid");if(e.rtx&&"object"!=typeof e.rtx)throw new TypeError("invalid encoding.rtx");if(e.rtx&&"number"!=typeof e.rtx.ssrc)throw new TypeError("missing encoding.rtx.ssrc");if(e.dtx&&"boolean"==typeof e.dtx||(e.dtx=!1),e.scalabilityMode&&"string"!=typeof e.scalabilityMode)throw new TypeError("invalid encoding.scalabilityMode")}function f(e){if("object"!=typeof e)throw new TypeError("rtcp is not an object");if(e.cname&&"string"!=typeof e.cname)throw new TypeError("invalid rtcp.cname");e.reducedSize&&"boolean"==typeof e.reducedSize||(e.reducedSize=!0)}function g(e){if("object"!=typeof e)throw new TypeError("numStreams is not an object");if("number"!=typeof e.OS)throw new TypeError("missing numStreams.OS");if("number"!=typeof e.MIS)throw new TypeError("missing numStreams.MIS")}function _(e){return!!e&&/.+\/rtx$/i.test(e.mimeType)}function v(e,t,{strict:r=!1,modify:a=!1}={}){const n=e.mimeType.toLowerCase();if(n!==t.mimeType.toLowerCase())return!1;if(e.clockRate!==t.clockRate)return!1;if(e.channels!==t.channels)return!1;switch(n){case"video/h264":if((e.parameters["packetization-mode"]||0)!==(t.parameters["packetization-mode"]||0))return!1;if(r){if(!s.isSameProfile(e.parameters,t.parameters))return!1;let r;try{r=s.generateProfileLevelIdForAnswer(e.parameters,t.parameters)}catch(e){return!1}a&&(r?(e.parameters["profile-level-id"]=r,t.parameters["profile-level-id"]=r):(delete e.parameters["profile-level-id"],delete t.parameters["profile-level-id"]))}break;case"video/vp9":if(r){if((e.parameters["profile-id"]||0)!==(t.parameters["profile-id"]||0))return!1}}return!0}function b(e,t){return(!e.kind||!t.kind||e.kind===t.kind)&&e.uri===t.uri}function y(e,t){const r=[];for(const a of e.rtcpFeedback||[]){const e=(t.rtcpFeedback||[]).find((e=>e.type===a.type&&(e.parameter===a.parameter||!e.parameter&&!a.parameter)));e&&r.push(e)}return r}t.validateRtpCapabilities=function(e){if("object"!=typeof e)throw new TypeError("caps is not an object");if(e.codecs&&!Array.isArray(e.codecs))throw new TypeError("caps.codecs is not an array");e.codecs||(e.codecs=[]);for(const t of e.codecs)c(t);if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("caps.headerExtensions is not an array");e.headerExtensions||(e.headerExtensions=[]);for(const t of e.headerExtensions)p(t)},t.validateRtpCodecCapability=c,t.validateRtcpFeedback=d,t.validateRtpHeaderExtension=p,t.validateRtpParameters=u,t.validateRtpCodecParameters=l,t.validateRtpHeaderExtensionParameters=h,t.validateRtpEncodingParameters=m,t.validateRtcpParameters=f,t.validateSctpCapabilities=function(e){if("object"!=typeof e)throw new TypeError("caps is not an object");if(!e.numStreams||"object"!=typeof e.numStreams)throw new TypeError("missing caps.numStreams");g(e.numStreams)},t.validateNumSctpStreams=g,t.validateSctpParameters=function(e){if("object"!=typeof e)throw new TypeError("params is not an object");if("number"!=typeof e.port)throw new TypeError("missing params.port");if("number"!=typeof e.OS)throw new TypeError("missing params.OS");if("number"!=typeof e.MIS)throw new TypeError("missing params.MIS");if("number"!=typeof e.maxMessageSize)throw new TypeError("missing params.maxMessageSize")},t.validateSctpStreamParameters=function(e){if("object"!=typeof e)throw new TypeError("params is not an object");if("number"!=typeof e.streamId)throw new TypeError("missing params.streamId");let t=!1;if("boolean"==typeof e.ordered?t=!0:e.ordered=!0,e.maxPacketLifeTime&&"number"!=typeof e.maxPacketLifeTime)throw new TypeError("invalid params.maxPacketLifeTime");if(e.maxRetransmits&&"number"!=typeof e.maxRetransmits)throw new TypeError("invalid params.maxRetransmits");if(e.maxPacketLifeTime&&e.maxRetransmits)throw new TypeError("cannot provide both maxPacketLifeTime and maxRetransmits");if(t&&e.ordered&&(e.maxPacketLifeTime||e.maxRetransmits))throw new TypeError("cannot be ordered with maxPacketLifeTime or maxRetransmits");if(t||!e.maxPacketLifeTime&&!e.maxRetransmits||(e.ordered=!1),e.label&&"string"!=typeof e.label)throw new TypeError("invalid params.label");if(e.protocol&&"string"!=typeof e.protocol)throw new TypeError("invalid params.protocol")},t.getExtendedRtpCapabilities=function(e,t){const r={codecs:[],headerExtensions:[]};for(const a of t.codecs||[]){if(_(a))continue;const t=(e.codecs||[]).find((e=>v(e,a,{strict:!0,modify:!0})));if(!t)continue;const n={mimeType:t.mimeType,kind:t.kind,clockRate:t.clockRate,channels:t.channels,localPayloadType:t.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:a.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:t.parameters,remoteParameters:a.parameters,rtcpFeedback:y(t,a)};r.codecs.push(n)}for(const a of r.codecs){const r=e.codecs.find((e=>_(e)&&e.parameters.apt===a.localPayloadType)),n=t.codecs.find((e=>_(e)&&e.parameters.apt===a.remotePayloadType));r&&n&&(a.localRtxPayloadType=r.preferredPayloadType,a.remoteRtxPayloadType=n.preferredPayloadType)}for(const a of t.headerExtensions){const t=e.headerExtensions.find((e=>b(e,a)));if(!t)continue;const n={kind:a.kind,uri:a.uri,sendId:t.preferredId,recvId:a.preferredId,encrypt:t.preferredEncrypt,direction:"sendrecv"};switch(a.direction){case"sendrecv":n.direction="sendrecv";break;case"recvonly":n.direction="sendonly";break;case"sendonly":n.direction="recvonly";break;case"inactive":n.direction="inactive"}r.headerExtensions.push(n)}return r},t.getRecvRtpCapabilities=function(e){const t={codecs:[],headerExtensions:[]};for(const r of e.codecs){const e={mimeType:r.mimeType,kind:r.kind,preferredPayloadType:r.remotePayloadType,clockRate:r.clockRate,channels:r.channels,parameters:r.localParameters,rtcpFeedback:r.rtcpFeedback};if(t.codecs.push(e),!r.remoteRtxPayloadType)continue;const a={mimeType:`${r.kind}/rtx`,kind:r.kind,preferredPayloadType:r.remoteRtxPayloadType,clockRate:r.clockRate,parameters:{apt:r.remotePayloadType},rtcpFeedback:[]};t.codecs.push(a)}for(const r of e.headerExtensions){if("sendrecv"!==r.direction&&"recvonly"!==r.direction)continue;const e={kind:r.kind,uri:r.uri,preferredId:r.recvId,preferredEncrypt:r.encrypt,direction:r.direction};t.headerExtensions.push(e)}return t},t.getSendingRtpParameters=function(e,t){const r={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const a of t.codecs){if(a.kind!==e)continue;const t={mimeType:a.mimeType,payloadType:a.localPayloadType,clockRate:a.clockRate,channels:a.channels,parameters:a.localParameters,rtcpFeedback:a.rtcpFeedback};if(r.codecs.push(t),a.localRtxPayloadType){const e={mimeType:`${a.kind}/rtx`,payloadType:a.localRtxPayloadType,clockRate:a.clockRate,parameters:{apt:a.localPayloadType},rtcpFeedback:[]};r.codecs.push(e)}}for(const a of t.headerExtensions){if(a.kind&&a.kind!==e||"sendrecv"!==a.direction&&"sendonly"!==a.direction)continue;const t={uri:a.uri,id:a.sendId,encrypt:a.encrypt,parameters:{}};r.headerExtensions.push(t)}return r},t.getSendingRemoteRtpParameters=function(e,t){const r={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const a of t.codecs){if(a.kind!==e)continue;const t={mimeType:a.mimeType,payloadType:a.localPayloadType,clockRate:a.clockRate,channels:a.channels,parameters:a.remoteParameters,rtcpFeedback:a.rtcpFeedback};if(r.codecs.push(t),a.localRtxPayloadType){const e={mimeType:`${a.kind}/rtx`,payloadType:a.localRtxPayloadType,clockRate:a.clockRate,parameters:{apt:a.localPayloadType},rtcpFeedback:[]};r.codecs.push(e)}}for(const a of t.headerExtensions){if(a.kind&&a.kind!==e||"sendrecv"!==a.direction&&"sendonly"!==a.direction)continue;const t={uri:a.uri,id:a.sendId,encrypt:a.encrypt,parameters:{}};r.headerExtensions.push(t)}if(r.headerExtensions.some((e=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.uri)))for(const e of r.codecs)e.rtcpFeedback=(e.rtcpFeedback||[]).filter((e=>"goog-remb"!==e.type));else if(r.headerExtensions.some((e=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e.uri)))for(const e of r.codecs)e.rtcpFeedback=(e.rtcpFeedback||[]).filter((e=>"transport-cc"!==e.type));else for(const e of r.codecs)e.rtcpFeedback=(e.rtcpFeedback||[]).filter((e=>"transport-cc"!==e.type&&"goog-remb"!==e.type));return r},t.reduceCodecs=function(e,t){const r=[];if(t){for(let a=0;a<e.length;++a)if(v(e[a],t)){r.push(e[a]),_(e[a+1])&&r.push(e[a+1]);break}if(0===r.length)throw new TypeError("no matching codec found")}else r.push(e[0]),_(e[1])&&r.push(e[1]);return r},t.generateProbatorRtpParameters=function(e){u(e=o.clone(e,{}));const t={mid:"probator",codecs:[],headerExtensions:[],encodings:[{ssrc:1234}],rtcp:{cname:"probator"}};return t.codecs.push(e.codecs[0]),t.codecs[0].payloadType=127,t.headerExtensions=e.headerExtensions,t},t.canSend=function(e,t){return t.codecs.some((t=>t.kind===e))},t.canReceive=function(e,t){if(u(e),0===e.codecs.length)return!1;const r=e.codecs[0];return t.codecs.some((e=>e.remotePayloadType===r.payloadType))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidStateError=t.UnsupportedError=void 0;class a extends Error{constructor(e){super(e),this.name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,a):this.stack=new Error(e).stack}}t.UnsupportedError=a;class n extends Error{constructor(e){super(e),this.name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,n):this.stack=new Error(e).stack}}t.InvalidStateError=n},function(e,t,r){var a=r(69),n=r(70);t.write=n,t.parse=a.parse,t.parseParams=a.parseParams,t.parseFmtpConfig=a.parseFmtpConfig,t.parsePayloads=a.parsePayloads,t.parseRemoteCandidates=a.parseRemoteCandidates,t.parseImageAttributes=a.parseImageAttributes,t.parseSimulcastStreamList=a.parseSimulcastStreamList},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HandlerInterface=void 0;const a=r(15);class n extends a.EnhancedEventEmitter{constructor(){super()}}t.HandlerInterface=n},function(e,t,r){"use strict";var a,n="object"==typeof Reflect?Reflect:null,i=n&&"function"==typeof n.apply?n.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};a=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,e.exports.once=function(e,t){return new Promise((function(r,a){function n(){void 0!==i&&e.removeListener("error",i),r([].slice.call(arguments))}var i;"error"!==t&&(i=function(r){e.removeListener(t,n),a(r)},e.once("error",i)),e.once(t,n)}))},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var c=10;function d(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function p(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function u(e,t,r,a){var n,i,s,o;if(d(r),void 0===(i=e._events)?(i=e._events=Object.create(null),e._eventsCount=0):(void 0!==i.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),i=e._events),s=i[t]),void 0===s)s=i[t]=r,++e._eventsCount;else if("function"==typeof s?s=i[t]=a?[r,s]:[s,r]:a?s.unshift(r):s.push(r),(n=p(e))>0&&s.length>n&&!s.warned){s.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=s.length,o=c,console&&console.warn&&console.warn(o)}return e}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(e,t,r){var a={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},n=l.bind(a);return n.listener=r,a.wrapFn=n,n}function m(e,t,r){var a=e._events;if(void 0===a)return[];var n=a[t];return void 0===n?[]:"function"==typeof n?r?[n.listener||n]:[n]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(n):g(n,n.length)}function f(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function g(e,t){for(var r=new Array(t),a=0;a<t;++a)r[a]=e[a];return r}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");c=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return p(this)},o.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var a="error"===e,n=this._events;if(void 0!==n)a=a&&void 0===n.error;else if(!a)return!1;if(a){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var o=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw o.context=s,o}var c=n[e];if(void 0===c)return!1;if("function"==typeof c)i(c,this,t);else{var d=c.length,p=g(c,d);for(r=0;r<d;++r)i(p[r],this,t)}return!0},o.prototype.addListener=function(e,t){return u(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return u(this,e,t,!0)},o.prototype.once=function(e,t){return d(t),this.on(e,h(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){return d(t),this.prependListener(e,h(this,e,t)),this},o.prototype.removeListener=function(e,t){var r,a,n,i,s;if(d(t),void 0===(a=this._events))return this;if(void 0===(r=a[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete a[e],a.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(n=-1,i=r.length-1;i>=0;i--)if(r[i]===t||r[i].listener===t){s=r[i].listener,n=i;break}if(n<0)return this;0===n?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,n),1===r.length&&(a[e]=r[0]),void 0!==a.removeListener&&this.emit("removeListener",e,s||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,r,a;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var n,i=Object.keys(r);for(a=0;a<i.length;++a)"removeListener"!==(n=i[a])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(a=t.length-1;a>=0;a--)this.removeListener(e,t[a]);return this},o.prototype.listeners=function(e){return m(this,e,!0)},o.prototype.rawListeners=function(e){return m(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):f.call(e,t)},o.prototype.listenerCount=f,o.prototype.eventNames=function(){return this._eventsCount>0?a(this._events):[]}},function(e,t,r){(function(a){t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;t.splice(1,0,r,"color: inherit");let a=0,n=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(a++,"%c"===e&&(n=a))})),t.splice(n,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}!e&&void 0!==a&&"env"in a&&(e=a.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=r(54)(t);const{formatters:n}=e.exports;n.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this,r(29))},function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.hasOwnProperty.call(e,r)&&a(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.applyCodecParameters=t.getCname=t.extractDtlsParameters=t.extractRtpCapabilities=void 0;const s=i(r(9));t.extractRtpCapabilities=function({sdpObject:e}){const t=new Map,r=[];let a=!1,n=!1;for(const i of e.media){const e=i.type;switch(e){case"audio":if(a)continue;a=!0;break;case"video":if(n)continue;n=!0;break;default:continue}for(const r of i.rtp){const a={kind:e,mimeType:`${e}/${r.codec}`,preferredPayloadType:r.payload,clockRate:r.rate,channels:r.encoding,parameters:{},rtcpFeedback:[]};t.set(a.preferredPayloadType,a)}for(const e of i.fmtp||[]){const r=s.parseParams(e.config),a=t.get(e.payload);a&&(r&&r.hasOwnProperty("profile-level-id")&&(r["profile-level-id"]=String(r["profile-level-id"])),a.parameters=r)}for(const e of i.rtcpFb||[]){const r=t.get(e.payload);if(!r)continue;const a={type:e.type,parameter:e.subtype};a.parameter||delete a.parameter,r.rtcpFeedback.push(a)}for(const t of i.ext||[]){if(t["encrypt-uri"])continue;const a={kind:e,uri:t.uri,preferredId:t.value};r.push(a)}}return{codecs:Array.from(t.values()),headerExtensions:r}},t.extractDtlsParameters=function({sdpObject:e}){const t=(e.media||[]).find((e=>e.iceUfrag&&0!==e.port));if(!t)throw new Error("no active media section found");const r=t.fingerprint||e.fingerprint;let a;switch(t.setup){case"active":a="client";break;case"passive":a="server";break;case"actpass":a="auto"}return{role:a,fingerprints:[{algorithm:r.type,value:r.hash}]}},t.getCname=function({offerMediaObject:e}){const t=(e.ssrcs||[]).find((e=>"cname"===e.attribute));return t?t.value:""},t.applyCodecParameters=function({offerRtpParameters:e,answerMediaObject:t}){for(const r of e.codecs){const e=r.mimeType.toLowerCase();if("audio/opus"!==e)continue;if(!(t.rtp||[]).find((e=>e.payload===r.payloadType)))continue;t.fmtp=t.fmtp||[];let a=t.fmtp.find((e=>e.payload===r.payloadType));a||(a={payload:r.payloadType,config:""},t.fmtp.push(a));const n=s.parseParams(a.config);switch(e){case"audio/opus":{const e=r.parameters["sprop-stereo"];void 0!==e&&(n.stereo=e?1:0);break}}a.config="";for(const e of Object.keys(n))a.config&&(a.config+=";"),a.config+=`${e}=${n[e]}`}}},function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.hasOwnProperty.call(e,r)&&a(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.RemoteSdp=void 0;const s=i(r(9)),o=r(5),c=r(71),d=new o.Logger("RemoteSdp");t.RemoteSdp=class{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:a,plainRtpParameters:n,planB:i=!1}){if(this._mediaSections=[],this._midToIndex=new Map,this._iceParameters=e,this._iceCandidates=t,this._dtlsParameters=r,this._sctpParameters=a,this._plainRtpParameters=n,this._planB=i,this._sdpObject={version:0,origin:{address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:1e4,sessionVersion:0,username:"mediasoup-client"},name:"-",timing:{start:0,stop:0},media:[]},e&&e.iceLite&&(this._sdpObject.icelite="ice-lite"),r){this._sdpObject.msidSemantic={semantic:"WMS",token:"*"};const e=this._dtlsParameters.fingerprints.length;this._sdpObject.fingerprint={type:r.fingerprints[e-1].algorithm,hash:r.fingerprints[e-1].value},this._sdpObject.groups=[{type:"BUNDLE",mids:""}]}n&&(this._sdpObject.origin.address=n.ip,this._sdpObject.origin.ipVer=n.ipVersion)}updateIceParameters(e){d.debug("updateIceParameters() [iceParameters:%o]",e),this._iceParameters=e,this._sdpObject.icelite=e.iceLite?"ice-lite":void 0;for(const t of this._mediaSections)t.setIceParameters(e)}updateDtlsRole(e){d.debug("updateDtlsRole() [role:%s]",e),this._dtlsParameters.role=e;for(const t of this._mediaSections)t.setDtlsRole(e)}getNextMediaSectionIdx(){for(let e=0;e<this._mediaSections.length;++e){const t=this._mediaSections[e];if(t.closed)return{idx:e,reuseMid:t.mid}}return{idx:this._mediaSections.length}}send({offerMediaObject:e,reuseMid:t,offerRtpParameters:r,answerRtpParameters:a,codecOptions:n,extmapAllowMixed:i=!1}){const s=new c.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,offerMediaObject:e,offerRtpParameters:r,answerRtpParameters:a,codecOptions:n,extmapAllowMixed:i});t?this._replaceMediaSection(s,t):this._midToIndex.has(s.mid)?this._replaceMediaSection(s):this._addMediaSection(s)}receive({mid:e,kind:t,offerRtpParameters:r,streamId:a,trackId:n}){const i=this._midToIndex.get(e);let s;if(void 0!==i&&(s=this._mediaSections[i]),s)s.planBReceive({offerRtpParameters:r,streamId:a,trackId:n}),this._replaceMediaSection(s);else{s=new c.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,mid:e,kind:t,offerRtpParameters:r,streamId:a,trackId:n});const i=this._mediaSections.find((e=>e.closed));i?this._replaceMediaSection(s,i.mid):this._addMediaSection(s)}}disableMediaSection(e){const t=this._midToIndex.get(e);if(void 0===t)throw new Error(`no media section found with mid '${e}'`);this._mediaSections[t].disable()}closeMediaSection(e){const t=this._midToIndex.get(e);if(void 0===t)throw new Error(`no media section found with mid '${e}'`);const r=this._mediaSections[t];if(e===this._firstMid)return d.debug("closeMediaSection() | cannot close first media section, disabling it instead [mid:%s]",e),void this.disableMediaSection(e);r.close(),this._regenerateBundleMids()}planBStopReceiving({mid:e,offerRtpParameters:t}){const r=this._midToIndex.get(e);if(void 0===r)throw new Error(`no media section found with mid '${e}'`);const a=this._mediaSections[r];a.planBStopReceiving({offerRtpParameters:t}),this._replaceMediaSection(a)}sendSctpAssociation({offerMediaObject:e}){const t=new c.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:e});this._addMediaSection(t)}receiveSctpAssociation({oldDataChannelSpec:e=!1}={}){const t=new c.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,mid:"datachannel",kind:"application",oldDataChannelSpec:e});this._addMediaSection(t)}getSdp(){return this._sdpObject.origin.sessionVersion++,s.write(this._sdpObject)}_addMediaSection(e){this._firstMid||(this._firstMid=e.mid),this._mediaSections.push(e),this._midToIndex.set(e.mid,this._mediaSections.length-1),this._sdpObject.media.push(e.getObject()),this._regenerateBundleMids()}_replaceMediaSection(e,t){if("string"==typeof t){const r=this._midToIndex.get(t);if(void 0===r)throw new Error(`no media section found for reuseMid '${t}'`);const a=this._mediaSections[r];this._mediaSections[r]=e,this._midToIndex.delete(a.mid),this._midToIndex.set(e.mid,r),this._sdpObject.media[r]=e.getObject(),this._regenerateBundleMids()}else{const t=this._midToIndex.get(e.mid);if(void 0===t)throw new Error(`no media section found with mid '${e.mid}'`);this._mediaSections[t]=e,this._sdpObject.media[t]=e.getObject()}}_regenerateBundleMids(){this._dtlsParameters&&(this._sdpObject.groups[0].mids=this._mediaSections.filter((e=>!e.closed)).map((e=>e.mid)).join(" "))}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EnhancedEventEmitter=void 0;const a=r(11),n=new(r(5).Logger)("EnhancedEventEmitter");class i extends a.EventEmitter{constructor(){super(),this.setMaxListeners(1/0)}safeEmit(e,...t){const r=this.listenerCount(e);try{return this.emit(e,...t)}catch(t){return n.error("safeEmit() | event listener threw an error [event:%s]:%o",e,t),Boolean(r)}}async safeEmitAsPromise(e,...t){return new Promise(((r,a)=>{try{this.emit(e,...t,r,a)}catch(t){n.error("safeEmitAsPromise() | event listener threw an error [event:%s]:%o",e,t),a(t)}}))}}t.EnhancedEventEmitter=i},function(e,t,r){var a=r(45),n=r(46),i=r(47),s=r(48);e.exports=function(e){return a(e)||n(e)||i(e)||s()},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return ge}));var a=r(2),n=r.n(a),i=r(1),s=r.n(i),o=r(3),c=r.n(o),d=r(4),p=r.n(d),u=r(0),l=r.n(u),h=r(26),m=r.n(h),f=r(27),g=r(12),_=r.n(g),v="mediasoup-demo",b=function(){function e(t){c()(this,e),t?(this._debug=_()("".concat(v,":").concat(t)),this._warn=_()("".concat(v,":WARN:").concat(t)),this._error=_()("".concat(v,":ERROR:").concat(t))):(this._debug=_()(v),this._warn=_()("".concat(v,":WARN")),this._error=_()("".concat(v,":ERROR"))),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}return p()(e,[{key:"debug",get:function(){return this._debug}},{key:"warn",get:function(){return this._warn}},{key:"error",get:function(){return this._error}}]),e}();var y=r(19),w=r.n(y),S="mediasoup-demo.user",P="mediasoup-demo.devices";function R(e){var t=e.displayName;w.a.set(S,{displayName:t})}function C(){return w.a.getJSON(P)}var k=r(18),E=r.n(k),T=function(e){return{type:"SET_ROOM_STATE",payload:{state:e}}},x=function(e){return{type:"SET_ROOM_ACTIVE_SPEAKER",payload:{peerId:e}}},O=function(e){return{type:"SET_DISPLAY_NAME",payload:{displayName:e}}},D=function(e){return{type:"SET_AUDIO_ONLY_STATE",payload:{enabled:e}}},I=function(e){return{type:"SET_AUDIO_ONLY_IN_PROGRESS",payload:{flag:e}}},M=function(e){return{type:"SET_AUDIO_MUTED_STATE",payload:{enabled:e}}},j=function(e){return{type:"SET_RESTART_ICE_IN_PROGRESS",payload:{flag:e}}},L=function(e){return{type:"ADD_PRODUCER",payload:{producer:e}}},A=function(e){return{type:"REMOVE_PRODUCER",payload:{producerId:e}}},N=function(e,t){return{type:"SET_PRODUCER_TRACK",payload:{producerId:e,track:t}}},F=function(e,t){return{type:"SET_PRODUCER_SCORE",payload:{producerId:e,score:t}}},B=function(e){return{type:"ADD_DATA_PRODUCER",payload:{dataProducer:e}}},V=function(e){return{type:"SET_WEBCAM_IN_PROGRESS",payload:{flag:e}}},W=function(e){return{type:"SET_SHARE_IN_PROGRESS",payload:{flag:e}}},U=function(e){return{type:"ADD_PEER",payload:{peer:e}}},q=function(e){return{type:"REMOVE_PEER",payload:{peerId:e}}},G=function(e,t){return{type:"SET_PEER_DISPLAY_NAME",payload:{displayName:e,peerId:t}}},z=function(e,t){return{type:"ADD_CONSUMER",payload:{consumer:e,peerId:t}}},$=function(e,t){return{type:"REMOVE_CONSUMER",payload:{consumerId:e,peerId:t}}},K=function(e,t){return{type:"SET_CONSUMER_PAUSED",payload:{consumerId:e,originator:t}}},H=function(e,t){return{type:"SET_CONSUMER_RESUMED",payload:{consumerId:e,originator:t}}},Q=function(e,t,r){return{type:"SET_CONSUMER_CURRENT_LAYERS",payload:{consumerId:e,spatialLayer:t,temporalLayer:r}}},J=function(e,t,r){return{type:"SET_CONSUMER_PREFERRED_LAYERS",payload:{consumerId:e,spatialLayer:t,temporalLayer:r}}},Y=function(e,t){return{type:"SET_CONSUMER_PRIORITY",payload:{consumerId:e,priority:t}}},Z=function(e,t){return{type:"SET_CONSUMER_SCORE",payload:{consumerId:e,score:t}}},X=function(e,t){return{type:"ADD_DATA_CONSUMER",payload:{dataConsumer:e,peerId:t}}},ee=function(e,t){return{type:"REMOVE_DATA_CONSUMER",payload:{dataConsumerId:e,peerId:t}}},te=function(e){var t=e.type,r=void 0===t?"info":t,a=e.text,n=e.title,i=e.timeout;if(!i)switch(r){case"info":i=3e3;break;case"error":i=5e3}var s={id:E()({length:6}).toLowerCase(),type:r,title:n,text:a,timeout:i};return function(e){e(function(e){return{type:"ADD_NOTIFICATION",payload:{notification:e}}}(s)),setTimeout((function(){e({type:"REMOVE_NOTIFICATION",payload:{notificationId:s.id}})}),i)}},re=r(11);function ae(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return ne(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ne(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var a=0,n=function(){};return{s:n,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==r.return||r.return()}finally{if(o)throw i}}}}function ne(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function ie(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function se(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ie(Object(r),!0).forEach((function(t){n()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ie(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var oe,ce={sd:{low:{s:0,t:2},med:{s:0,t:2},high:{s:1,t:2},s0t0:{s:0,t:0},s0t1:{s:0,t:1},s0t2:{s:0,t:2},s1t0:{s:1,t:0},s1t1:{s:1,t:1},s1t2:{s:1,t:2},s2t0:{s:2,t:0},s2t1:{s:2,t:1},s2t2:{s:2,t:2}},hd:{low:{s:0,t:2},med:{s:1,t:2},high:{s:2,t:2},s0t0:{s:0,t:0},s0t1:{s:0,t:1},s0t2:{s:0,t:2},s1t0:{s:1,t:0},s1t1:{s:1,t:1},s1t2:{s:1,t:2},s2t0:{s:2,t:0},s2t1:{s:2,t:1},s2t2:{s:2,t:2}}},de={qvga:{width:{ideal:320},height:{ideal:240}},vga:{width:{ideal:640},height:{ideal:480}},sd:{width:{ideal:1280},height:{ideal:720},frameRate:{max:24}},hd:{width:{ideal:1280},height:{ideal:720},frameRate:{max:24}}},pe={optional:[{googDscp:!0}]},ue={sd:[{scaleResolutionDownBy:6},{scaleResolutionDownBy:4},{scaleResolutionDownBy:2}],hd:[{scaleResolutionDownBy:4},{scaleResolutionDownBy:2},{scaleResolutionDownBy:1}]},le=[{scalabilityMode:"S3T3_KEY"}],he=[{dtx:!0,maxFramerate:10}],me=[{scalabilityMode:"S3T3",dtx:!0}],fe=new b("RoomClient"),ge=function(){function e(t){var r=t.roomId,a=t.peerId,n=t.secret,i=t.displayName,s=t.device,o=t.handlerName,d=t.useSimulcast,p=t.useSharingSimulcast,u=t.forceTcp,l=t.produce,h=t.consume,m=t.forceH264,f=t.forceVP9,g=t.svc,_=t.datachannel,v=t.externalVideo,b=t.micEnabled,y=t.webcamEnabled,w=t.maxResolution;c()(this,e),fe.debug('constructor() [roomId:"%s", peerId:"%s", displayName:"%s", device:%s]',r,a,i,s.flag),this._eventEmitter=new re.EventEmitter,this._closed=!1,this._displayName=i,this._device=s,this._forceTcp=u,this._produce=l,this._consume=h,this._useDataChannel=_,this._forceH264=Boolean(m),this._forceVP9=Boolean(f),this._micEnabled=Boolean(b),this._webcamEnabled=Boolean(y),this._externalVideo=null,this._externalVideoStream=null,this._nextDataChannelTestNumber=0,v&&(this._externalVideo=document.createElement("video"),this._externalVideo.controls=!0,this._externalVideo.loop=!0,this._externalVideo.setAttribute("playsinline",""),this._externalVideo.src=v,this._externalVideo.play().catch((function(e){return fe.warn("externalVideo.play() failed:%o",e)}))),this._handlerName=o,this._useSimulcast=d,this._useSharingSimulcast=p,this._protooUrl=function(e){var t=e.roomId,r=e.peerId,a=e.secret;return"wss://".concat("call-api.videosdk.live","/?roomId=").concat(t,"&peerId=").concat(r,"&secret=").concat(a)}({roomId:r,peerId:a,secret:n}),this._secret=n,this._peerId=a,this._protoo=null,this._mediasoupDevice=null,this._sendTransport=null,this._recvTransport=null,this._micProducer=null,this._webcamProducer=null,this._shareProducer=null,this._chatDataProducer=null,this._botDataProducer=null,this._consumers=new Map,this._dataConsumers=new Map,this._mics=new Map,this._mic={device:null},this._webcams=new Map,this._webcam={device:null,resolution:w||"hd"},this._pinnedParticipants=new Map,this._usageIntervalDuration=5,g&&(le[0].scalabilityMode="".concat(g,"_KEY"),me[0].scalabilityMode=g)}var t,r,a,n,i,o,d,u,h,g,_,v,b,y,w,S,P,k,E,ne,ie,ge,_e,ve,be,ye,we,Se,Pe,Re,Ce,ke,Ee,Te,xe,Oe,De,Ie,Me,je,Le,Ae,Ne,Fe,Be,Ve,We,Ue,qe,Ge,ze,$e,Ke,He,Qe,Je,Ye,Ze,Xe,et,tt,rt,at,nt,it,st,ot,ct,dt,pt,ut,lt,ht,mt,ft,gt,_t,vt,bt;return p()(e,[{key:"on",value:function(e,t){this._eventEmitter.on(e,t)}},{key:"close",value:function(){this._closed||(this._closed=!0,fe.debug("close()"),this._protoo.close(),this._usageInterval&&clearInterval(this._usageInterval),this._sendTransport&&this._sendTransport.close(),this._recvTransport&&this._recvTransport.close(),oe.dispatch(T("closed")),this._eventEmitter.emit("MEETING_LEFT"))}},{key:"join",value:(bt=s()(l.a.mark((function e(){var t,r=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=new m.a.WebSocketTransport(this._protooUrl),this._protoo=new m.a.Peer(t),oe.dispatch(T("connecting")),this._protoo.on("open",(function(){return r.requestEntry()})),this._protoo.on("failed",(function(){oe.dispatch(te({type:"error",text:"WebSocket connection failed"}))})),this._protoo.on("disconnected",(function(){oe.dispatch(te({type:"error",text:"WebSocket disconnected"})),r._sendTransport&&(r._sendTransport.close(),r._sendTransport=null),r._recvTransport&&(r._recvTransport.close(),r._recvTransport=null),oe.dispatch(T("closed"))})),this._protoo.on("close",(function(){r._closed||r.close()})),this._protoo.on("request",function(){var e=s()(l.a.mark((function e(t,a,n){var i,s,o,c,d,p,u,h,m,g,_,v,b,y,w,S,P,R,C,k,E,T,x,O,D,I,M,j,L,A;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:fe.debug('proto "request" event [method:%s, data:%o]',t.method,t.data),e.t0=t.method,e.next="close"===e.t0?4:"newConsumer"===e.t0?6:"newDataConsumer"===e.t0?30:"enableMic"===e.t0?58:"disableMic"===e.t0?69:"enableWebcam"===e.t0?80:"disableWebcam"===e.t0?91:"pinStateChanged"===e.t0?102:"switchRoom"===e.t0?119:120;break;case 4:return r.close(),e.abrupt("break",120);case 6:if(r._consume){e.next=9;break}return n(403,"I do not want to consume"),e.abrupt("break",120);case 9:return i=t.data,s=i.peerId,o=i.producerId,c=i.id,d=i.kind,p=i.rtpParameters,u=i.type,h=i.appData,m=i.producerPaused,e.prev=10,e.next=13,r._recvTransport.consume({id:c,producerId:o,kind:d,rtpParameters:p,appData:se(se({},h),{},{peerId:s})});case 13:g=e.sent,r._consumers.set(g.id,g),g.on("transportclose",(function(){r._consumers.delete(g.id)})),_=f.parseScalabilityMode(g.rtpParameters.encodings[0].scalabilityMode),v=_.spatialLayers,b=_.temporalLayers,y=z({id:g.id,type:u,locallyPaused:!1,remotelyPaused:m,rtpParameters:g.rtpParameters,spatialLayers:v,temporalLayers:b,preferredSpatialLayer:v-1,preferredTemporalLayer:b-1,priority:1,codec:g.rtpParameters.codecs[0].mimeType.split("/")[1],track:g.track,appData:h,instance:g},s),oe.dispatch(y),r._eventEmitter.emit(y.type,y.payload),a(),"video"===g.kind&&oe.getState().me.audioOnly&&r._pauseConsumer(g),e.next=29;break;case 24:throw e.prev=24,e.t1=e.catch(10),fe.error('"newConsumer" request failed:%o',e.t1),oe.dispatch(te({type:"error",text:"Error creating a Consumer: ".concat(e.t1)})),e.t1;case 29:return e.abrupt("break",120);case 30:if(r._consume){e.next=33;break}return n(403,"I do not want to data consume"),e.abrupt("break",120);case 33:if(r._useDataChannel){e.next=36;break}return n(403,"I do not want DataChannels"),e.abrupt("break",120);case 36:return w=t.data,S=w.peerId,P=w.dataProducerId,R=w.id,C=w.sctpStreamParameters,k=w.label,E=w.protocol,T=w.appData,e.prev=37,e.next=40,r._recvTransport.consumeData({id:R,dataProducerId:P,sctpStreamParameters:C,label:k,protocol:E,appData:se(se({},T),{},{peerId:S})});case 40:x=e.sent,r._dataConsumers.set(x.id,x),x.on("transportclose",(function(){r._dataConsumers.delete(x.id)})),x.on("open",(function(){fe.debug('DataConsumer "open" event')})),x.on("close",(function(){fe.warn('DataConsumer "close" event'),r._dataConsumers.delete(x.id),oe.dispatch(te({type:"error",text:"DataConsumer closed"}))})),x.on("error",(function(e){fe.error('DataConsumer "error" event:%o',e),oe.dispatch(te({type:"error",text:"DataConsumer error: ".concat(e)}))})),x.on("message",(function(e){if(fe.debug('DataConsumer "message" event [streamId:%d]',x.sctpStreamParameters.streamId),window.DC_MESSAGE=e,e instanceof ArrayBuffer){var t=new DataView(e).getUint32();return t==Math.pow(2,32)-1?(fe.warn("dataChannelTest finished!"),void(r._nextDataChannelTestNumber=0)):(t>r._nextDataChannelTestNumber&&fe.warn("dataChannelTest: %s packets missing",t-r._nextDataChannelTestNumber),void(r._nextDataChannelTestNumber=t+1))}if("string"==typeof e)switch(x.label){case"chat":var a=oe.getState().peers,n=Object.keys(a).map((function(e){return a[e]})).find((function(e){return e.dataConsumers.includes(x.id)}));if(!n){fe.warn('DataConsumer "message" from unknown peer');break}oe.dispatch(te({title:"".concat(n.displayName," says:"),text:e,timeout:5e3})),r._eventEmitter.emit("CHAT_MESSAGE",{text:e,senderId:n.id,timestamp:(new Date).getTime()});break;case"bot":oe.dispatch(te({title:"Message from Bot:",text:e,timeout:5e3}))}else fe.warn('ignoring DataConsumer "message" (not a string)')})),window.DC=x,oe.dispatch(X({id:x.id,sctpStreamParameters:x.sctpStreamParameters,label:x.label,protocol:x.protocol},S)),a(),e.next=57;break;case 52:throw e.prev=52,e.t2=e.catch(37),fe.error('"newDataConsumer" request failed:%o',e.t2),oe.dispatch(te({type:"error",text:"Error creating a DataConsumer: ".concat(e.t2)})),e.t2;case 57:return e.abrupt("break",120);case 58:e.prev=58,O=t.data.peerId,r._eventEmitter.emit("MIC_REQUESTED",{peerId:O}),a(),e.next=68;break;case 64:throw e.prev=64,e.t3=e.catch(58),fe.error('"enableMic" request failed:%o',e.t3),e.t3;case 68:return e.abrupt("break",120);case 69:return e.prev=69,e.next=72,r.disableMic();case 72:a(),e.next=79;break;case 75:throw e.prev=75,e.t4=e.catch(69),fe.error('"disableMic" request failed:%o',e.t4),e.t4;case 79:return e.abrupt("break",120);case 80:e.prev=80,D=t.data.peerId,r._eventEmitter.emit("WEBCAM_REQUESTED",{peerId:D}),a(),e.next=90;break;case 86:throw e.prev=86,e.t5=e.catch(80),fe.error('"enableWebcam" request failed:%o',e.t5),e.t5;case 90:return e.abrupt("break",120);case 91:return e.prev=91,e.next=94,r.disableWebcam();case 94:a(),e.next=101;break;case 97:throw e.prev=97,e.t6=e.catch(91),fe.error('"disableWebcam" request failed:%o',e.t6),e.t6;case 101:return e.abrupt("break",120);case 102:e.prev=102,I=t.data,M=I.peerId,j=I.state,L=I.pinnedBy,r._pinnedParticipants.has(M)||r._pinnedParticipants.set(M,{cam:!1,share:!1}),A=r._pinnedParticipants.get(M),null!=j.cam&&(A.cam=j.cam),null!=j.share&&(A.share=j.share),r._pinnedParticipants.set(M,A),r._eventEmitter.emit("PIN_STATE_CHANGED",{peerId:M,state:j,pinnedBy:L}),0==A.share&&0==A.cam&&r._pinnedParticipants.delete(M),a(),e.next=118;break;case 114:throw e.prev=114,e.t7=e.catch(102),fe.error('"pinStateChanged" request failed:%o',e.t7),e.t7;case 118:return e.abrupt("break",120);case 119:r._eventEmitter.emit("SWITCH_ROOM",t.data);case 120:case"end":return e.stop()}}),e,null,[[10,24],[37,52],[58,64],[69,75],[80,86],[91,97],[102,114]])})));return function(t,r,a){return e.apply(this,arguments)}}()),this._protoo.on("notification",(function(e){switch(fe.debug('proto "notification" event [method:%s, data:%o]',e.method,e.data),e.method){case"error":var t=e.data;r._eventEmitter.emit("ERROR",t);break;case"producerScore":var a=e.data,n=a.producerId,i=a.score;oe.dispatch(F(n,i));break;case"entryRequested":var s=e.data,o=s.id,c=s.name;o!==r._peerId&&r._eventEmitter.emit("ENTRY_REQUESTED",{id:o,name:c});break;case"entryResponded":var d=e.data,p=d.id,u=d.decision;r._eventEmitter.emit("ENTRY_RESPONDED",{id:p,decision:u}),p===r._peerId&&"allowed"===u&&r.joinRoom();break;case"newPeer":var l=e.data,h=U(se(se({},l),{},{consumers:[],dataConsumers:[]}));oe.dispatch(h),r._eventEmitter.emit(h.type,h.payload),oe.dispatch(te({text:"".concat(l.displayName," has joined the room")}));break;case"peerClosed":var m=e.data.peerId,f=q(m);oe.dispatch(f),r._eventEmitter.emit(f.type,f.payload);break;case"peerDisplayNameChanged":var g=e.data,_=g.peerId,v=g.displayName,b=g.oldDisplayName;oe.dispatch(G(v,_)),oe.dispatch(te({text:"".concat(b," is now ").concat(v)}));break;case"downlinkBwe":fe.debug("'downlinkBwe' event:%o",e.data);break;case"consumerClosed":var y=e.data.consumerId,w=r._consumers.get(y);if(!w)break;w.close(),r._consumers.delete(y);var S=w.appData.peerId,P=$(y,S);oe.dispatch(P),r._eventEmitter.emit(P.type,P.payload);break;case"consumerPaused":var R=e.data.consumerId,C=r._consumers.get(R);if(!C)break;C.pause(),oe.dispatch(K(R,"remote"));break;case"consumerResumed":var k=e.data.consumerId,E=r._consumers.get(k);if(!E)break;E.resume(),oe.dispatch(H(k,"remote"));break;case"consumerLayersChanged":var T=e.data,O=T.consumerId,D=T.spatialLayer,I=T.temporalLayer;if(!r._consumers.get(O))break;oe.dispatch(Q(O,D,I));break;case"consumerScore":var M=e.data,j=M.consumerId,L=M.score;oe.dispatch(Z(j,L));break;case"dataConsumerClosed":var A=e.data.dataConsumerId,N=r._dataConsumers.get(A);if(!N)break;N.close(),r._dataConsumers.delete(A);var B=N.appData.peerId;oe.dispatch(ee(A,B));break;case"activeSpeaker":var V=e.data.peerId,W=x(V);oe.dispatch(W),r._eventEmitter.emit(W.type,W.payload);break;case"recordingStarted":r._eventEmitter.emit("RECORDING_STARTED",{});break;case"recordingStopped":r._eventEmitter.emit("RECORDING_STOPPED",{});break;case"livestreamStarted":r._eventEmitter.emit("LIVESTREAM_STARTED",{});break;case"livestreamStopped":r._eventEmitter.emit("LIVESTREAM_STOPPED",{});break;case"whiteboardStarted":var z=e.data.state;r._eventEmitter.emit("WHITEBOARD_STARTED",{state:z});break;case"whiteboardStopped":r._eventEmitter.emit("WHITEBOARD_STOPPED",{});break;case"videoStatusChanged":r._eventEmitter.emit("VIDEO_STATE_CHANGED",e.data);break;case"videoSeeked":var J=e.data.currentTime;r._eventEmitter.emit("VIDEO_SEEKED",{currentTime:J});break;case"connectionOpen":r._eventEmitter.emit("CONNECTION_OPEN",e.data);break;case"connectionClose":r._eventEmitter.emit("CONNECTION_CLOSE",e.data);break;case"connectionChatMessage":r._eventEmitter.emit("CONNECTION_CHAT_MESSAGE",e.data);break;case"connectionParticipantJoined":r._eventEmitter.emit("CONNECTION_PARTICIPANT_JOIN",e.data);break;case"connectionParticipantLeft":r._eventEmitter.emit("CONNECTION_PARTICIPANT_LEFT",e.data);break;default:fe.error('unknown protoo notification.method "%s"',e.method)}}));case 9:case"end":return e.stop()}}),e,this)}))),function(){return bt.apply(this,arguments)})},{key:"requestEntry",value:(vt=s()(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._protoo.request("requestEntry",{name:this._displayName});case 2:case"end":return e.stop()}}),e,this)}))),function(){return vt.apply(this,arguments)})},{key:"respondEntry",value:(_t=s()(l.a.mark((function e(t,r){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._protoo.request("respondEntry",{id:t,decision:r});case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return _t.apply(this,arguments)})},{key:"startRecording",value:(gt=s()(l.a.mark((function e(t,r,a){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return fe.debug("startRecording()"),e.prev=1,e.next=4,this._protoo.request("startRecording",{webhookUrl:t,awsDirPath:r,config:a});case 4:e.next=10;break;case 6:throw e.prev=6,e.t0=e.catch(1),fe.error("startRecording() | failed:%o",e.t0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(e,t,r){return gt.apply(this,arguments)})},{key:"stopRecording",value:(ft=s()(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return fe.debug("stopRecording()"),e.prev=1,e.next=4,this._protoo.request("stopRecording",{});case 4:e.next=10;break;case 6:throw e.prev=6,e.t0=e.catch(1),fe.error("stopRecording() | failed:%o",e.t0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(){return ft.apply(this,arguments)})},{key:"startLivestream",value:(mt=s()(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return fe.debug("startLivestream()"),e.prev=1,e.next=4,this._protoo.request("startLivestream",{outputs:t});case 4:e.next=10;break;case 6:throw e.prev=6,e.t0=e.catch(1),fe.error("startLivestream() | failed:%o",e.t0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(e){return mt.apply(this,arguments)})},{key:"stopLivestream",value:(ht=s()(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return fe.debug("stopLivestream()"),e.prev=1,e.next=4,this._protoo.request("stopLivestream",{});case 4:e.next=10;break;case 6:throw e.prev=6,e.t0=e.catch(1),fe.error("stopLivestream() | failed:%o",e.t0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(){return ht.apply(this,arguments)})},{key:"startWhiteboard",value:(lt=s()(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return fe.debug("startWhiteboard()"),e.prev=1,e.next=4,this._protoo.request("startWhiteboard",{});case 4:e.next=10;break;case 6:throw e.prev=6,e.t0=e.catch(1),fe.error("startWhiteboard() | failed:%o",e.t0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(){return lt.apply(this,arguments)})},{key:"stopWhiteboard",value:(ut=s()(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return fe.debug("stopWhiteboard()"),e.prev=1,e.next=4,this._protoo.request("stopWhiteboard",{});case 4:e.next=10;break;case 6:throw e.prev=6,e.t0=e.catch(1),fe.error("stopWhiteboard() | failed:%o",e.t0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(){return ut.apply(this,arguments)})},{key:"pinStateChange",value:(pt=s()(l.a.mark((function e(t){var r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.peerId,a=t.state,e.prev=1,e.next=4,this._protoo.request("pinStateChanged",{peerId:r,state:a});case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),fe.error("pinStateChange() | failed");case 9:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(e){return pt.apply(this,arguments)})},{key:"startVideo",value:(dt=s()(l.a.mark((function e(t){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.link,fe.debug("startVideo()"),e.prev=2,e.next=5,this._protoo.request("startVideo",{link:r});case 5:e.next=11;break;case 7:throw e.prev=7,e.t0=e.catch(2),fe.error("startVideo() | failed:%o",e.t0),e.t0;case 11:case"end":return e.stop()}}),e,this,[[2,7]])}))),function(e){return dt.apply(this,arguments)})},{key:"stopVideo",value:(ct=s()(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return fe.debug("stopVideo()"),e.prev=1,e.next=4,this._protoo.request("stopVideo",{});case 4:e.next=10;break;case 6:throw e.prev=6,e.t0=e.catch(1),fe.error("stopVideo() | failed:%o",e.t0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(){return ct.apply(this,arguments)})},{key:"pauseVideo",value:(ot=s()(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return fe.debug("pauseVideo()"),e.prev=1,e.next=4,this._protoo.request("pauseVideo",{currentTime:t});case 4:e.next=10;break;case 6:throw e.prev=6,e.t0=e.catch(1),fe.error("pauseVideo() | failed:%o",e.t0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(e){return ot.apply(this,arguments)})},{key:"resumeVideo",value:(st=s()(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return fe.debug("resumeVideo()"),e.prev=1,e.next=4,this._protoo.request("resumeVideo",{});case 4:e.next=10;break;case 6:throw e.prev=6,e.t0=e.catch(1),fe.error("resumeVideo() | failed:%o",e.t0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(){return st.apply(this,arguments)})},{key:"seekVideo",value:(it=s()(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return fe.debug("seekVideo()"),e.prev=1,e.next=4,this._protoo.request("seekVideo",{currentTime:t});case 4:e.next=10;break;case 6:throw e.prev=6,e.t0=e.catch(1),fe.error("seekVideo() | failed:%o",e.t0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(e){return it.apply(this,arguments)})},{key:"enablePeerMic",value:(nt=s()(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return fe.debug("enablePeerMic()"),e.prev=1,e.next=4,this._protoo.request("enablePeerMic",{peerId:t});case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),fe.error("enablePeerMic() | failed:%o",e.t0);case 9:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(e){return nt.apply(this,arguments)})},{key:"disablePeerMic",value:(at=s()(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return fe.debug("disablePeerMic()"),e.prev=1,e.next=4,this._protoo.request("disablePeerMic",{peerId:t});case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),fe.error("disablePeerMic() | failed:%o",e.t0);case 9:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(e){return at.apply(this,arguments)})},{key:"enablePeerWebcam",value:(rt=s()(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return fe.debug("enablePeerWebcam()"),e.prev=1,e.next=4,this._protoo.request("enablePeerWebcam",{peerId:t});case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),fe.error("enablePeerWebcam() | failed:%o",e.t0);case 9:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(e){return rt.apply(this,arguments)})},{key:"disablePeerWebcam",value:(tt=s()(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return fe.debug("disablePeerWebcam()"),e.prev=1,e.next=4,this._protoo.request("disablePeerWebcam",{peerId:t});case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),fe.error("disablePeerWebcam() | failed:%o",e.t0);case 9:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(e){return tt.apply(this,arguments)})},{key:"enableMic",value:(et=s()(l.a.mark((function e(){var t,r,a,n,i=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(fe.debug("enableMic()"),this._micEnabled=!0,!this._micProducer){e.next=4;break}return e.abrupt("return");case 4:if(this._mediasoupDevice.canProduce("audio")){e.next=7;break}return fe.error("enableMic() | cannot produce audio"),e.abrupt("return");case 7:if(e.prev=7,this._externalVideo){e.next=20;break}return fe.debug("enableMic() | calling getUserMedia()"),e.next=12,this._updateMics();case 12:if(this._mic.device){e.next=14;break}throw new Error("no mic devices");case 14:return e.next=16,navigator.mediaDevices.getUserMedia({audio:{deviceId:{ideal:this._mic.device.deviceId},channelCount:1,noiseSuppression:!0,echoCancellation:!0}});case 16:r=e.sent,t=r.getAudioTracks()[0],e.next=24;break;case 20:return e.next=22,this._getExternalVideoStream();case 22:a=e.sent,t=a.getAudioTracks()[0].clone();case 24:return e.next=26,this._sendTransport.produce({track:t,codecOptions:{opusStereo:1,opusDtx:1}});case 26:this._micProducer=e.sent,n=L({id:this._micProducer.id,paused:this._micProducer.paused,track:this._micProducer.track,rtpParameters:this._micProducer.rtpParameters,codec:this._micProducer.rtpParameters.codecs[0].mimeType.split("/")[1],instance:this._micProducer}),oe.dispatch(n),this._eventEmitter.emit(n.type,n.payload),this._micProducer.on("transportclose",(function(){i._micProducer=null})),this._micProducer.on("trackended",(function(){oe.dispatch(te({type:"error",text:"Microphone disconnected!"})),i.disableMic().catch((function(){}))})),e.next=39;break;case 34:e.prev=34,e.t0=e.catch(7),fe.error("enableMic() | failed:%o",e.t0),oe.dispatch(te({type:"error",text:"Error enabling microphone: ".concat(e.t0)})),t&&t.stop();case 39:case"end":return e.stop()}}),e,this,[[7,34]])}))),function(){return et.apply(this,arguments)})},{key:"disableMic",value:(Xe=s()(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(fe.debug("disableMic()"),this._micEnabled=!1,this._micProducer){e.next=4;break}return e.abrupt("return");case 4:return this._micProducer.close(),t=A(this._micProducer.id),oe.dispatch(t),this._eventEmitter.emit(t.type,t.payload),e.prev=8,e.next=11,this._protoo.request("closeProducer",{producerId:this._micProducer.id});case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(8),oe.dispatch(te({type:"error",text:"Error closing server-side mic Producer: ".concat(e.t0)}));case 16:this._micProducer=null;case 17:case"end":return e.stop()}}),e,this,[[8,13]])}))),function(){return Xe.apply(this,arguments)})},{key:"muteMic",value:(Ze=s()(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return fe.debug("muteMic()"),this._micEnabled=!1,this._micProducer.pause(),e.prev=3,e.next=6,this._protoo.request("pauseProducer",{producerId:this._micProducer.id});case 6:oe.dispatch({type:"SET_PRODUCER_PAUSED",payload:{producerId:this._micProducer.id}}),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(3),fe.error("muteMic() | failed: %o",e.t0),oe.dispatch(te({type:"error",text:"Error pausing server-side mic Producer: ".concat(e.t0)}));case 13:case"end":return e.stop()}}),e,this,[[3,9]])}))),function(){return Ze.apply(this,arguments)})},{key:"unmuteMic",value:(Ye=s()(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return fe.debug("unmuteMic()"),this._micEnabled=!0,this._micProducer.resume(),e.prev=3,e.next=6,this._protoo.request("resumeProducer",{producerId:this._micProducer.id});case 6:oe.dispatch({type:"SET_PRODUCER_RESUMED",payload:{producerId:this._micProducer.id}}),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(3),fe.error("unmuteMic() | failed: %o",e.t0),oe.dispatch(te({type:"error",text:"Error resuming server-side mic Producer: ".concat(e.t0)}));case 13:case"end":return e.stop()}}),e,this,[[3,9]])}))),function(){return Ye.apply(this,arguments)})},{key:"enableWebcam",value:(Je=s()(l.a.mark((function e(){var t,r,a,n,i,s,o,c,d,p,u=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(fe.debug("enableWebcam()"),this._webcamEnabled=!0,!this._webcamProducer){e.next=4;break}return e.abrupt("return");case 4:if(this._mediasoupDevice.canProduce("video")){e.next=7;break}return fe.error("enableWebcam() | cannot produce video"),e.abrupt("return");case 7:if(oe.dispatch(V(!0)),e.prev=8,this._externalVideo){e.next=23;break}return e.next=12,this._updateWebcams();case 12:if(r=this._webcam.device,a=this._webcam.resolution,r){e.next=16;break}throw new Error("no webcam devices");case 16:return fe.debug("enableWebcam() | calling getUserMedia()"),e.next=19,navigator.mediaDevices.getUserMedia({video:se({deviceId:{ideal:r.deviceId}},de[a])});case 19:n=e.sent,t=n.getVideoTracks()[0],e.next=28;break;case 23:return r={label:"external video"},e.next=26,this._getExternalVideoStream();case 26:i=e.sent,t=i.getVideoTracks()[0].clone();case 28:if(c={videoGoogleStartBitrate:1e3},!this._forceH264){e.next=35;break}if(o=this._mediasoupDevice.rtpCapabilities.codecs.find((function(e){return"video/h264"===e.mimeType.toLowerCase()}))){e.next=33;break}throw new Error("desired H264 codec+configuration is not supported");case 33:e.next=39;break;case 35:if(!this._forceVP9){e.next=39;break}if(o=this._mediasoupDevice.rtpCapabilities.codecs.find((function(e){return"video/vp9"===e.mimeType.toLowerCase()}))){e.next=39;break}throw new Error("desired VP9 codec+configuration is not supported");case 39:return this._useSimulcast&&(d=this._mediasoupDevice.rtpCapabilities.codecs.find((function(e){return"video"===e.kind})),s=this._forceVP9&&o||"video/vp9"===d.mimeType.toLowerCase()?le:ue[this._webcam.resolution]),e.next=42,this._sendTransport.produce({track:t,encodings:s,codecOptions:c,codec:o});case 42:this._webcamProducer=e.sent,p=L({id:this._webcamProducer.id,deviceLabel:r.label,type:this._getWebcamType(r),paused:this._webcamProducer.paused,track:this._webcamProducer.track,rtpParameters:this._webcamProducer.rtpParameters,codec:this._webcamProducer.rtpParameters.codecs[0].mimeType.split("/")[1],instance:this._webcamProducer}),oe.dispatch(p),this._eventEmitter.emit(p.type,p.payload),this._webcamProducer.on("transportclose",(function(){u._webcamProducer=null})),this._webcamProducer.on("trackended",(function(){oe.dispatch(te({type:"error",text:"Webcam disconnected!"})),u.disableWebcam().catch((function(){}))})),e.next=55;break;case 50:e.prev=50,e.t0=e.catch(8),fe.error("enableWebcam() | failed:%o",e.t0),oe.dispatch(te({type:"error",text:"Error enabling webcam: ".concat(e.t0)})),t&&t.stop();case 55:oe.dispatch(V(!1));case 56:case"end":return e.stop()}}),e,this,[[8,50]])}))),function(){return Je.apply(this,arguments)})},{key:"disableWebcam",value:(Qe=s()(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(fe.debug("disableWebcam()"),this._webcamEnabled=!1,this._webcamProducer){e.next=4;break}return e.abrupt("return");case 4:return this._webcamProducer.close(),t=A(this._webcamProducer.id),oe.dispatch(t),this._eventEmitter.emit(t.type,t.payload),e.prev=8,e.next=11,this._protoo.request("closeProducer",{producerId:this._webcamProducer.id});case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(8),oe.dispatch(te({type:"error",text:"Error closing server-side webcam Producer: ".concat(e.t0)}));case 16:this._webcamProducer=null;case 17:case"end":return e.stop()}}),e,this,[[8,13]])}))),function(){return Qe.apply(this,arguments)})},{key:"getMics",value:(He=s()(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.prev=1,e.next=4,this._updateMics();case 4:this._mics.forEach((function(e,r){t.push({deviceId:r,label:e.label})})),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),fe.error("getMics() | Error",e.t0);case 10:return e.abrupt("return",t);case 11:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(){return He.apply(this,arguments)})},{key:"changeMic",value:(Ke=s()(l.a.mark((function e(t){var r,a,n,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._updateMics();case 3:if(r=Array.from(this._mics.keys()),a=r.length,n=this._mic.device?this._mic.device.deviceId:void 0,null!=t&&null!=t?i=r.indexOf(t):(i=r.indexOf(n))<a-1?i++:i=0,this._mic.device=this._mics.get(r[i]),this._mic.device){e.next=10;break}throw new Error("No mic Found");case 10:return e.next=12,this.disableMic();case 12:return e.next=14,this.enableMic();case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),fe.error("changeMic()| Error");case 19:case"end":return e.stop()}}),e,this,[[0,16]])}))),function(e){return Ke.apply(this,arguments)})},{key:"getWebcams",value:($e=s()(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.prev=1,e.next=4,this._updateWebcams();case 4:this._webcams.forEach((function(e,r){t.push({deviceId:r,label:e.label})})),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),fe.error("getWebcams() | failed %o",e.t0);case 10:return e.abrupt("return",t);case 11:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(){return $e.apply(this,arguments)})},{key:"changeWebcam",value:(ze=s()(l.a.mark((function e(t){var r,a,n,i,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return fe.debug("changeWebcam()"),oe.dispatch(V(!0)),e.prev=2,e.next=5,this._updateWebcams();case 5:if(r=Array.from(this._webcams.keys()),a=r.length,n=this._webcam.device?this._webcam.device.deviceId:void 0,null!=t&&null!=t?i=r.indexOf(t):(i=r.indexOf(n))<a-1?i++:i=0,this._webcam.device=this._webcams.get(r[i]),fe.debug("changeWebcam() | new selected webcam [device:%o]",this._webcam.device),this._webcam.resolution=this._webcam.resolution||"hd",this._webcam.device){e.next=14;break}throw new Error("no webcam devices");case 14:return e.next=16,this.disableWebcam();case 16:return e.next=18,this.enableWebcam();case 18:return e.abrupt("return");case 23:return s=e.sent,o=s.getVideoTracks()[0],e.next=27,this._webcamProducer.replaceTrack({track:o});case 27:oe.dispatch(N(this._webcamProducer.id,o)),e.next=34;break;case 30:e.prev=30,e.t0=e.catch(2),fe.error("changeWebcam() | failed: %o",e.t0),oe.dispatch(te({type:"error",text:"Could not change webcam: ".concat(e.t0)}));case 34:oe.dispatch(V(!1));case 35:case"end":return e.stop()}}),e,this,[[2,30]])}))),function(e){return ze.apply(this,arguments)})},{key:"changeWebcamResolution",value:(Ge=s()(l.a.mark((function e(){var t,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:fe.debug("changeWebcamResolution()"),oe.dispatch(V(!0)),e.prev=2,e.t0=this._webcam.resolution,e.next="qvga"===e.t0?6:"vga"===e.t0?8:"hd"===e.t0?10:12;break;case 6:return this._webcam.resolution="vga",e.abrupt("break",13);case 8:return this._webcam.resolution="hd",e.abrupt("break",13);case 10:return this._webcam.resolution="qvga",e.abrupt("break",13);case 12:this._webcam.resolution="hd";case 13:return fe.debug("changeWebcamResolution() | calling getUserMedia()"),e.next=16,navigator.mediaDevices.getUserMedia({video:se({deviceId:{exact:this._webcam.device.deviceId}},de[this._webcam.resolution])});case 16:return t=e.sent,r=t.getVideoTracks()[0],e.next=20,this._webcamProducer.replaceTrack({track:r});case 20:oe.dispatch(N(this._webcamProducer.id,r)),e.next=27;break;case 23:e.prev=23,e.t1=e.catch(2),fe.error("changeWebcamResolution() | failed: %o",e.t1),oe.dispatch(te({type:"error",text:"Could not change webcam resolution: ".concat(e.t1)}));case 27:oe.dispatch(V(!1));case 28:case"end":return e.stop()}}),e,this,[[2,23]])}))),function(){return Ge.apply(this,arguments)})},{key:"enableShare",value:(qe=s()(l.a.mark((function e(){var t,r,a,n,i,s,o=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(fe.debug("enableShare()"),!this._shareProducer){e.next=3;break}return e.abrupt("return");case 3:if(this._mediasoupDevice.canProduce("video")){e.next=6;break}return fe.error("enableShare() | cannot produce video"),e.abrupt("return");case 6:return oe.dispatch(W(!0)),e.prev=7,fe.debug("enableShare() | calling getUserMedia()"),e.next=11,navigator.mediaDevices.getDisplayMedia({audio:!1,video:{width:{max:1920},height:{max:1080},frameRate:{max:10}}});case 11:if(r=e.sent){e.next=15;break}return oe.dispatch(W(!0)),e.abrupt("return");case 15:if(t=r.getVideoTracks()[0],n={videoGoogleStartBitrate:1e3},!this._forceH264){e.next=23;break}if(a=this._mediasoupDevice.rtpCapabilities.codecs.find((function(e){return"video/h264"===e.mimeType.toLowerCase()}))){e.next=21;break}throw new Error("desired H264 codec+configuration is not supported");case 21:e.next=27;break;case 23:if(!this._forceVP9){e.next=27;break}if(a=this._mediasoupDevice.rtpCapabilities.codecs.find((function(e){return"video/vp9"===e.mimeType.toLowerCase()}))){e.next=27;break}throw new Error("desired VP9 codec+configuration is not supported");case 27:return this._useSharingSimulcast&&(i=this._mediasoupDevice.rtpCapabilities.codecs.find((function(e){return"video"===e.kind})),this._forceVP9&&a||"video/vp9"===i.mimeType.toLowerCase()||he.map((function(e){return se(se({},e),{},{dtx:!0})}))),e.next=30,this._sendTransport.produce({track:t,codecOptions:n,codec:a,appData:{share:!0}});case 30:this._shareProducer=e.sent,s=L({id:this._shareProducer.id,type:"share",paused:this._shareProducer.paused,track:this._shareProducer.track,rtpParameters:this._shareProducer.rtpParameters,codec:this._shareProducer.rtpParameters.codecs[0].mimeType.split("/")[1],appData:{share:!0},instance:this._shareProducer}),oe.dispatch(s),this._eventEmitter.emit(s.type,s.payload),this._shareProducer.on("transportclose",(function(){o._shareProducer=null})),this._shareProducer.on("trackended",(function(){oe.dispatch(te({type:"error",text:"Share disconnected!"})),o.disableShare().catch((function(){}))})),e.next=43;break;case 38:e.prev=38,e.t0=e.catch(7),fe.error("enableShare() | failed:%o",e.t0),"NotAllowedError"!==e.t0.name&&oe.dispatch(te({type:"error",text:"Error sharing: ".concat(e.t0)})),t&&t.stop();case 43:oe.dispatch(W(!1));case 44:case"end":return e.stop()}}),e,this,[[7,38]])}))),function(){return qe.apply(this,arguments)})},{key:"disableShare",value:(Ue=s()(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(fe.debug("disableShare()"),this._shareProducer){e.next=3;break}return e.abrupt("return");case 3:return this._shareProducer.close(),t=A(this._shareProducer.id),oe.dispatch(t),this._eventEmitter.emit(t.type,t.payload),e.prev=7,e.next=10,this._protoo.request("closeProducer",{producerId:this._shareProducer.id});case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(7),oe.dispatch(te({type:"error",text:"Error closing server-side share Producer: ".concat(e.t0)}));case 15:this._shareProducer=null;case 16:case"end":return e.stop()}}),e,this,[[7,12]])}))),function(){return Ue.apply(this,arguments)})},{key:"enableAudioOnly",value:(We=s()(l.a.mark((function e(){var t,r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:fe.debug("enableAudioOnly()"),oe.dispatch(I(!0)),this.disableWebcam(),t=ae(this._consumers.values()),e.prev=4,t.s();case 6:if((r=t.n()).done){e.next=13;break}if("video"===(a=r.value).kind){e.next=10;break}return e.abrupt("continue",11);case 10:this._pauseConsumer(a);case 11:e.next=6;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(4),t.e(e.t0);case 18:return e.prev=18,t.f(),e.finish(18);case 21:oe.dispatch(D(!0)),oe.dispatch(I(!1));case 23:case"end":return e.stop()}}),e,this,[[4,15,18,21]])}))),function(){return We.apply(this,arguments)})},{key:"disableAudioOnly",value:(Ve=s()(l.a.mark((function e(){var t,r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:fe.debug("disableAudioOnly()"),oe.dispatch(I(!0)),!this._webcamProducer&&this._produce&&(C()||{}).webcamEnabled&&this.enableWebcam(),t=ae(this._consumers.values()),e.prev=4,t.s();case 6:if((r=t.n()).done){e.next=13;break}if("video"===(a=r.value).kind){e.next=10;break}return e.abrupt("continue",11);case 10:this._resumeConsumer(a);case 11:e.next=6;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(4),t.e(e.t0);case 18:return e.prev=18,t.f(),e.finish(18);case 21:oe.dispatch(D(!1)),oe.dispatch(I(!1));case 23:case"end":return e.stop()}}),e,this,[[4,15,18,21]])}))),function(){return Ve.apply(this,arguments)})},{key:"muteAudio",value:(Be=s()(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:fe.debug("muteAudio()"),oe.dispatch(M(!0));case 2:case"end":return e.stop()}}),e)}))),function(){return Be.apply(this,arguments)})},{key:"unmuteAudio",value:(Fe=s()(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:fe.debug("unmuteAudio()"),oe.dispatch(M(!1));case 2:case"end":return e.stop()}}),e)}))),function(){return Fe.apply(this,arguments)})},{key:"restartIce",value:(Ne=s()(l.a.mark((function e(){var t,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(fe.debug("restartIce()"),oe.dispatch(j(!0)),e.prev=2,!this._sendTransport){e.next=9;break}return e.next=6,this._protoo.request("restartIce",{transportId:this._sendTransport.id});case 6:return t=e.sent,e.next=9,this._sendTransport.restartIce({iceParameters:t});case 9:if(!this._recvTransport){e.next=15;break}return e.next=12,this._protoo.request("restartIce",{transportId:this._recvTransport.id});case 12:return r=e.sent,e.next=15,this._recvTransport.restartIce({iceParameters:r});case 15:oe.dispatch(te({text:"ICE restarted"})),e.next=22;break;case 18:e.prev=18,e.t0=e.catch(2),fe.error("restartIce() | failed:%o",e.t0),oe.dispatch(te({type:"error",text:"ICE restart failed: ".concat(e.t0)}));case 22:oe.dispatch(j(!1));case 23:case"end":return e.stop()}}),e,this,[[2,18]])}))),function(){return Ne.apply(this,arguments)})},{key:"setMaxSendingSpatialLayer",value:(Ae=s()(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(fe.debug("setMaxSendingSpatialLayer() [spatialLayer:%s]",t),e.prev=1,!this._webcamProducer){e.next=7;break}return e.next=5,this._webcamProducer.setMaxSpatialLayer(t);case 5:e.next=10;break;case 7:if(!this._shareProducer){e.next=10;break}return e.next=10,this._shareProducer.setMaxSpatialLayer(t);case 10:e.next=16;break;case 12:e.prev=12,e.t0=e.catch(1),fe.error("setMaxSendingSpatialLayer() | failed:%o",e.t0),oe.dispatch(te({type:"error",text:"Error setting max sending video spatial layer: ".concat(e.t0)}));case 16:case"end":return e.stop()}}),e,this,[[1,12]])}))),function(e){return Ae.apply(this,arguments)})},{key:"setWebcamQuality",value:(Le=s()(l.a.mark((function e(t){var r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._webcamProducer){e.next=2;break}return e.abrupt("return");case 2:if(r=this._webcam.resolution,a=ce[r][t].s,this._webcamProducer.maxSpatialLayer!=a){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,this._webcamProducer.setMaxSpatialLayer(a);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return Le.apply(this,arguments)})},{key:"setConsumerQuality",value:(je=s()(l.a.mark((function e(t,r){var a,n,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this._webcam.resolution,n=ce[a][r].s,i=ce[a][r].t,e.next=5,this.setConsumerPreferredLayers(t,n,i);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return je.apply(this,arguments)})},{key:"setConsumerPreferredLayers",value:(Me=s()(l.a.mark((function e(t,r,a){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return fe.debug("setConsumerPreferredLayers() [consumerId:%s, spatialLayer:%s, temporalLayer:%s]",t,r,a),e.prev=1,e.next=4,this._protoo.request("setConsumerPreferredLayers",{consumerId:t,spatialLayer:r,temporalLayer:a});case 4:oe.dispatch(J(t,r,a)),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(1),fe.error("setConsumerPreferredLayers() | failed:%o",e.t0),oe.dispatch(te({type:"error",text:"Error setting Consumer preferred layers: ".concat(e.t0)}));case 11:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(e,t,r){return Me.apply(this,arguments)})},{key:"setConsumerPriority",value:(Ie=s()(l.a.mark((function e(t,r){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return fe.debug("setConsumerPriority() [consumerId:%s, priority:%d]",t,r),e.prev=1,e.next=4,this._protoo.request("setConsumerPriority",{consumerId:t,priority:r});case 4:oe.dispatch(Y(t,r)),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(1),fe.error("setConsumerPriority() | failed:%o",e.t0),oe.dispatch(te({type:"error",text:"Error setting Consumer priority: ".concat(e.t0)}));case 11:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(e,t){return Ie.apply(this,arguments)})},{key:"requestConsumerKeyFrame",value:(De=s()(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return fe.debug("requestConsumerKeyFrame() [consumerId:%s]",t),e.prev=1,e.next=4,this._protoo.request("requestConsumerKeyFrame",{consumerId:t});case 4:oe.dispatch(te({text:"Keyframe requested for video consumer"})),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(1),fe.error("requestConsumerKeyFrame() | failed:%o",e.t0),oe.dispatch(te({type:"error",text:"Error requesting key frame for Consumer: ".concat(e.t0)}));case 11:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(e){return De.apply(this,arguments)})},{key:"enableChatDataProducer",value:(Oe=s()(l.a.mark((function e(){var t=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(fe.debug("enableChatDataProducer()"),this._useDataChannel){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,e.next=6,this._sendTransport.produceData({ordered:!1,maxRetransmits:1,label:"chat",priority:"medium",appData:{info:"my-chat-DataProducer"}});case 6:this._chatDataProducer=e.sent,oe.dispatch(B({id:this._chatDataProducer.id,sctpStreamParameters:this._chatDataProducer.sctpStreamParameters,label:this._chatDataProducer.label,protocol:this._chatDataProducer.protocol})),this._chatDataProducer.on("transportclose",(function(){t._chatDataProducer=null})),this._chatDataProducer.on("open",(function(){fe.debug('chat DataProducer "open" event')})),this._chatDataProducer.on("close",(function(){fe.error('chat DataProducer "close" event'),t._chatDataProducer=null,oe.dispatch(te({type:"error",text:"Chat DataProducer closed"}))})),this._chatDataProducer.on("error",(function(e){fe.error('chat DataProducer "error" event:%o',e),oe.dispatch(te({type:"error",text:"Chat DataProducer error: ".concat(e)}))})),this._chatDataProducer.on("bufferedamountlow",(function(){fe.debug('chat DataProducer "bufferedamountlow" event')})),e.next=20;break;case 15:throw e.prev=15,e.t0=e.catch(3),fe.error("enableChatDataProducer() | failed:%o",e.t0),oe.dispatch(te({type:"error",text:"Error enabling chat DataProducer: ".concat(e.t0)})),e.t0;case 20:case"end":return e.stop()}}),e,this,[[3,15]])}))),function(){return Oe.apply(this,arguments)})},{key:"enableBotDataProducer",value:(xe=s()(l.a.mark((function e(){var t=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(fe.debug("enableBotDataProducer()"),this._useDataChannel){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,e.next=6,this._sendTransport.produceData({ordered:!1,maxPacketLifeTime:2e3,label:"bot",priority:"medium",appData:{info:"my-bot-DataProducer"}});case 6:this._botDataProducer=e.sent,oe.dispatch(B({id:this._botDataProducer.id,sctpStreamParameters:this._botDataProducer.sctpStreamParameters,label:this._botDataProducer.label,protocol:this._botDataProducer.protocol})),this._botDataProducer.on("transportclose",(function(){t._botDataProducer=null})),this._botDataProducer.on("open",(function(){fe.debug('bot DataProducer "open" event')})),this._botDataProducer.on("close",(function(){fe.error('bot DataProducer "close" event'),t._botDataProducer=null,oe.dispatch(te({type:"error",text:"Bot DataProducer closed"}))})),this._botDataProducer.on("error",(function(e){fe.error('bot DataProducer "error" event:%o',e),oe.dispatch(te({type:"error",text:"Bot DataProducer error: ".concat(e)}))})),this._botDataProducer.on("bufferedamountlow",(function(){fe.debug('bot DataProducer "bufferedamountlow" event')})),e.next=20;break;case 15:throw e.prev=15,e.t0=e.catch(3),fe.error("enableBotDataProducer() | failed:%o",e.t0),oe.dispatch(te({type:"error",text:"Error enabling bot DataProducer: ".concat(e.t0)})),e.t0;case 20:case"end":return e.stop()}}),e,this,[[3,15]])}))),function(){return xe.apply(this,arguments)})},{key:"sendChatMessage",value:(Te=s()(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(fe.debug('sendChatMessage() [text:"%s]',t),this._chatDataProducer){e.next=4;break}return oe.dispatch(te({type:"error",text:"No chat DataProducer"})),e.abrupt("return");case 4:try{this._chatDataProducer.send(t)}catch(e){fe.error("chat DataProducer.send() failed:%o",e),oe.dispatch(te({type:"error",text:"chat DataProducer.send() failed: ".concat(e)}))}case 5:case"end":return e.stop()}}),e,this)}))),function(e){return Te.apply(this,arguments)})},{key:"sendBotMessage",value:(Ee=s()(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(fe.debug('sendBotMessage() [text:"%s]',t),this._botDataProducer){e.next=4;break}return oe.dispatch(te({type:"error",text:"No bot DataProducer"})),e.abrupt("return");case 4:try{this._botDataProducer.send(t)}catch(e){fe.error("bot DataProducer.send() failed:%o",e),oe.dispatch(te({type:"error",text:"bot DataProducer.send() failed: ".concat(e)}))}case 5:case"end":return e.stop()}}),e,this)}))),function(e){return Ee.apply(this,arguments)})},{key:"changeDisplayName",value:(ke=s()(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return fe.debug('changeDisplayName() [displayName:"%s"]',t),R({displayName:t}),e.prev=2,e.next=5,this._protoo.request("changeDisplayName",{displayName:t});case 5:this._displayName=t,oe.dispatch(O(t)),oe.dispatch(te({text:"Display name changed"})),e.next=15;break;case 10:e.prev=10,e.t0=e.catch(2),fe.error("changeDisplayName() | failed: %o",e.t0),oe.dispatch(te({type:"error",text:"Could not change display name: ".concat(e.t0)})),oe.dispatch(O());case 15:case"end":return e.stop()}}),e,this,[[2,10]])}))),function(e){return ke.apply(this,arguments)})},{key:"openConnection",value:(Ce=s()(l.a.mark((function e(t){var r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.roomId,a=t.payload,e.next=3,this._protoo.request("openConnection",{roomId:r,payload:a}).catch((function(e){throw new Error(e)}));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return Ce.apply(this,arguments)})},{key:"closeConnection",value:(Re=s()(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._protoo.request("closeConnection",{roomId:t});case 2:case"end":return e.stop()}}),e,this)}))),function(e){return Re.apply(this,arguments)})},{key:"switchTo",value:(Pe=s()(l.a.mark((function e(t){var r,a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.roomId,a=t.peerIds,n=t.payload,e.next=3,this._protoo.request("requestSwitchRoom",{roomId:r,peerIds:a,payload:n});case 3:case"end":return e.stop()}}),e,this)}))),function(e){return Pe.apply(this,arguments)})},{key:"switchPeerRoom",value:(Se=s()(l.a.mark((function e(t){var r,a,n,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.peerId,a=t.roomId,n=t.payload,i=t.token,e.next=3,this._protoo.request("switchPeerRoom",{roomId:a,peerId:r,payload:n,token:i});case 3:case"end":return e.stop()}}),e,this)}))),function(e){return Se.apply(this,arguments)})},{key:"connectionSwitchPeerRoom",value:(we=s()(l.a.mark((function e(t){var r,a,n,i,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.roomId,a=t.connectionRoomId,n=t.peerId,i=t.payload,s=t.token,e.next=3,this._protoo.request("connectionSwitchPeerRoom",{roomId:r,connectionRoomId:a,peerId:n,payload:i,token:s});case 3:case"end":return e.stop()}}),e,this)}))),function(e){return we.apply(this,arguments)})},{key:"connectionSendChatMessage",value:(ye=s()(l.a.mark((function e(t){var r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.roomId,a=t.message,e.next=3,this._protoo.request("connectionSendChatMessage",{roomId:r,message:a});case 3:case"end":return e.stop()}}),e,this)}))),function(e){return ye.apply(this,arguments)})},{key:"connectionEndMeeting",value:(be=s()(l.a.mark((function e(t){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.roomId,e.next=3,this._protoo.request("connectionCloseRoom",{roomId:r});case 3:case"end":return e.stop()}}),e,this)}))),function(e){return be.apply(this,arguments)})},{key:"closeRoom",value:(ve=s()(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._protoo.request("closeRoom",{});case 2:case"end":return e.stop()}}),e,this)}))),function(){return ve.apply(this,arguments)})},{key:"removePeer",value:(_e=s()(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this._protoo.request("removePeer",{peerId:t});case 4:case"end":return e.stop()}}),e,this)}))),function(e){return _e.apply(this,arguments)})},{key:"getSendTransportRemoteStats",value:(ge=s()(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(fe.debug("getSendTransportRemoteStats()"),this._sendTransport){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",this._protoo.request("getTransportStats",{transportId:this._sendTransport.id}));case 4:case"end":return e.stop()}}),e,this)}))),function(){return ge.apply(this,arguments)})},{key:"getRecvTransportRemoteStats",value:(ie=s()(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(fe.debug("getRecvTransportRemoteStats()"),this._recvTransport){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",this._protoo.request("getTransportStats",{transportId:this._recvTransport.id}));case 4:case"end":return e.stop()}}),e,this)}))),function(){return ie.apply(this,arguments)})},{key:"getAudioRemoteStats",value:(ne=s()(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(fe.debug("getAudioRemoteStats()"),this._micProducer){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",this._protoo.request("getProducerStats",{producerId:this._micProducer.id}));case 4:case"end":return e.stop()}}),e,this)}))),function(){return ne.apply(this,arguments)})},{key:"getVideoRemoteStats",value:(E=s()(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(fe.debug("getVideoRemoteStats()"),t=this._webcamProducer||this._shareProducer){e.next=4;break}return e.abrupt("return");case 4:return e.abrupt("return",this._protoo.request("getProducerStats",{producerId:t.id}));case 5:case"end":return e.stop()}}),e,this)}))),function(){return E.apply(this,arguments)})},{key:"getConsumerRemoteStats",value:(k=s()(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(fe.debug("getConsumerRemoteStats()"),this._consumers.get(t)){e.next=4;break}return e.abrupt("return");case 4:return e.abrupt("return",this._protoo.request("getConsumerStats",{consumerId:t}));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return k.apply(this,arguments)})},{key:"getChatDataProducerRemoteStats",value:(P=s()(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(fe.debug("getChatDataProducerRemoteStats()"),t=this._chatDataProducer){e.next=4;break}return e.abrupt("return");case 4:return e.abrupt("return",this._protoo.request("getDataProducerStats",{dataProducerId:t.id}));case 5:case"end":return e.stop()}}),e,this)}))),function(){return P.apply(this,arguments)})},{key:"getBotDataProducerRemoteStats",value:(S=s()(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(fe.debug("getBotDataProducerRemoteStats()"),t=this._botDataProducer){e.next=4;break}return e.abrupt("return");case 4:return e.abrupt("return",this._protoo.request("getDataProducerStats",{dataProducerId:t.id}));case 5:case"end":return e.stop()}}),e,this)}))),function(){return S.apply(this,arguments)})},{key:"getDataConsumerRemoteStats",value:(w=s()(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(fe.debug("getDataConsumerRemoteStats()"),this._dataConsumers.get(t)){e.next=4;break}return e.abrupt("return");case 4:return e.abrupt("return",this._protoo.request("getDataConsumerStats",{dataConsumerId:t}));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return w.apply(this,arguments)})},{key:"getSendTransportLocalStats",value:(y=s()(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(fe.debug("getSendTransportLocalStats()"),this._sendTransport){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",this._sendTransport.getStats());case 4:case"end":return e.stop()}}),e,this)}))),function(){return y.apply(this,arguments)})},{key:"getRecvTransportLocalStats",value:(b=s()(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(fe.debug("getRecvTransportLocalStats()"),this._recvTransport){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",this._recvTransport.getStats());case 4:case"end":return e.stop()}}),e,this)}))),function(){return b.apply(this,arguments)})},{key:"getAudioLocalStats",value:(v=s()(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(fe.debug("getAudioLocalStats()"),this._micProducer){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",this._micProducer.getStats());case 4:case"end":return e.stop()}}),e,this)}))),function(){return v.apply(this,arguments)})},{key:"getVideoLocalStats",value:(_=s()(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(fe.debug("getVideoLocalStats()"),t=this._webcamProducer||this._shareProducer){e.next=4;break}return e.abrupt("return");case 4:return e.abrupt("return",t.getStats());case 5:case"end":return e.stop()}}),e,this)}))),function(){return _.apply(this,arguments)})},{key:"getConsumerLocalStats",value:(g=s()(l.a.mark((function e(t){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this._consumers.get(t)){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",r.getStats());case 4:case"end":return e.stop()}}),e,this)}))),function(e){return g.apply(this,arguments)})},{key:"applyNetworkThrottle",value:(h=s()(l.a.mark((function e(t){var r,a,n,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.uplink,a=t.downlink,n=t.rtt,i=t.secret,fe.debug("applyNetworkThrottle() [uplink:%s, downlink:%s, rtt:%s]",r,a,n),e.prev=2,e.next=5,this._protoo.request("applyNetworkThrottle",{uplink:r,downlink:a,rtt:n,secret:i});case 5:e.next=11;break;case 7:e.prev=7,e.t0=e.catch(2),fe.error("applyNetworkThrottle() | failed:%o",e.t0),oe.dispatch(te({type:"error",text:"Error applying network throttle: ".concat(e.t0)}));case 11:case"end":return e.stop()}}),e,this,[[2,7]])}))),function(e){return h.apply(this,arguments)})},{key:"resetNetworkThrottle",value:(u=s()(l.a.mark((function e(t){var r,a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.silent,a=void 0!==r&&r,n=t.secret,fe.debug("resetNetworkThrottle()"),e.prev=2,e.next=5,this._protoo.request("resetNetworkThrottle",{secret:n});case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),a||(fe.error("resetNetworkThrottle() | failed:%o",e.t0),oe.dispatch(te({type:"error",text:"Error resetting network throttle: ".concat(e.t0)})));case 10:case"end":return e.stop()}}),e,this,[[2,7]])}))),function(e){return u.apply(this,arguments)})},{key:"joinRoom",value:(d=s()(l.a.mark((function e(){var t,r,a,n,i,o,c,d,p,u,h,m,g,_,v,b,y,w,S,P,R,k,E,x,O=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return fe.debug("joinRoom()"),e.prev=1,this._mediasoupDevice=new f.Device({handlerName:this._handlerName}),e.next=5,this._protoo.request("getRouterRtpCapabilities");case 5:return t=e.sent,e.next=8,this._mediasoupDevice.load({routerRtpCapabilities:t});case 8:if(!this._produce){e.next=17;break}return e.next=11,this._protoo.request("createWebRtcTransport",{forceTcp:this._forceTcp,producing:!0,consuming:!1,sctpCapabilities:this._useDataChannel?this._mediasoupDevice.sctpCapabilities:void 0});case 11:r=e.sent,a=r.id,n=r.iceParameters,i=r.iceCandidates,o=r.dtlsParameters,c=r.sctpParameters,this._sendTransport=this._mediasoupDevice.createSendTransport({id:a,iceParameters:n,iceCandidates:i,dtlsParameters:o,sctpParameters:c,iceServers:[],proprietaryConstraints:pe}),this._sendTransport.on("connect",(function(e,t,r){var a=e.dtlsParameters;O._protoo.request("connectWebRtcTransport",{transportId:O._sendTransport.id,dtlsParameters:a}).then(t).catch(r)})),this._sendTransport.on("produce",function(){var e=s()(l.a.mark((function e(t,r,a){var n,i,s,o,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.kind,i=t.rtpParameters,s=t.appData,e.prev=1,e.next=4,O._protoo.request("produce",{transportId:O._sendTransport.id,kind:n,rtpParameters:i,appData:s});case 4:o=e.sent,c=o.id,r({id:c}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),a(e.t0);case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t,r,a){return e.apply(this,arguments)}}()),this._sendTransport.on("producedata",function(){var e=s()(l.a.mark((function e(t,r,a){var n,i,s,o,c,d;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.sctpStreamParameters,i=t.label,s=t.protocol,o=t.appData,fe.debug('"producedata" event: [sctpStreamParameters:%o, appData:%o]',n,o),e.prev=2,e.next=5,O._protoo.request("produceData",{transportId:O._sendTransport.id,sctpStreamParameters:n,label:i,protocol:s,appData:o});case 5:c=e.sent,d=c.id,r({id:d}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),a(e.t0);case 13:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(t,r,a){return e.apply(this,arguments)}}());case 17:if(!this._consume){e.next=24;break}return e.next=20,this._protoo.request("createWebRtcTransport",{forceTcp:this._forceTcp,producing:!1,consuming:!0,sctpCapabilities:this._useDataChannel?this._mediasoupDevice.sctpCapabilities:void 0});case 20:d=e.sent,p=d.id,u=d.iceParameters,h=d.iceCandidates,m=d.dtlsParameters,g=d.sctpParameters,this._recvTransport=this._mediasoupDevice.createRecvTransport({id:p,iceParameters:u,iceCandidates:h,dtlsParameters:m,sctpParameters:g,iceServers:[]}),this._recvTransport.on("connect",(function(e,t,r){var a=e.dtlsParameters;O._protoo.request("connectWebRtcTransport",{transportId:O._recvTransport.id,dtlsParameters:a}).then(t).catch(r)}));case 24:return e.next=26,this._protoo.request("join",{displayName:this._displayName,device:this._device,secret:this._secret,rtpCapabilities:this._consume?this._mediasoupDevice.rtpCapabilities:void 0,sctpCapabilities:this._useDataChannel&&this._consume?this._mediasoupDevice.sctpCapabilities:void 0});case 26:_=e.sent,v=_.peers,b=_.poll,y=_.messages,oe.dispatch(T("connected")),this._eventEmitter.emit("MEETING_JOINED",{peers:v,poll:b,messages:y}),oe.dispatch({type:"REMOVE_ALL_NOTIFICATIONS"}),oe.dispatch(te({text:"You are in the room!",timeout:3e3})),w=ae(v);try{for(w.s();!(S=w.n()).done;)P=S.value,R=U(se(se({},P),{},{consumers:[],dataConsumers:[]})),oe.dispatch(R),this._eventEmitter.emit(R.type,R.payload)}catch(e){w.e(e)}finally{w.f()}this._produce&&(oe.dispatch({type:"SET_MEDIA_CAPABILITIES",payload:{canSendMic:(D={canSendMic:this._mediasoupDevice.canProduce("audio"),canSendWebcam:this._mediasoupDevice.canProduce("video")}).canSendMic,canSendWebcam:D.canSendWebcam}}),this._micEnabled&&this.enableMic(),k=C(),this._webcamEnabled&&(!k||k.webcamEnabled||this._externalVideo)&&this.enableWebcam(),this.enableChatDataProducer()),this._usageInterval=setInterval((function(){return O._updateUsageStats()}),1e3*this._usageIntervalDuration),window.SHOW_INFO&&(E=oe.getState(),x=E.me,oe.dispatch({type:"SET_ROOM_STATS_PEER_ID",payload:{peerId:x.id}})),e.next=46;break;case 41:e.prev=41,e.t0=e.catch(1),fe.error("joinRoom() failed:%o",e.t0),oe.dispatch(te({type:"error",text:"Could not join the room: ".concat(e.t0)})),this.close();case 46:case"end":return e.stop()}var D}),e,this,[[1,41]])}))),function(){return d.apply(this,arguments)})},{key:"_updateUsageStats",value:(o=s()(l.a.mark((function e(){var t,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={360:0,720:0,1080:0},r=0,this._consumers.forEach((function(e,a){if("video"!=e.kind||e.paused)"audio"!=e.kind||e.paused||r++;else{var n=e._track.getSettings();n.height<=360?t[360]++:n.height<=720?t[720]++:t[1080]++}})),t[360]*=this._usageIntervalDuration,t[720]*=this._usageIntervalDuration,t[1080]*=this._usageIntervalDuration,e.next=8,this._protoo.request("updateUsageStats",{video:{duration:t},audio:{duration:r*this._usageIntervalDuration}});case 8:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"_updateMics",value:(i=s()(l.a.mark((function e(){var t,r,a,n,i,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._mics=new Map,fe.debug("_updateMics() |"),e.next=4,navigator.mediaDevices.enumerateDevices();case 4:t=e.sent,r=ae(t);try{for(r.s();!(a=r.n()).done;)"audioinput"==(n=a.value).kind&&this._mics.set(n.deviceId,n)}catch(e){r.e(e)}finally{r.f()}i=Array.from(this._mics.values()),s=i.length,o=this._mic.device?this._mic.device.deviceId:void 0,0===s?this._mic.device=null:this._mics.has(o)||(this._mic.device=i[0]);case 11:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"_updateWebcams",value:(n=s()(l.a.mark((function e(){var t,r,a,n,i,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return fe.debug("_updateWebcams()"),this._webcams=new Map,fe.debug("_updateWebcams() | calling enumerateDevices()"),e.next=5,navigator.mediaDevices.enumerateDevices();case 5:t=e.sent,r=ae(t),e.prev=7,r.s();case 9:if((a=r.n()).done){e.next=16;break}if("videoinput"===(n=a.value).kind){e.next=13;break}return e.abrupt("continue",14);case 13:this._webcams.set(n.deviceId,n);case 14:e.next=9;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(7),r.e(e.t0);case 21:return e.prev=21,r.f(),e.finish(21);case 24:i=Array.from(this._webcams.values()),s=i.length,o=this._webcam.device?this._webcam.device.deviceId:void 0,fe.debug("_updateWebcams() [webcams:%o]",i),0===s?this._webcam.device=null:this._webcams.has(o)||(this._webcam.device=i[0]),oe.dispatch({type:"SET_CAN_CHANGE_WEBCAM",payload:this._webcams.size>1});case 30:case"end":return e.stop()}}),e,this,[[7,18,21,24]])}))),function(){return n.apply(this,arguments)})},{key:"_getWebcamType",value:function(e){return/(back|rear)/i.test(e.label)?(fe.debug("_getWebcamType() | it seems to be a back camera"),"back"):(fe.debug("_getWebcamType() | it seems to be a front camera"),"front")}},{key:"_pauseConsumer",value:(a=s()(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.paused){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,this._protoo.request("pauseConsumer",{consumerId:t.id});case 5:t.pause(),oe.dispatch(K(t.id,"local")),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(2),fe.error("_pauseConsumer() | failed:%o",e.t0),oe.dispatch(te({type:"error",text:"Error pausing Consumer: ".concat(e.t0)}));case 13:case"end":return e.stop()}}),e,this,[[2,9]])}))),function(e){return a.apply(this,arguments)})},{key:"_resumeConsumer",value:(r=s()(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.paused){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,this._protoo.request("resumeConsumer",{consumerId:t.id});case 5:t.resume(),oe.dispatch(H(t.id,"local")),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(2),fe.error("_resumeConsumer() | failed:%o",e.t0),oe.dispatch(te({type:"error",text:"Error resuming Consumer: ".concat(e.t0)}));case 13:case"end":return e.stop()}}),e,this,[[2,9]])}))),function(e){return r.apply(this,arguments)})},{key:"_getExternalVideoStream",value:(t=s()(l.a.mark((function e(){var t=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._externalVideoStream){e.next=2;break}return e.abrupt("return",this._externalVideoStream);case 2:if(!(this._externalVideo.readyState<3)){e.next=5;break}return e.next=5,new Promise((function(e){return t._externalVideo.addEventListener("canplay",e)}));case 5:if(!this._externalVideo.captureStream){e.next=9;break}this._externalVideoStream=this._externalVideo.captureStream(),e.next=14;break;case 9:if(!this._externalVideo.mozCaptureStream){e.next=13;break}this._externalVideoStream=this._externalVideo.mozCaptureStream(),e.next=14;break;case 13:throw new Error("video.captureStream() not supported");case 14:return e.abrupt("return",this._externalVideoStream);case 15:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}],[{key:"init",value:function(e){oe=e.store}}]),e}()},function(e,t,r){"use strict";e.exports=function(e){var t,r,a="",n=(e=function(e){return e||(e={}),{length:e.length||8,numeric:"boolean"!=typeof e.numeric||e.numeric,letters:"boolean"!=typeof e.letters||e.letters,special:"boolean"==typeof e.special&&e.special,exclude:Array.isArray(e.exclude)?e.exclude:[]}}(e)).length,i=(e.exclude,function(e){var t="";e.numeric&&(t+="0123456789"),e.letters&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"),e.special&&(t+="!$%^&*()_+|~-=`{}[]:;<>?,./");for(var r=0;r<=e.exclude.length;r++)t=t.replace(e.exclude[r],"");return t}(e));for(t=1;t<=n;t++)a+=i.substring(r=Math.floor(Math.random()*i.length),r+1);return a}},function(e,t,r){var a,n;!function(i){if(void 0===(n="function"==typeof(a=i)?a.call(t,r,t,e):a)||(e.exports=n),!0,e.exports=i(),!!0){var s=window.Cookies,o=window.Cookies=i();o.noConflict=function(){return window.Cookies=s,o}}}((function(){function e(){for(var e=0,t={};e<arguments.length;e++){var r=arguments[e];for(var a in r)t[a]=r[a]}return t}function t(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function r(a){function n(){}function i(t,r,i){if("undefined"!=typeof document){"number"==typeof(i=e({path:"/"},n.defaults,i)).expires&&(i.expires=new Date(1*new Date+864e5*i.expires)),i.expires=i.expires?i.expires.toUTCString():"";try{var s=JSON.stringify(r);/^[\{\[]/.test(s)&&(r=s)}catch(e){}r=a.write?a.write(r,t):encodeURIComponent(String(r)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var o="";for(var c in i)i[c]&&(o+="; "+c,!0!==i[c]&&(o+="="+i[c].split(";")[0]));return document.cookie=t+"="+r+o}}function s(e,r){if("undefined"!=typeof document){for(var n={},i=document.cookie?document.cookie.split("; "):[],s=0;s<i.length;s++){var o=i[s].split("="),c=o.slice(1).join("=");r||'"'!==c.charAt(0)||(c=c.slice(1,-1));try{var d=t(o[0]);if(c=(a.read||a)(c,d)||t(c),r)try{c=JSON.parse(c)}catch(e){}if(n[d]=c,e===d)break}catch(e){}}return e?n[e]:n}}return n.set=i,n.get=function(e){return s(e,!1)},n.getJSON=function(e){return s(e,!0)},n.remove=function(t,r){i(t,"",e(r,{expires:-1}))},n.defaults={},n.withConverter=r,n}((function(){}))}))},function(e,t,r){const a=r(12),n="protoo-client";e.exports=class{constructor(e){e?(this._debug=a(`${n}:${e}`),this._warn=a(`${n}:WARN:${e}`),this._error=a(`${n}:ERROR:${e}`)):(this._debug=a(n),this._warn=a(`${n}:WARN`),this._error=a(`${n}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addLegacySimulcast=t.getRtpEncodings=void 0,t.getRtpEncodings=function({offerMediaObject:e}){const t=new Set;for(const r of e.ssrcs||[]){const e=r.id;t.add(e)}if(0===t.size)throw new Error("no a=ssrc lines found");const r=new Map;for(const a of e.ssrcGroups||[]){if("FID"!==a.semantics)continue;let[e,n]=a.ssrcs.split(/\s+/);e=Number(e),n=Number(n),t.has(e)&&(t.delete(e),t.delete(n),r.set(e,n))}for(const e of t)r.set(e,null);const a=[];for(const[e,t]of r){const r={ssrc:e};t&&(r.rtx={ssrc:t}),a.push(r)}return a},t.addLegacySimulcast=function({offerMediaObject:e,numStreams:t}){if(t<=1)throw new TypeError("numStreams must be greater than 1");const r=(e.ssrcs||[]).find((e=>"msid"===e.attribute));if(!r)throw new Error("a=ssrc line with msid information not found");const[a,n]=r.value.split(" "),i=r.id;let s;(e.ssrcGroups||[]).some((e=>{if("FID"!==e.semantics)return!1;const t=e.ssrcs.split(/\s+/);return Number(t[0])===i&&(s=Number(t[1]),!0)}));const o=e.ssrcs.find((e=>"cname"===e.attribute));if(!o)throw new Error("a=ssrc line with cname information not found");const c=o.value,d=[],p=[];for(let e=0;e<t;++e)d.push(i+e),s&&p.push(s+e);e.ssrcGroups=[],e.ssrcs=[],e.ssrcGroups.push({semantics:"SIM",ssrcs:d.join(" ")});for(let t=0;t<d.length;++t){const r=d[t];e.ssrcs.push({id:r,attribute:"cname",value:c}),e.ssrcs.push({id:r,attribute:"msid",value:`${a} ${n}`})}for(let t=0;t<p.length;++t){const r=d[t],i=p[t];e.ssrcs.push({id:i,attribute:"cname",value:c}),e.ssrcs.push({id:i,attribute:"msid",value:`${a} ${n}`}),e.ssrcGroups.push({semantics:"FID",ssrcs:`${r} ${i}`})}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addLegacySimulcast=t.getRtpEncodings=void 0,t.getRtpEncodings=function({offerMediaObject:e,track:t}){let r;const a=new Set;for(const n of e.ssrcs||[]){if("msid"!==n.attribute)continue;if(n.value.split(" ")[1]===t.id){const e=n.id;a.add(e),r||(r=e)}}if(0===a.size)throw new Error(`a=ssrc line with msid information not found [track.id:${t.id}]`);const n=new Map;for(const t of e.ssrcGroups||[]){if("FID"!==t.semantics)continue;let[e,r]=t.ssrcs.split(/\s+/);e=Number(e),r=Number(r),a.has(e)&&(a.delete(e),a.delete(r),n.set(e,r))}for(const e of a)n.set(e,null);const i=[];for(const[e,t]of n){const r={ssrc:e};t&&(r.rtx={ssrc:t}),i.push(r)}return i},t.addLegacySimulcast=function({offerMediaObject:e,track:t,numStreams:r}){if(r<=1)throw new TypeError("numStreams must be greater than 1");let a,n,i;if(!(e.ssrcs||[]).find((e=>{if("msid"!==e.attribute)return!1;return e.value.split(" ")[1]===t.id&&(a=e.id,i=e.value.split(" ")[0],!0)})))throw new Error(`a=ssrc line with msid information not found [track.id:${t.id}]`);(e.ssrcGroups||[]).some((e=>{if("FID"!==e.semantics)return!1;const t=e.ssrcs.split(/\s+/);return Number(t[0])===a&&(n=Number(t[1]),!0)}));const s=e.ssrcs.find((e=>"cname"===e.attribute&&e.id===a));if(!s)throw new Error(`a=ssrc line with cname information not found [track.id:${t.id}]`);const o=s.value,c=[],d=[];for(let e=0;e<r;++e)c.push(a+e),n&&d.push(n+e);e.ssrcGroups=e.ssrcGroups||[],e.ssrcs=e.ssrcs||[],e.ssrcGroups.push({semantics:"SIM",ssrcs:c.join(" ")});for(let r=0;r<c.length;++r){const a=c[r];e.ssrcs.push({id:a,attribute:"cname",value:o}),e.ssrcs.push({id:a,attribute:"msid",value:`${i} ${t.id}`})}for(let r=0;r<d.length;++r){const a=c[r],n=d[r];e.ssrcs.push({id:n,attribute:"cname",value:o}),e.ssrcs.push({id:n,attribute:"msid",value:`${i} ${t.id}`}),e.ssrcGroups.push({semantics:"FID",ssrcs:`${a} ${n}`})}}},function(e,t,r){e.exports=function(e){var t={};function r(a){if(t[a])return t[a].exports;var n=t[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(a,n,function(t){return e[t]}.bind(null,n));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=90)}({17:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var a=r(18),n=function(){function e(){}return e.getFirstMatch=function(e,t){var r=t.match(e);return r&&r.length>0&&r[1]||""},e.getSecondMatch=function(e,t){var r=t.match(e);return r&&r.length>1&&r[2]||""},e.matchAndReturnConst=function(e,t,r){if(e.test(t))return r},e.getWindowsVersionName=function(e){switch(e){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},e.getMacOSVersionName=function(e){var t=e.split(".").splice(0,2).map((function(e){return parseInt(e,10)||0}));if(t.push(0),10===t[0])switch(t[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},e.getAndroidVersionName=function(e){var t=e.split(".").splice(0,2).map((function(e){return parseInt(e,10)||0}));if(t.push(0),!(1===t[0]&&t[1]<5))return 1===t[0]&&t[1]<6?"Cupcake":1===t[0]&&t[1]>=6?"Donut":2===t[0]&&t[1]<2?"Eclair":2===t[0]&&2===t[1]?"Froyo":2===t[0]&&t[1]>2?"Gingerbread":3===t[0]?"Honeycomb":4===t[0]&&t[1]<1?"Ice Cream Sandwich":4===t[0]&&t[1]<4?"Jelly Bean":4===t[0]&&t[1]>=4?"KitKat":5===t[0]?"Lollipop":6===t[0]?"Marshmallow":7===t[0]?"Nougat":8===t[0]?"Oreo":9===t[0]?"Pie":void 0},e.getVersionPrecision=function(e){return e.split(".").length},e.compareVersions=function(t,r,a){void 0===a&&(a=!1);var n=e.getVersionPrecision(t),i=e.getVersionPrecision(r),s=Math.max(n,i),o=0,c=e.map([t,r],(function(t){var r=s-e.getVersionPrecision(t),a=t+new Array(r+1).join(".0");return e.map(a.split("."),(function(e){return new Array(20-e.length).join("0")+e})).reverse()}));for(a&&(o=s-Math.min(n,i)),s-=1;s>=o;){if(c[0][s]>c[1][s])return 1;if(c[0][s]===c[1][s]){if(s===o)return 0;s-=1}else if(c[0][s]<c[1][s])return-1}},e.map=function(e,t){var r,a=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(r=0;r<e.length;r+=1)a.push(t(e[r]));return a},e.find=function(e,t){var r,a;if(Array.prototype.find)return Array.prototype.find.call(e,t);for(r=0,a=e.length;r<a;r+=1){var n=e[r];if(t(n,r))return n}},e.assign=function(e){for(var t,r,a=e,n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];if(Object.assign)return Object.assign.apply(Object,[e].concat(i));var o=function(){var e=i[t];"object"==typeof e&&null!==e&&Object.keys(e).forEach((function(t){a[t]=e[t]}))};for(t=0,r=i.length;t<r;t+=1)o();return e},e.getBrowserAlias=function(e){return a.BROWSER_ALIASES_MAP[e]},e.getBrowserTypeByAlias=function(e){return a.BROWSER_MAP[e]||""},e}();t.default=n,e.exports=t.default},18:function(e,t,r){"use strict";t.__esModule=!0,t.ENGINE_MAP=t.OS_MAP=t.PLATFORMS_MAP=t.BROWSER_MAP=t.BROWSER_ALIASES_MAP=void 0,t.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},t.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},t.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},t.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},t.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var a,n=(a=r(91))&&a.__esModule?a:{default:a},i=r(18);function s(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var o=function(){function e(){}var t,r,a;return e.getParser=function(e,t){if(void 0===t&&(t=!1),"string"!=typeof e)throw new Error("UserAgent should be a string");return new n.default(e,t)},e.parse=function(e){return new n.default(e).getResult()},t=e,a=[{key:"BROWSER_MAP",get:function(){return i.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return i.ENGINE_MAP}},{key:"OS_MAP",get:function(){return i.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return i.PLATFORMS_MAP}}],(r=null)&&s(t.prototype,r),a&&s(t,a),e}();t.default=o,e.exports=t.default},91:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var a=c(r(92)),n=c(r(93)),i=c(r(94)),s=c(r(95)),o=c(r(17));function c(e){return e&&e.__esModule?e:{default:e}}var d=function(){function e(e,t){if(void 0===t&&(t=!1),null==e||""===e)throw new Error("UserAgent parameter can't be empty");this._ua=e,this.parsedResult={},!0!==t&&this.parse()}var t=e.prototype;return t.getUA=function(){return this._ua},t.test=function(e){return e.test(this._ua)},t.parseBrowser=function(){var e=this;this.parsedResult.browser={};var t=o.default.find(a.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.browser=t.describe(this.getUA())),this.parsedResult.browser},t.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},t.getBrowserName=function(e){return e?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},t.getBrowserVersion=function(){return this.getBrowser().version},t.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},t.parseOS=function(){var e=this;this.parsedResult.os={};var t=o.default.find(n.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.os=t.describe(this.getUA())),this.parsedResult.os},t.getOSName=function(e){var t=this.getOS().name;return e?String(t).toLowerCase()||"":t||""},t.getOSVersion=function(){return this.getOS().version},t.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},t.getPlatformType=function(e){void 0===e&&(e=!1);var t=this.getPlatform().type;return e?String(t).toLowerCase()||"":t||""},t.parsePlatform=function(){var e=this;this.parsedResult.platform={};var t=o.default.find(i.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.platform=t.describe(this.getUA())),this.parsedResult.platform},t.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},t.getEngineName=function(e){return e?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},t.parseEngine=function(){var e=this;this.parsedResult.engine={};var t=o.default.find(s.default,(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some((function(t){return e.test(t)}));throw new Error("Browser's test function is not valid")}));return t&&(this.parsedResult.engine=t.describe(this.getUA())),this.parsedResult.engine},t.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},t.getResult=function(){return o.default.assign({},this.parsedResult)},t.satisfies=function(e){var t=this,r={},a=0,n={},i=0;if(Object.keys(e).forEach((function(t){var s=e[t];"string"==typeof s?(n[t]=s,i+=1):"object"==typeof s&&(r[t]=s,a+=1)})),a>0){var s=Object.keys(r),c=o.default.find(s,(function(e){return t.isOS(e)}));if(c){var d=this.satisfies(r[c]);if(void 0!==d)return d}var p=o.default.find(s,(function(e){return t.isPlatform(e)}));if(p){var u=this.satisfies(r[p]);if(void 0!==u)return u}}if(i>0){var l=Object.keys(n),h=o.default.find(l,(function(e){return t.isBrowser(e,!0)}));if(void 0!==h)return this.compareVersion(n[h])}},t.isBrowser=function(e,t){void 0===t&&(t=!1);var r=this.getBrowserName().toLowerCase(),a=e.toLowerCase(),n=o.default.getBrowserTypeByAlias(a);return t&&n&&(a=n.toLowerCase()),a===r},t.compareVersion=function(e){var t=[0],r=e,a=!1,n=this.getBrowserVersion();if("string"==typeof n)return">"===e[0]||"<"===e[0]?(r=e.substr(1),"="===e[1]?(a=!0,r=e.substr(2)):t=[],">"===e[0]?t.push(1):t.push(-1)):"="===e[0]?r=e.substr(1):"~"===e[0]&&(a=!0,r=e.substr(1)),t.indexOf(o.default.compareVersions(n,r,a))>-1},t.isOS=function(e){return this.getOSName(!0)===String(e).toLowerCase()},t.isPlatform=function(e){return this.getPlatformType(!0)===String(e).toLowerCase()},t.isEngine=function(e){return this.getEngineName(!0)===String(e).toLowerCase()},t.is=function(e,t){return void 0===t&&(t=!1),this.isBrowser(e,t)||this.isOS(e)||this.isPlatform(e)},t.some=function(e){var t=this;return void 0===e&&(e=[]),e.some((function(e){return t.is(e)}))},e}();t.default=d,e.exports=t.default},92:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var a,n=(a=r(17))&&a.__esModule?a:{default:a},i=/version\/(\d+(\.?_?\d+)+)/i,s=[{test:[/googlebot/i],describe:function(e){var t={name:"Googlebot"},r=n.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,e)||n.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/opera/i],describe:function(e){var t={name:"Opera"},r=n.default.getFirstMatch(i,e)||n.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/opr\/|opios/i],describe:function(e){var t={name:"Opera"},r=n.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,e)||n.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/SamsungBrowser/i],describe:function(e){var t={name:"Samsung Internet for Android"},r=n.default.getFirstMatch(i,e)||n.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/Whale/i],describe:function(e){var t={name:"NAVER Whale Browser"},r=n.default.getFirstMatch(i,e)||n.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/MZBrowser/i],describe:function(e){var t={name:"MZ Browser"},r=n.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,e)||n.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/focus/i],describe:function(e){var t={name:"Focus"},r=n.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,e)||n.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/swing/i],describe:function(e){var t={name:"Swing"},r=n.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,e)||n.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/coast/i],describe:function(e){var t={name:"Opera Coast"},r=n.default.getFirstMatch(i,e)||n.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(e){var t={name:"Opera Touch"},r=n.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/yabrowser/i],describe:function(e){var t={name:"Yandex Browser"},r=n.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/ucbrowser/i],describe:function(e){var t={name:"UC Browser"},r=n.default.getFirstMatch(i,e)||n.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/Maxthon|mxios/i],describe:function(e){var t={name:"Maxthon"},r=n.default.getFirstMatch(i,e)||n.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/epiphany/i],describe:function(e){var t={name:"Epiphany"},r=n.default.getFirstMatch(i,e)||n.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/puffin/i],describe:function(e){var t={name:"Puffin"},r=n.default.getFirstMatch(i,e)||n.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/sleipnir/i],describe:function(e){var t={name:"Sleipnir"},r=n.default.getFirstMatch(i,e)||n.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/k-meleon/i],describe:function(e){var t={name:"K-Meleon"},r=n.default.getFirstMatch(i,e)||n.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/micromessenger/i],describe:function(e){var t={name:"WeChat"},r=n.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/qqbrowser/i],describe:function(e){var t={name:/qqbrowserlite/i.test(e)?"QQ Browser Lite":"QQ Browser"},r=n.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/msie|trident/i],describe:function(e){var t={name:"Internet Explorer"},r=n.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/\sedg\//i],describe:function(e){var t={name:"Microsoft Edge"},r=n.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/edg([ea]|ios)/i],describe:function(e){var t={name:"Microsoft Edge"},r=n.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/vivaldi/i],describe:function(e){var t={name:"Vivaldi"},r=n.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/seamonkey/i],describe:function(e){var t={name:"SeaMonkey"},r=n.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/sailfish/i],describe:function(e){var t={name:"Sailfish"},r=n.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,e);return r&&(t.version=r),t}},{test:[/silk/i],describe:function(e){var t={name:"Amazon Silk"},r=n.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/phantom/i],describe:function(e){var t={name:"PhantomJS"},r=n.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/slimerjs/i],describe:function(e){var t={name:"SlimerJS"},r=n.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t={name:"BlackBerry"},r=n.default.getFirstMatch(i,e)||n.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t={name:"WebOS Browser"},r=n.default.getFirstMatch(i,e)||n.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/bada/i],describe:function(e){var t={name:"Bada"},r=n.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/tizen/i],describe:function(e){var t={name:"Tizen"},r=n.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/qupzilla/i],describe:function(e){var t={name:"QupZilla"},r=n.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/firefox|iceweasel|fxios/i],describe:function(e){var t={name:"Firefox"},r=n.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/electron/i],describe:function(e){var t={name:"Electron"},r=n.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/MiuiBrowser/i],describe:function(e){var t={name:"Miui"},r=n.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/chromium/i],describe:function(e){var t={name:"Chromium"},r=n.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/chrome|crios|crmo/i],describe:function(e){var t={name:"Chrome"},r=n.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/GSA/i],describe:function(e){var t={name:"Google Search"},r=n.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){var t=!e.test(/like android/i),r=e.test(/android/i);return t&&r},describe:function(e){var t={name:"Android Browser"},r=n.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/playstation 4/i],describe:function(e){var t={name:"PlayStation 4"},r=n.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/safari|applewebkit/i],describe:function(e){var t={name:"Safari"},r=n.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/.*/i],describe:function(e){var t=-1!==e.search("\\(")?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:n.default.getFirstMatch(t,e),version:n.default.getSecondMatch(t,e)}}}];t.default=s,e.exports=t.default},93:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var a,n=(a=r(17))&&a.__esModule?a:{default:a},i=r(18),s=[{test:[/Roku\/DVP/],describe:function(e){var t=n.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,e);return{name:i.OS_MAP.Roku,version:t}}},{test:[/windows phone/i],describe:function(e){var t=n.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,e);return{name:i.OS_MAP.WindowsPhone,version:t}}},{test:[/windows /i],describe:function(e){var t=n.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,e),r=n.default.getWindowsVersionName(t);return{name:i.OS_MAP.Windows,version:t,versionName:r}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(e){var t={name:i.OS_MAP.iOS},r=n.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,e);return r&&(t.version=r),t}},{test:[/macintosh/i],describe:function(e){var t=n.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,e).replace(/[_\s]/g,"."),r=n.default.getMacOSVersionName(t),a={name:i.OS_MAP.MacOS,version:t};return r&&(a.versionName=r),a}},{test:[/(ipod|iphone|ipad)/i],describe:function(e){var t=n.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,e).replace(/[_\s]/g,".");return{name:i.OS_MAP.iOS,version:t}}},{test:function(e){var t=!e.test(/like android/i),r=e.test(/android/i);return t&&r},describe:function(e){var t=n.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,e),r=n.default.getAndroidVersionName(t),a={name:i.OS_MAP.Android,version:t};return r&&(a.versionName=r),a}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t=n.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,e),r={name:i.OS_MAP.WebOS};return t&&t.length&&(r.version=t),r}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t=n.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,e)||n.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,e)||n.default.getFirstMatch(/\bbb(\d+)/i,e);return{name:i.OS_MAP.BlackBerry,version:t}}},{test:[/bada/i],describe:function(e){var t=n.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,e);return{name:i.OS_MAP.Bada,version:t}}},{test:[/tizen/i],describe:function(e){var t=n.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,e);return{name:i.OS_MAP.Tizen,version:t}}},{test:[/linux/i],describe:function(){return{name:i.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:i.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(e){var t=n.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,e);return{name:i.OS_MAP.PlayStation4,version:t}}}];t.default=s,e.exports=t.default},94:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var a,n=(a=r(17))&&a.__esModule?a:{default:a},i=r(18),s=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(e){var t=n.default.getFirstMatch(/(can-l01)/i,e)&&"Nova",r={type:i.PLATFORMS_MAP.mobile,vendor:"Huawei"};return t&&(r.model=t),r}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:i.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:i.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:i.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:i.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:i.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:i.PLATFORMS_MAP.tablet}}},{test:function(e){var t=e.test(/ipod|iphone/i),r=e.test(/like (ipod|iphone)/i);return t&&!r},describe:function(e){var t=n.default.getFirstMatch(/(ipod|iphone)/i,e);return{type:i.PLATFORMS_MAP.mobile,vendor:"Apple",model:t}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:i.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:i.PLATFORMS_MAP.mobile}}},{test:function(e){return"blackberry"===e.getBrowserName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(e){return"bada"===e.getBrowserName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.mobile}}},{test:function(e){return"windows phone"===e.getBrowserName()},describe:function(){return{type:i.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(e){var t=Number(String(e.getOSVersion()).split(".")[0]);return"android"===e.getOSName(!0)&&t>=3},describe:function(){return{type:i.PLATFORMS_MAP.tablet}}},{test:function(e){return"android"===e.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.mobile}}},{test:function(e){return"macos"===e.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(e){return"windows"===e.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.desktop}}},{test:function(e){return"linux"===e.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.desktop}}},{test:function(e){return"playstation 4"===e.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.tv}}},{test:function(e){return"roku"===e.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.tv}}}];t.default=s,e.exports=t.default},95:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var a,n=(a=r(17))&&a.__esModule?a:{default:a},i=r(18),s=[{test:function(e){return"microsoft edge"===e.getBrowserName(!0)},describe:function(e){if(/\sedg\//i.test(e))return{name:i.ENGINE_MAP.Blink};var t=n.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,e);return{name:i.ENGINE_MAP.EdgeHTML,version:t}}},{test:[/trident/i],describe:function(e){var t={name:i.ENGINE_MAP.Trident},r=n.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){return e.test(/presto/i)},describe:function(e){var t={name:i.ENGINE_MAP.Presto},r=n.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){var t=e.test(/gecko/i),r=e.test(/like gecko/i);return t&&!r},describe:function(e){var t={name:i.ENGINE_MAP.Gecko},r=n.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:i.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(e){var t={name:i.ENGINE_MAP.WebKit},r=n.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}}];t.default=s,e.exports=t.default}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parse=void 0;const a=new RegExp("^[LS]([1-9]\\d{0,1})T([1-9]\\d{0,1})");t.parse=function(e){const t=a.exec(e||"");return t?{spatialLayers:Number(t[1]),temporalLayers:Number(t[2])}:{spatialLayers:1,temporalLayers:1}}},function(e,t,r){"use strict";(function(e,a){var n,i=r(41);n="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==e?e:a;var s=Object(i.a)(n);t.a=s}).call(this,r(49),r(50)(e))},function(e,t,r){const{version:a}=r(52),n=r(53),i=r(56);t.version=a,t.Peer=n,t.WebSocketTransport=i},function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.hasOwnProperty.call(e,r)&&a(t,e,r);return n(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.debug=t.detectDevice=t.Device=t.version=t.types=void 0;const o=s(r(12));t.debug=o.default;const c=r(33);Object.defineProperty(t,"Device",{enumerable:!0,get:function(){return c.Device}}),Object.defineProperty(t,"detectDevice",{enumerable:!0,get:function(){return c.detectDevice}});const d=i(r(81));t.types=d,t.version="3.6.37";var p=r(24);Object.defineProperty(t,"parseScalabilityMode",{enumerable:!0,get:function(){return p.parse}})},function(e,t){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t){var r,a,n=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function o(e){if(r===setTimeout)return setTimeout(e,0);if((r===i||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:i}catch(e){r=i}try{a="function"==typeof clearTimeout?clearTimeout:s}catch(e){a=s}}();var c,d=[],p=!1,u=-1;function l(){p&&c&&(p=!1,c.length?d=c.concat(d):u=-1,d.length&&h())}function h(){if(!p){var e=o(l);p=!0;for(var t=d.length;t;){for(c=d,d=[];++u<t;)c&&c[u].run();u=-1,t=d.length}c=null,p=!1,function(e){if(a===clearTimeout)return clearTimeout(e);if((a===s||!a)&&clearTimeout)return a=clearTimeout,clearTimeout(e);try{a(e)}catch(t){try{return a.call(null,e)}catch(t){return a.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function f(){}n.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];d.push(new m(e,t)),1!==d.length||p||o(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=f,n.addListener=f,n.once=f,n.off=f,n.removeListener=f,n.removeAllListeners=f,n.emit=f,n.prependListener=f,n.prependOnceListener=f,n.listeners=function(e){return[]},n.binding=function(e){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},function(e,t){var r=1e3,a=60*r,n=60*a,i=24*n,s=7*i,o=365.25*i;function c(e,t,r,a){var n=t>=1.5*r;return Math.round(e/r)+" "+a+(n?"s":"")}e.exports=function(e,t){t=t||{};var d=typeof e;if("string"===d&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var c=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return c*o;case"weeks":case"week":case"w":return c*s;case"days":case"day":case"d":return c*i;case"hours":case"hour":case"hrs":case"hr":case"h":return c*n;case"minutes":case"minute":case"mins":case"min":case"m":return c*a;case"seconds":case"second":case"secs":case"sec":case"s":return c*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return c;default:return}}(e);if("number"===d&&isFinite(e))return t.long?function(e){var t=Math.abs(e);if(t>=i)return c(e,t,i,"day");if(t>=n)return c(e,t,n,"hour");if(t>=a)return c(e,t,a,"minute");if(t>=r)return c(e,t,r,"second");return e+" ms"}(e):function(e){var t=Math.abs(e);if(t>=i)return Math.round(e/i)+"d";if(t>=n)return Math.round(e/n)+"h";if(t>=a)return Math.round(e/a)+"m";if(t>=r)return Math.round(e/r)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,r){const{EventEmitter:a}=r(11),n=r(20);e.exports=class extends a{constructor(e){super(),this.setMaxListeners(1/0),this._logger=e||new n("EnhancedEventEmitter")}safeEmit(e,...t){try{this.emit(e,...t)}catch(t){this._logger.error("safeEmit() | event listener threw an error [event:%s]:%o",e,t)}}async safeEmitAsPromise(e,...t){return new Promise(((r,a)=>{this.safeEmit(e,...t,r,a)}))}}},function(e,t,r){const a=r(20),{generateRandomNumber:n}=r(55),i=new a("Message");e.exports=class{static parse(e){let t;const r={};try{t=JSON.parse(e)}catch(e){return void i.error("parse() | invalid JSON: %s",e)}if("object"==typeof t&&!Array.isArray(t)){if(t.request){if(r.request=!0,"string"!=typeof t.method)return void i.error("parse() | missing/invalid method field");if("number"!=typeof t.id)return void i.error("parse() | missing/invalid id field");r.id=t.id,r.method=t.method,r.data=t.data||{}}else if(t.response){if(r.response=!0,"number"!=typeof t.id)return void i.error("parse() | missing/invalid id field");r.id=t.id,t.ok?(r.ok=!0,r.data=t.data||{}):(r.ok=!1,r.errorCode=t.errorCode,r.errorReason=t.errorReason)}else{if(!t.notification)return void i.error("parse() | missing request/response field");if(r.notification=!0,"string"!=typeof t.method)return void i.error("parse() | missing/invalid method field");r.method=t.method,r.data=t.data||{}}return r}i.error("parse() | not an object")}static createRequest(e,t){return{request:!0,id:n(),method:e,data:t||{}}}static createSuccessResponse(e,t){return{response:!0,id:e.id,ok:!0,data:t||{}}}static createErrorResponse(e,t,r){return{response:!0,id:e.id,ok:!1,errorCode:t,errorReason:r}}static createNotification(e,t){return{notification:!0,method:e,data:t||{}}}}},function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.hasOwnProperty.call(e,r)&&a(t,e,r);return n(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Device=t.detectDevice=void 0;const o=s(r(23)),c=r(5),d=r(15),p=r(8),u=i(r(6)),l=i(r(7)),h=r(34),m=r(68),f=r(72),g=r(73),_=r(74),v=r(75),b=r(76),y=r(77),w=r(78),S=r(80),P=new c.Logger("Device");function R(){if("object"==typeof navigator&&"ReactNative"===navigator.product)return"undefined"==typeof RTCPeerConnection?void P.warn("this._detectDevice() | unsupported ReactNative without RTCPeerConnection"):(P.debug("this._detectDevice() | ReactNative handler chosen"),"ReactNative");if("object"!=typeof navigator||"string"!=typeof navigator.userAgent)P.warn("this._detectDevice() | unknown device");else{const e=navigator.userAgent,t=o.default.getParser(e),r=t.getEngine();if(t.satisfies({chrome:">=74",chromium:">=74"}))return"Chrome74";if(t.satisfies({chrome:">=70",chromium:">=70"}))return"Chrome70";if(t.satisfies({chrome:">=67",chromium:">=67"}))return"Chrome67";if(t.satisfies({chrome:">=55",chromium:">=55"}))return"Chrome55";if(t.satisfies({firefox:">=60"}))return"Firefox60";if(t.satisfies({safari:">=12.0"})&&"undefined"!=typeof RTCRtpTransceiver&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(t.satisfies({safari:">=11"}))return"Safari11";if(t.satisfies({"microsoft edge":">=11"})&&t.satisfies({"microsoft edge":"<=18"}))return"Edge11";if(r.name&&"blink"===r.name.toLowerCase()){const t=e.match(/(?:(?:Chrome|Chromium))[ /](\w+)/i);if(t){const e=Number(t[1]);return e>=74?"Chrome74":e>=70?"Chrome70":e>=67?"Chrome67":"Chrome55"}return"Chrome74"}P.warn("this._detectDevice() | browser not supported [name:%s, version:%s]",t.getBrowserName(),t.getBrowserVersion())}}t.detectDevice=R;t.Device=class{constructor({handlerName:e,handlerFactory:t,Handler:r}={}){if(this._loaded=!1,this._observer=new d.EnhancedEventEmitter,P.debug("constructor()"),r){if(P.warn("constructor() | Handler option is DEPRECATED, use handlerName or handlerFactory instead"),"string"!=typeof r)throw new TypeError("non string Handler option no longer supported, use handlerFactory instead");e=r}if(e&&t)throw new TypeError("just one of handlerName or handlerInterface can be given");if(t)this._handlerFactory=t;else{if(e)P.debug("constructor() | handler given: %s",e);else{if(!(e=R()))throw new p.UnsupportedError("device not supported");P.debug("constructor() | detected handler: %s",e)}switch(e){case"Chrome74":this._handlerFactory=m.Chrome74.createFactory();break;case"Chrome70":this._handlerFactory=f.Chrome70.createFactory();break;case"Chrome67":this._handlerFactory=g.Chrome67.createFactory();break;case"Chrome55":this._handlerFactory=_.Chrome55.createFactory();break;case"Firefox60":this._handlerFactory=v.Firefox60.createFactory();break;case"Safari12":this._handlerFactory=b.Safari12.createFactory();break;case"Safari11":this._handlerFactory=y.Safari11.createFactory();break;case"Edge11":this._handlerFactory=w.Edge11.createFactory();break;case"ReactNative":this._handlerFactory=S.ReactNative.createFactory();break;default:throw new TypeError(`unknown handlerName "${e}"`)}}const a=this._handlerFactory();this._handlerName=a.name,a.close(),this._extendedRtpCapabilities=void 0,this._recvRtpCapabilities=void 0,this._canProduceByKind={audio:!1,video:!1},this._sctpCapabilities=void 0}get handlerName(){return this._handlerName}get loaded(){return this._loaded}get rtpCapabilities(){if(!this._loaded)throw new p.InvalidStateError("not loaded");return this._recvRtpCapabilities}get sctpCapabilities(){if(!this._loaded)throw new p.InvalidStateError("not loaded");return this._sctpCapabilities}get observer(){return this._observer}async load({routerRtpCapabilities:e}){let t;P.debug("load() [routerRtpCapabilities:%o]",e),e=u.clone(e,void 0);try{if(this._loaded)throw new p.InvalidStateError("already loaded");l.validateRtpCapabilities(e),t=this._handlerFactory();const r=await t.getNativeRtpCapabilities();P.debug("load() | got native RTP capabilities:%o",r),l.validateRtpCapabilities(r),this._extendedRtpCapabilities=l.getExtendedRtpCapabilities(r,e),P.debug("load() | got extended RTP capabilities:%o",this._extendedRtpCapabilities),this._canProduceByKind.audio=l.canSend("audio",this._extendedRtpCapabilities),this._canProduceByKind.video=l.canSend("video",this._extendedRtpCapabilities),this._recvRtpCapabilities=l.getRecvRtpCapabilities(this._extendedRtpCapabilities),l.validateRtpCapabilities(this._recvRtpCapabilities),P.debug("load() | got receiving RTP capabilities:%o",this._recvRtpCapabilities),this._sctpCapabilities=await t.getNativeSctpCapabilities(),P.debug("load() | got native SCTP capabilities:%o",this._sctpCapabilities),l.validateSctpCapabilities(this._sctpCapabilities),P.debug("load() succeeded"),this._loaded=!0,t.close()}catch(e){throw t&&t.close(),e}}canProduce(e){if(!this._loaded)throw new p.InvalidStateError("not loaded");if("audio"!==e&&"video"!==e)throw new TypeError(`invalid kind "${e}"`);return this._canProduceByKind[e]}createSendTransport({id:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:i,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:c,appData:d={}}){return P.debug("createSendTransport()"),this._createTransport({direction:"send",id:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:i,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:c,appData:d})}createRecvTransport({id:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:i,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:c,appData:d={}}){return P.debug("createRecvTransport()"),this._createTransport({direction:"recv",id:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:i,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:c,appData:d})}_createTransport({direction:e,id:t,iceParameters:r,iceCandidates:a,dtlsParameters:n,sctpParameters:i,iceServers:s,iceTransportPolicy:o,additionalSettings:c,proprietaryConstraints:d,appData:u={}}){if(!this._loaded)throw new p.InvalidStateError("not loaded");if("string"!=typeof t)throw new TypeError("missing id");if("object"!=typeof r)throw new TypeError("missing iceParameters");if(!Array.isArray(a))throw new TypeError("missing iceCandidates");if("object"!=typeof n)throw new TypeError("missing dtlsParameters");if(i&&"object"!=typeof i)throw new TypeError("wrong sctpParameters");if(u&&"object"!=typeof u)throw new TypeError("if given, appData must be an object");const l=new h.Transport({direction:e,id:t,iceParameters:r,iceCandidates:a,dtlsParameters:n,sctpParameters:i,iceServers:s,iceTransportPolicy:o,additionalSettings:c,proprietaryConstraints:d,appData:u,handlerFactory:this._handlerFactory,extendedRtpCapabilities:this._extendedRtpCapabilities,canProduceByKind:this._canProduceByKind});return this._observer.safeEmit("newtransport",l),l}}},function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.hasOwnProperty.call(e,r)&&a(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Transport=void 0;const s=r(67),o=r(5),c=r(15),d=r(8),p=i(r(6)),u=i(r(7)),l=r(35),h=r(36),m=r(37),f=r(38),g=new o.Logger("Transport");class _ extends c.EnhancedEventEmitter{constructor({direction:e,id:t,iceParameters:r,iceCandidates:a,dtlsParameters:n,sctpParameters:i,iceServers:o,iceTransportPolicy:u,additionalSettings:l,proprietaryConstraints:h,appData:m,handlerFactory:f,extendedRtpCapabilities:_,canProduceByKind:v}){super(),this._closed=!1,this._connectionState="new",this._producers=new Map,this._consumers=new Map,this._dataProducers=new Map,this._dataConsumers=new Map,this._probatorConsumerCreated=!1,this._awaitQueue=new s.AwaitQueue({ClosedErrorClass:d.InvalidStateError}),this._observer=new c.EnhancedEventEmitter,g.debug("constructor() [id:%s, direction:%s]",t,e),this._id=t,this._direction=e,this._extendedRtpCapabilities=_,this._canProduceByKind=v,this._maxSctpMessageSize=i?i.maxMessageSize:null,delete(l=p.clone(l,{})).iceServers,delete l.iceTransportPolicy,delete l.bundlePolicy,delete l.rtcpMuxPolicy,delete l.sdpSemantics,this._handler=f(),this._handler.run({direction:e,iceParameters:r,iceCandidates:a,dtlsParameters:n,sctpParameters:i,iceServers:o,iceTransportPolicy:u,additionalSettings:l,proprietaryConstraints:h,extendedRtpCapabilities:_}),this._appData=m,this._handleHandler()}get id(){return this._id}get closed(){return this._closed}get direction(){return this._direction}get handler(){return this._handler}get connectionState(){return this._connectionState}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){if(!this._closed){g.debug("close()"),this._closed=!0,this._awaitQueue.close(),this._handler.close();for(const e of this._producers.values())e.transportClosed();this._producers.clear();for(const e of this._consumers.values())e.transportClosed();this._consumers.clear();for(const e of this._dataProducers.values())e.transportClosed();this._dataProducers.clear();for(const e of this._dataConsumers.values())e.transportClosed();this._dataConsumers.clear(),this._observer.safeEmit("close")}}async getStats(){if(this._closed)throw new d.InvalidStateError("closed");return this._handler.getTransportStats()}async restartIce({iceParameters:e}){if(g.debug("restartIce()"),this._closed)throw new d.InvalidStateError("closed");if(!e)throw new TypeError("missing iceParameters");return this._awaitQueue.push((async()=>this._handler.restartIce(e)),"transport.restartIce()")}async updateIceServers({iceServers:e}={}){if(g.debug("updateIceServers()"),this._closed)throw new d.InvalidStateError("closed");if(!Array.isArray(e))throw new TypeError("missing iceServers");return this._awaitQueue.push((async()=>this._handler.updateIceServers(e)),"transport.updateIceServers()")}async produce({track:e,encodings:t,codecOptions:r,codec:a,stopTracks:n=!0,disableTrackOnPause:i=!0,zeroRtpOnPause:s=!1,appData:o={}}={}){if(g.debug("produce() [track:%o]",e),!e)throw new TypeError("missing track");if("send"!==this._direction)throw new d.UnsupportedError("not a sending Transport");if(!this._canProduceByKind[e.kind])throw new d.UnsupportedError(`cannot produce ${e.kind}`);if("ended"===e.readyState)throw new d.InvalidStateError("track ended");if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError('no "connect" listener set into this transport');if(0===this.listenerCount("produce"))throw new TypeError('no "produce" listener set into this transport');if(o&&"object"!=typeof o)throw new TypeError("if given, appData must be an object");return this._awaitQueue.push((async()=>{let c;if(t&&!Array.isArray(t))throw TypeError("encodings must be an array");t&&0===t.length?c=void 0:t&&(c=t.map((e=>{const t={active:!0};return!1===e.active&&(t.active=!1),"boolean"==typeof e.dtx&&(t.dtx=e.dtx),"string"==typeof e.scalabilityMode&&(t.scalabilityMode=e.scalabilityMode),"number"==typeof e.scaleResolutionDownBy&&(t.scaleResolutionDownBy=e.scaleResolutionDownBy),"number"==typeof e.maxBitrate&&(t.maxBitrate=e.maxBitrate),"number"==typeof e.maxFramerate&&(t.maxFramerate=e.maxFramerate),"boolean"==typeof e.adaptivePtime&&(t.adaptivePtime=e.adaptivePtime),"string"==typeof e.priority&&(t.priority=e.priority),"string"==typeof e.networkPriority&&(t.networkPriority=e.networkPriority),t})));const{localId:d,rtpParameters:p,rtpSender:h}=await this._handler.send({track:e,encodings:c,codecOptions:r,codec:a});try{u.validateRtpParameters(p);const{id:t}=await this.safeEmitAsPromise("produce",{kind:e.kind,rtpParameters:p,appData:o}),r=new l.Producer({id:t,localId:d,rtpSender:h,track:e,rtpParameters:p,stopTracks:n,disableTrackOnPause:i,zeroRtpOnPause:s,appData:o});return this._producers.set(r.id,r),this._handleProducer(r),this._observer.safeEmit("newproducer",r),r}catch(e){throw this._handler.stopSending(d).catch((()=>{})),e}}),"transport.produce()").catch((t=>{if(n)try{e.stop()}catch(e){}throw t}))}async consume({id:e,producerId:t,kind:r,rtpParameters:a,appData:n={}}){if(g.debug("consume()"),a=p.clone(a,void 0),this._closed)throw new d.InvalidStateError("closed");if("recv"!==this._direction)throw new d.UnsupportedError("not a receiving Transport");if("string"!=typeof e)throw new TypeError("missing id");if("string"!=typeof t)throw new TypeError("missing producerId");if("audio"!==r&&"video"!==r)throw new TypeError(`invalid kind '${r}'`);if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError('no "connect" listener set into this transport');if(n&&"object"!=typeof n)throw new TypeError("if given, appData must be an object");return this._awaitQueue.push((async()=>{if(!u.canReceive(a,this._extendedRtpCapabilities))throw new d.UnsupportedError("cannot consume this Producer");const{localId:i,rtpReceiver:s,track:o}=await this._handler.receive({trackId:e,kind:r,rtpParameters:a}),c=new h.Consumer({id:e,localId:i,producerId:t,rtpReceiver:s,track:o,rtpParameters:a,appData:n});if(this._consumers.set(c.id,c),this._handleConsumer(c),!this._probatorConsumerCreated&&"video"===r)try{const e=u.generateProbatorRtpParameters(c.rtpParameters);await this._handler.receive({trackId:"probator",kind:"video",rtpParameters:e}),g.debug("consume() | Consumer for RTP probation created"),this._probatorConsumerCreated=!0}catch(e){g.error("consume() | failed to create Consumer for RTP probation:%o",e)}return this._observer.safeEmit("newconsumer",c),c}),"transport.consume()")}async produceData({ordered:e=!0,maxPacketLifeTime:t,maxRetransmits:r,label:a="",protocol:n="",appData:i={}}={}){if(g.debug("produceData()"),"send"!==this._direction)throw new d.UnsupportedError("not a sending Transport");if(!this._maxSctpMessageSize)throw new d.UnsupportedError("SCTP not enabled by remote Transport");if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError('no "connect" listener set into this transport');if(0===this.listenerCount("producedata"))throw new TypeError('no "producedata" listener set into this transport');if(i&&"object"!=typeof i)throw new TypeError("if given, appData must be an object");return(t||r)&&(e=!1),this._awaitQueue.push((async()=>{const{dataChannel:s,sctpStreamParameters:o}=await this._handler.sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:a,protocol:n});u.validateSctpStreamParameters(o);const{id:c}=await this.safeEmitAsPromise("producedata",{sctpStreamParameters:o,label:a,protocol:n,appData:i}),d=new m.DataProducer({id:c,dataChannel:s,sctpStreamParameters:o,appData:i});return this._dataProducers.set(d.id,d),this._handleDataProducer(d),this._observer.safeEmit("newdataproducer",d),d}),"transport.produceData()")}async consumeData({id:e,dataProducerId:t,sctpStreamParameters:r,label:a="",protocol:n="",appData:i={}}){if(g.debug("consumeData()"),r=p.clone(r,void 0),this._closed)throw new d.InvalidStateError("closed");if("recv"!==this._direction)throw new d.UnsupportedError("not a receiving Transport");if(!this._maxSctpMessageSize)throw new d.UnsupportedError("SCTP not enabled by remote Transport");if("string"!=typeof e)throw new TypeError("missing id");if("string"!=typeof t)throw new TypeError("missing dataProducerId");if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError('no "connect" listener set into this transport');if(i&&"object"!=typeof i)throw new TypeError("if given, appData must be an object");return u.validateSctpStreamParameters(r),this._awaitQueue.push((async()=>{const{dataChannel:s}=await this._handler.receiveDataChannel({sctpStreamParameters:r,label:a,protocol:n}),o=new f.DataConsumer({id:e,dataProducerId:t,dataChannel:s,sctpStreamParameters:r,appData:i});return this._dataConsumers.set(o.id,o),this._handleDataConsumer(o),this._observer.safeEmit("newdataconsumer",o),o}),"transport.consumeData()")}_handleHandler(){const e=this._handler;e.on("@connect",(({dtlsParameters:e},t,r)=>{this._closed?r(new d.InvalidStateError("closed")):this.safeEmit("connect",{dtlsParameters:e},t,r)})),e.on("@connectionstatechange",(e=>{e!==this._connectionState&&(g.debug("connection state changed to %s",e),this._connectionState=e,this._closed||this.safeEmit("connectionstatechange",e))}))}_handleProducer(e){e.on("@close",(()=>{this._producers.delete(e.id),this._closed||this._awaitQueue.push((async()=>this._handler.stopSending(e.localId)),"producer @close event").catch((e=>g.warn("producer.close() failed:%o",e)))})),e.on("@replacetrack",((t,r,a)=>{this._awaitQueue.push((async()=>this._handler.replaceTrack(e.localId,t)),"producer @replacetrack event").then(r).catch(a)})),e.on("@setmaxspatiallayer",((t,r,a)=>{this._awaitQueue.push((async()=>this._handler.setMaxSpatialLayer(e.localId,t)),"producer @setmaxspatiallayer event").then(r).catch(a)})),e.on("@setrtpencodingparameters",((t,r,a)=>{this._awaitQueue.push((async()=>this._handler.setRtpEncodingParameters(e.localId,t)),"producer @setrtpencodingparameters event").then(r).catch(a)})),e.on("@getstats",((t,r)=>{if(this._closed)return r(new d.InvalidStateError("closed"));this._handler.getSenderStats(e.localId).then(t).catch(r)}))}_handleConsumer(e){e.on("@close",(()=>{this._consumers.delete(e.id),this._closed||this._awaitQueue.push((async()=>this._handler.stopReceiving(e.localId)),"consumer @close event").catch((()=>{}))})),e.on("@getstats",((t,r)=>{if(this._closed)return r(new d.InvalidStateError("closed"));this._handler.getReceiverStats(e.localId).then(t).catch(r)}))}_handleDataProducer(e){e.on("@close",(()=>{this._dataProducers.delete(e.id)}))}_handleDataConsumer(e){e.on("@close",(()=>{this._dataConsumers.delete(e.id)}))}}t.Transport=_},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Producer=void 0;const a=r(5),n=r(15),i=r(8),s=new a.Logger("Producer");class o extends n.EnhancedEventEmitter{constructor({id:e,localId:t,rtpSender:r,track:a,rtpParameters:i,stopTracks:o,disableTrackOnPause:c,zeroRtpOnPause:d,appData:p}){super(),this._closed=!1,this._observer=new n.EnhancedEventEmitter,s.debug("constructor()"),this._id=e,this._localId=t,this._rtpSender=r,this._track=a,this._kind=a.kind,this._rtpParameters=i,this._paused=!!c&&!a.enabled,this._maxSpatialLayer=void 0,this._stopTracks=o,this._disableTrackOnPause=c,this._zeroRtpOnPause=d,this._appData=p,this._onTrackEnded=this._onTrackEnded.bind(this),this._handleTrack()}get id(){return this._id}get localId(){return this._localId}get closed(){return this._closed}get kind(){return this._kind}get rtpSender(){return this._rtpSender}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get maxSpatialLayer(){return this._maxSpatialLayer}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||(s.debug("close()"),this._closed=!0,this._destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(s.debug("transportClosed()"),this._closed=!0,this._destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new i.InvalidStateError("closed");return this.safeEmitAsPromise("@getstats")}pause(){s.debug("pause()"),this._closed?s.error("pause() | Producer closed"):(this._paused=!0,this._track&&this._disableTrackOnPause&&(this._track.enabled=!1),this._zeroRtpOnPause&&this.safeEmitAsPromise("@replacetrack",null).catch((()=>{})),this._observer.safeEmit("pause"))}resume(){s.debug("resume()"),this._closed?s.error("resume() | Producer closed"):(this._paused=!1,this._track&&this._disableTrackOnPause&&(this._track.enabled=!0),this._zeroRtpOnPause&&this.safeEmitAsPromise("@replacetrack",this._track).catch((()=>{})),this._observer.safeEmit("resume"))}async replaceTrack({track:e}){if(s.debug("replaceTrack() [track:%o]",e),this._closed){if(e&&this._stopTracks)try{e.stop()}catch(e){}throw new i.InvalidStateError("closed")}if(e&&"ended"===e.readyState)throw new i.InvalidStateError("track ended");e!==this._track?(this._zeroRtpOnPause&&this._paused||await this.safeEmitAsPromise("@replacetrack",e),this._destroyTrack(),this._track=e,this._track&&this._disableTrackOnPause&&(this._paused?this._paused&&(this._track.enabled=!1):this._track.enabled=!0),this._handleTrack()):s.debug("replaceTrack() | same track, ignored")}async setMaxSpatialLayer(e){if(this._closed)throw new i.InvalidStateError("closed");if("video"!==this._kind)throw new i.UnsupportedError("not a video Producer");if("number"!=typeof e)throw new TypeError("invalid spatialLayer");e!==this._maxSpatialLayer&&(await this.safeEmitAsPromise("@setmaxspatiallayer",e),this._maxSpatialLayer=e)}async setRtpEncodingParameters(e){if(this._closed)throw new i.InvalidStateError("closed");if("object"!=typeof e)throw new TypeError("invalid params");await this.safeEmitAsPromise("@setrtpencodingparameters",e)}_onTrackEnded(){s.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}_handleTrack(){this._track&&this._track.addEventListener("ended",this._onTrackEnded)}_destroyTrack(){if(this._track)try{this._track.removeEventListener("ended",this._onTrackEnded),this._stopTracks&&this._track.stop()}catch(e){}}}t.Producer=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Consumer=void 0;const a=r(5),n=r(15),i=r(8),s=new a.Logger("Consumer");class o extends n.EnhancedEventEmitter{constructor({id:e,localId:t,producerId:r,rtpReceiver:a,track:i,rtpParameters:o,appData:c}){super(),this._closed=!1,this._observer=new n.EnhancedEventEmitter,s.debug("constructor()"),this._id=e,this._localId=t,this._producerId=r,this._rtpReceiver=a,this._track=i,this._rtpParameters=o,this._paused=!i.enabled,this._appData=c,this._onTrackEnded=this._onTrackEnded.bind(this),this._handleTrack()}get id(){return this._id}get localId(){return this._localId}get producerId(){return this._producerId}get closed(){return this._closed}get kind(){return this._track.kind}get rtpReceiver(){return this._rtpReceiver}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||(s.debug("close()"),this._closed=!0,this._destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(s.debug("transportClosed()"),this._closed=!0,this._destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new i.InvalidStateError("closed");return this.safeEmitAsPromise("@getstats")}pause(){s.debug("pause()"),this._closed?s.error("pause() | Consumer closed"):(this._paused=!0,this._track.enabled=!1,this._observer.safeEmit("pause"))}resume(){s.debug("resume()"),this._closed?s.error("resume() | Consumer closed"):(this._paused=!1,this._track.enabled=!0,this._observer.safeEmit("resume"))}_onTrackEnded(){s.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}_handleTrack(){this._track.addEventListener("ended",this._onTrackEnded)}_destroyTrack(){try{this._track.removeEventListener("ended",this._onTrackEnded),this._track.stop()}catch(e){}}}t.Consumer=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DataProducer=void 0;const a=r(5),n=r(15),i=r(8),s=new a.Logger("DataProducer");class o extends n.EnhancedEventEmitter{constructor({id:e,dataChannel:t,sctpStreamParameters:r,appData:a}){super(),this._closed=!1,this._observer=new n.EnhancedEventEmitter,s.debug("constructor()"),this._id=e,this._dataChannel=t,this._sctpStreamParameters=r,this._appData=a,this._handleDataChannel()}get id(){return this._id}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get bufferedAmount(){return this._dataChannel.bufferedAmount}get bufferedAmountLowThreshold(){return this._dataChannel.bufferedAmountLowThreshold}set bufferedAmountLowThreshold(e){this._dataChannel.bufferedAmountLowThreshold=e}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||(s.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(s.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}send(e){if(s.debug("send()"),this._closed)throw new i.InvalidStateError("closed");this._dataChannel.send(e)}_handleDataChannel(){this._dataChannel.addEventListener("open",(()=>{this._closed||(s.debug('DataChannel "open" event'),this.safeEmit("open"))})),this._dataChannel.addEventListener("error",(e=>{if(this._closed)return;let{error:t}=e;t||(t=new Error("unknown DataChannel error")),"sctp-failure"===t.errorDetail?s.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",t.sctpCauseCode,t.message):s.error('DataChannel "error" event: %o',t),this.safeEmit("error",t)})),this._dataChannel.addEventListener("close",(()=>{this._closed||(s.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"))})),this._dataChannel.addEventListener("message",(()=>{this._closed||s.warn('DataChannel "message" event in a DataProducer, message discarded')})),this._dataChannel.addEventListener("bufferedamountlow",(()=>{this._closed||this.safeEmit("bufferedamountlow")}))}}t.DataProducer=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DataConsumer=void 0;const a=r(5),n=r(15),i=new a.Logger("DataConsumer");class s extends n.EnhancedEventEmitter{constructor({id:e,dataProducerId:t,dataChannel:r,sctpStreamParameters:a,appData:s}){super(),this._closed=!1,this._observer=new n.EnhancedEventEmitter,i.debug("constructor()"),this._id=e,this._dataProducerId=t,this._dataChannel=r,this._sctpStreamParameters=a,this._appData=s,this._handleDataChannel()}get id(){return this._id}get dataProducerId(){return this._dataProducerId}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get binaryType(){return this._dataChannel.binaryType}set binaryType(e){this._dataChannel.binaryType=e}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||(i.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(i.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}_handleDataChannel(){this._dataChannel.addEventListener("open",(()=>{this._closed||(i.debug('DataChannel "open" event'),this.safeEmit("open"))})),this._dataChannel.addEventListener("error",(e=>{if(this._closed)return;let{error:t}=e;t||(t=new Error("unknown DataChannel error")),"sctp-failure"===t.errorDetail?i.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",t.sctpCauseCode,t.message):i.error('DataChannel "error" event: %o',t),this.safeEmit("error",t)})),this._dataChannel.addEventListener("close",(()=>{this._closed||(i.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"))})),this._dataChannel.addEventListener("message",(e=>{this._closed||this.safeEmit("message",e.data)}))}}t.DataConsumer=s},function(e,t){var r=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",t+=null!=e.rateNumerator?" rate=%s":"",t+=null!=e.rateDenominator?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(r).forEach((function(e){r[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))}))},function(e,t){e.exports=function(e,t,r){if(!t.has(e))throw new TypeError("attempted to "+r+" private field on non-instance");return t.get(e)},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){"use strict";function a(e){var t,r=e.Symbol;return"function"==typeof r?r.observable?t=r.observable:(t=r("observable"),r.observable=t):t="@@observable",t}r.d(t,"a",(function(){return a}))},function(e,t){e.exports=function(e){if(null==e)throw new TypeError("Cannot destructure undefined")},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){var a=r(84),n=r(40);e.exports=function(e,t){var r=n(e,t,"get");return a(e,r)},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){var a=r(85),n=r(40);e.exports=function(e,t,r){var i=n(e,t,"set");return a(e,i,r),r},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){var a=r(28);e.exports=function(e){if(Array.isArray(e))return a(e)},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t){e.exports=function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){var a=r(28);e.exports=function(e,t){if(e){if("string"==typeof e)return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(e,t):void 0}},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t){e.exports=function(e){if(!e.webpackPolyfill){var t=Object.create(e);t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),Object.defineProperty(t,"exports",{enumerable:!0}),t.webpackPolyfill=1}return t}},function(e,t,r){var a=function(e){"use strict";var t,r=Object.prototype,a=r.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",s=n.asyncIterator||"@@asyncIterator",o=n.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function d(e,t,r,a){var n=t&&t.prototype instanceof g?t:g,i=Object.create(n.prototype),s=new T(a||[]);return i._invoke=function(e,t,r){var a=u;return function(n,i){if(a===h)throw new Error("Generator is already running");if(a===m){if("throw"===n)throw i;return O()}for(r.method=n,r.arg=i;;){var s=r.delegate;if(s){var o=C(s,r);if(o){if(o===f)continue;return o}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(a===u)throw a=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);a=h;var c=p(e,t,r);if("normal"===c.type){if(a=r.done?m:l,c.arg===f)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(a=m,r.method="throw",r.arg=c.arg)}}}(e,r,s),i}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=d;var u="suspendedStart",l="suspendedYield",h="executing",m="completed",f={};function g(){}function _(){}function v(){}var b={};b[i]=function(){return this};var y=Object.getPrototypeOf,w=y&&y(y(x([])));w&&w!==r&&a.call(w,i)&&(b=w);var S=v.prototype=g.prototype=Object.create(b);function P(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function R(e,t){function r(n,i,s,o){var c=p(e[n],e,i);if("throw"!==c.type){var d=c.arg,u=d.value;return u&&"object"==typeof u&&a.call(u,"__await")?t.resolve(u.__await).then((function(e){r("next",e,s,o)}),(function(e){r("throw",e,s,o)})):t.resolve(u).then((function(e){d.value=e,s(d)}),(function(e){return r("throw",e,s,o)}))}o(c.arg)}var n;this._invoke=function(e,a){function i(){return new t((function(t,n){r(e,a,t,n)}))}return n=n?n.then(i,i):i()}}function C(e,r){var a=e.iterator[r.method];if(a===t){if(r.delegate=null,"throw"===r.method){if(e.iterator.return&&(r.method="return",r.arg=t,C(e,r),"throw"===r.method))return f;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var n=p(a,e.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,f;var i=n.arg;return i?i.done?(r[e.resultName]=i.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,f):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,f)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function x(e){if(e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,s=function r(){for(;++n<e.length;)if(a.call(e,n))return r.value=e[n],r.done=!1,r;return r.value=t,r.done=!0,r};return s.next=s}}return{next:O}}function O(){return{value:t,done:!0}}return _.prototype=S.constructor=v,v.constructor=_,_.displayName=c(v,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===_||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,c(e,o,"GeneratorFunction")),e.prototype=Object.create(S),e},e.awrap=function(e){return{__await:e}},P(R.prototype),R.prototype[s]=function(){return this},e.AsyncIterator=R,e.async=function(t,r,a,n,i){void 0===i&&(i=Promise);var s=new R(d(t,r,a,n),i);return e.isGeneratorFunction(r)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},P(S),c(S,o,"Generator"),S[i]=function(){return this},S.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var a=t.pop();if(a in e)return r.value=a,r.done=!1,r}return r.done=!0,r}},e.values=x,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(E),!e)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(a,n){return o.type="throw",o.arg=e,r.next=a,n&&(r.method="next",r.arg=t),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var s=this.tryEntries[i],o=s.completion;if("root"===s.tryLoc)return n("end");if(s.tryLoc<=this.prev){var c=a.call(s,"catchLoc"),d=a.call(s,"finallyLoc");if(c&&d){if(this.prev<s.catchLoc)return n(s.catchLoc,!0);if(this.prev<s.finallyLoc)return n(s.finallyLoc)}else if(c){if(this.prev<s.catchLoc)return n(s.catchLoc,!0)}else{if(!d)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return n(s.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&a.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var s=i?i.completion:{};return s.type=e,s.arg=t,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),E(r),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var a=r.completion;if("throw"===a.type){var n=a.arg;E(r)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,a){return this.delegate={iterator:x(e),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=t),f}},e}(e.exports);try{regeneratorRuntime=a}catch(e){Function("r","regeneratorRuntime = r")(a)}},function(e){e.exports=JSON.parse('{"name":"protoo-client","version":"4.0.6","description":"protoo JavaScript client module","author":"Iñaki Baz Castillo <ibc@aliax.net>","homepage":"https://protoo.versatica.com","license":"MIT","repository":{"type":"git","url":"https://github.com/ibc/protoo.git"},"main":"lib/index.js","keywords":["nodejs","browser","websocket"],"engines":{"node":">=8.0.0"},"scripts":{"lint":"eslint -c .eslintrc.js lib"},"dependencies":{"debug":"^4.3.1","events":"^3.2.0","retry":"^0.12.0"},"devDependencies":{"eslint":"^5.16.0"},"optionalDependencies":{"websocket":"^1.0.33"}}')},function(e,t,r){const a=r(20),n=r(31),i=r(32),s=new a("Peer");e.exports=class extends n{constructor(e){super(s),s.debug("constructor()"),this._closed=!1,this._transport=e,this._connected=!1,this._data={},this._sents=new Map,this._handleTransport()}get closed(){return this._closed}get connected(){return this._connected}get data(){return this._data}set data(e){throw new Error("cannot override data object")}close(){if(!this._closed){s.debug("close()"),this._closed=!0,this._connected=!1,this._transport.close();for(const e of this._sents.values())e.close();this.safeEmit("close")}}async request(e,t){const r=i.createRequest(e,t);return this._logger.debug("request() [method:%s, id:%s]",e,r.id),await this._transport.send(r),new Promise(((e,t)=>{const a=1500*(15+.1*this._sents.size),n={id:r.id,method:r.method,resolve:t=>{this._sents.delete(r.id)&&(clearTimeout(n.timer),e(t))},reject:e=>{this._sents.delete(r.id)&&(clearTimeout(n.timer),t(e))},timer:setTimeout((()=>{this._sents.delete(r.id)&&t(new Error("request timeout"))}),a),close:()=>{clearTimeout(n.timer),t(new Error("peer closed"))}};this._sents.set(r.id,n)}))}async notify(e,t){const r=i.createNotification(e,t);this._logger.debug("notify() [method:%s]",e),await this._transport.send(r)}_handleTransport(){if(this._transport.closed)return this._closed=!0,void setTimeout((()=>{this._closed||(this._connected=!1,this.safeEmit("close"))}));this._transport.on("open",(()=>{this._closed||(s.debug('emit "open"'),this._connected=!0,this.safeEmit("open"))})),this._transport.on("disconnected",(()=>{this._closed||(s.debug('emit "disconnected"'),this._connected=!1,this.safeEmit("disconnected"))})),this._transport.on("failed",(e=>{this._closed||(s.debug('emit "failed" [currentAttempt:%s]',e),this._connected=!1,this.safeEmit("failed",e))})),this._transport.on("close",(()=>{this._closed||(this._closed=!0,s.debug('emit "close"'),this._connected=!1,this.safeEmit("close"))})),this._transport.on("message",(e=>{e.request?this._handleRequest(e):e.response?this._handleResponse(e):e.notification&&this._handleNotification(e)}))}_handleRequest(e){try{this.emit("request",e,(t=>{const r=i.createSuccessResponse(e,t);this._transport.send(r).catch((()=>{}))}),((t,r)=>{t instanceof Error?(r=t.message,t=500):"number"==typeof t&&r instanceof Error&&(r=r.message);const a=i.createErrorResponse(e,t,r);this._transport.send(a).catch((()=>{}))}))}catch(t){const r=i.createErrorResponse(e,500,String(t));this._transport.send(r).catch((()=>{}))}}_handleResponse(e){const t=this._sents.get(e.id);if(t)if(e.ok)t.resolve(e.data);else{const r=new Error(e.errorReason);r.code=e.errorCode,t.reject(r)}else s.error("received response does not match any sent request [id:%s]",e.id)}_handleNotification(e){this.safeEmit("notification",e)}}},function(e,t,r){e.exports=function(e){function t(e){let r,n,i,s=null;function o(...e){if(!o.enabled)return;const a=o,n=Number(new Date),i=n-(r||n);a.diff=i,a.prev=r,a.curr=n,r=n,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let s=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((r,n)=>{if("%%"===r)return"%";s++;const i=t.formatters[n];if("function"==typeof i){const t=e[s];r=i.call(a,t),e.splice(s,1),s--}return r})),t.formatArgs.call(a,e);(a.log||t.log).apply(a,e)}return o.namespace=e,o.useColors=t.useColors(),o.color=t.selectColor(e),o.extend=a,o.destroy=t.destroy,Object.defineProperty(o,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==s?s:(n!==t.namespaces&&(n=t.namespaces,i=t.enabled(e)),i),set:e=>{s=e}}),"function"==typeof t.init&&t.init(o),o}function a(e,r){const a=t(this.namespace+(void 0===r?":":r)+e);return a.log=this.log,a}function n(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},t.disable=function(){const e=[...t.names.map(n),...t.skips.map(n).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let r;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const a=("string"==typeof e?e:"").split(/[\s,]+/),n=a.length;for(r=0;r<n;r++)a[r]&&("-"===(e=a[r].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let r,a;for(r=0,a=t.skips.length;r<a;r++)if(t.skips[r].test(e))return!1;for(r=0,a=t.names.length;r<a;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=r(30),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((r=>{t[r]=e[r]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let r=0;for(let t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return t.colors[Math.abs(r)%t.colors.length]},t.enable(t.load()),t}},function(e,t){t.generateRandomNumber=function(){return Math.round(1e7*Math.random())}},function(e,t,r){const a=r(57).w3cwebsocket,n=r(61),i=r(20),s=r(31),o=r(32),c={retries:10,factor:2,minTimeout:1e3,maxTimeout:8e3},d=new i("WebSocketTransport");e.exports=class extends s{constructor(e,t){super(d),d.debug("constructor() [url:%s, options:%o]",e,t),this._closed=!1,this._url=e,this._options=t||{},this._ws=null,this._runWebSocket()}get closed(){return this._closed}close(){if(!this._closed){d.debug("close()"),this._closed=!0,this.safeEmit("close");try{this._ws.onopen=null,this._ws.onclose=null,this._ws.onerror=null,this._ws.onmessage=null,this._ws.close()}catch(e){d.error("close() | error closing the WebSocket: %o",e)}}}async send(e){if(this._closed)throw new Error("transport closed");try{this._ws.send(JSON.stringify(e))}catch(e){throw d.warn("send() failed:%o",e),e}}_runWebSocket(){const e=n.operation(this._options.retry||c);let t=!1;e.attempt((r=>{this._closed?e.stop():(d.debug("_runWebSocket() [currentAttempt:%s]",r),this._ws=new a(this._url,"protoo",this._options.origin,this._options.headers,this._options.requestOptions,this._options.clientConfig),this._ws.onopen=()=>{this._closed||(t=!0,this.safeEmit("open"))},this._ws.onclose=a=>{if(!this._closed){if(d.warn('WebSocket "close" event [wasClean:%s, code:%s, reason:"%s"]',a.wasClean,a.code,a.reason),4e3!==a.code){if(t){if(e.stop(),this.safeEmit("disconnected"),this._closed)return;return void this._runWebSocket()}if(this.safeEmit("failed",r),this._closed)return;if(e.retry(!0))return}this._closed=!0,this.safeEmit("close")}},this._ws.onerror=()=>{this._closed||d.error('WebSocket "error" event')},this._ws.onmessage=e=>{if(this._closed)return;const t=o.parse(e.data);t&&(0!==this.listenerCount("message")?this.safeEmit("message",t):d.error('no listeners for WebSocket "message" event, ignoring received message'))})}))}}},function(e,t,r){var a;if("object"==typeof globalThis)a=globalThis;else try{a=r(58)}catch(e){}finally{if(a||"undefined"==typeof window||(a=window),!a)throw new Error("Could not determine global this")}var n=a.WebSocket||a.MozWebSocket,i=r(59);function s(e,t){return t?new n(e,t):new n(e)}n&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach((function(e){Object.defineProperty(s,e,{get:function(){return n[e]}})})),e.exports={w3cwebsocket:n?s:null,version:i}},function(e,t){var r=function(){if("object"==typeof self&&self)return self;if("object"==typeof window&&window)return window;throw new Error("Unable to resolve global `this`")};e.exports=function(){if(this)return this;if("object"==typeof globalThis&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch(e){return r()}try{return __global__||r()}finally{delete Object.prototype.__global__}}()},function(e,t,r){e.exports=r(60).version},function(e){e.exports=JSON.parse('{"name":"websocket","description":"Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.","keywords":["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],"author":"Brian McKelvey <theturtle32@gmail.com> (https://github.com/theturtle32)","contributors":["Iñaki Baz Castillo <ibc@aliax.net> (http://dev.sipdoc.net)"],"version":"1.0.34","repository":{"type":"git","url":"https://github.com/theturtle32/WebSocket-Node.git"},"homepage":"https://github.com/theturtle32/WebSocket-Node","engines":{"node":">=4.0.0"},"dependencies":{"bufferutil":"^4.0.1","debug":"^2.2.0","es5-ext":"^0.10.50","typedarray-to-buffer":"^3.1.5","utf-8-validate":"^5.0.2","yaeti":"^0.0.6"},"devDependencies":{"buffer-equal":"^1.0.0","gulp":"^4.0.2","gulp-jshint":"^2.0.4","jshint-stylish":"^2.2.1","jshint":"^2.0.0","tape":"^4.9.1"},"config":{"verbose":false},"scripts":{"test":"tape test/unit/*.js","gulp":"gulp"},"main":"index","directories":{"lib":"./lib"},"browser":"lib/browser.js","license":"Apache-2.0"}')},function(e,t,r){e.exports=r(62)},function(e,t,r){var a=r(63);t.operation=function(e){var r=t.timeouts(e);return new a(r,{forever:e&&e.forever,unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},t.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var r in e)t[r]=e[r];if(t.minTimeout>t.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var a=[],n=0;n<t.retries;n++)a.push(this.createTimeout(n,t));return e&&e.forever&&!a.length&&a.push(this.createTimeout(n,t)),a.sort((function(e,t){return e-t})),a},t.createTimeout=function(e,t){var r=t.randomize?Math.random()+1:1,a=Math.round(r*t.minTimeout*Math.pow(t.factor,e));return a=Math.min(a,t.maxTimeout)},t.wrap=function(e,r,a){if(r instanceof Array&&(a=r,r=null),!a)for(var n in a=[],e)"function"==typeof e[n]&&a.push(n);for(var i=0;i<a.length;i++){var s=a[i],o=e[s];e[s]=function(a){var n=t.operation(r),i=Array.prototype.slice.call(arguments,1),s=i.pop();i.push((function(e){n.retry(e)||(e&&(arguments[0]=n.mainError()),s.apply(this,arguments))})),n.attempt((function(){a.apply(e,i)}))}.bind(e,o),e[s].options=r}}},function(e,t){function r(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}e.exports=r,r.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts},r.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timeouts=[],this._cachedTimeouts=null},r.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=(new Date).getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(void 0===r){if(!this._cachedTimeouts)return!1;this._errors.splice(this._errors.length-1,this._errors.length),this._timeouts=this._cachedTimeouts.slice(0),r=this._timeouts.shift()}var a=this,n=setTimeout((function(){a._attempts++,a._operationTimeoutCb&&(a._timeout=setTimeout((function(){a._operationTimeoutCb(a._attempts)}),a._operationTimeout),a._options.unref&&a._timeout.unref()),a._fn(a._attempts)}),r);return this._options.unref&&n.unref(),!0},r.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout((function(){r._operationTimeoutCb()}),r._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},r.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},r.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},r.prototype.start=r.prototype.try,r.prototype.errors=function(){return this._errors},r.prototype.attempts=function(){return this._attempts},r.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,r=0,a=0;a<this._errors.length;a++){var n=this._errors[a],i=n.message,s=(e[i]||0)+1;e[i]=s,s>=r&&(t=n,r=s)}return t}},function(e,t,r){const a=r(65)("h264-profile-level-id");a.log=console.info.bind(console);t.ProfileConstrainedBaseline=1,t.ProfileBaseline=2,t.ProfileMain=3,t.ProfileConstrainedHigh=4,t.ProfileHigh=5;const n=10;t.Level1_b=0,t.Level1=10,t.Level1_1=11,t.Level1_2=12,t.Level1_3=13,t.Level2=20,t.Level2_1=21,t.Level2_2=22,t.Level3=30,t.Level3_1=31,t.Level3_2=32,t.Level4=40,t.Level4_1=41,t.Level4_2=42,t.Level5=50,t.Level5_1=51,t.Level5_2=52;class i{constructor(e,t){this.profile=e,this.level=t}}t.ProfileLevelId=i;const s=new i(1,31);class o{constructor(e){this._mask=~p("x",e),this._maskedValue=p("1",e)}isMatch(e){return this._maskedValue===(e&this._mask)}}class c{constructor(e,t,r){this.profile_idc=e,this.profile_iop=t,this.profile=r}}const d=[new c(66,new o("x1xx0000"),1),new c(77,new o("1xxx0000"),1),new c(88,new o("11xx0000"),1),new c(66,new o("x0xx0000"),2),new c(88,new o("10xx0000"),2),new c(77,new o("0x0x0000"),3),new c(100,new o("00000000"),5),new c(100,new o("00001100"),4)];function p(e,t){return(t[0]===e)<<7|(t[1]===e)<<6|(t[2]===e)<<5|(t[3]===e)<<4|(t[4]===e)<<3|(t[5]===e)<<2|(t[6]===e)<<1|(t[7]===e)<<0}function u(e={}){const t=e["level-asymmetry-allowed"];return 1===t||"1"===t}t.parseProfileLevelId=function(e){if("string"!=typeof e||6!==e.length)return null;const t=parseInt(e,16);if(0===t)return null;const r=255&t,n=t>>8&255,s=t>>16&255;let o;switch(r){case 11:o=0!=(16&n)?0:11;break;case 10:case 12:case 13:case 20:case 21:case 22:case 30:case 31:case 32:case 40:case 41:case 42:case 50:case 51:case 52:o=r;break;default:return a("parseProfileLevelId() | unrecognized level_idc:%s",r),null}for(const e of d)if(s===e.profile_idc&&e.profile_iop.isMatch(n))return new i(e.profile,o);return a("parseProfileLevelId() | unrecognized profile_idc/profile_iop combination"),null},t.profileLevelIdToString=function(e){if(0==e.level)switch(e.profile){case 1:return"42f00b";case 2:return"42100b";case 3:return"4d100b";default:return a("profileLevelIdToString() | Level 1_b not is allowed for profile:%s",e.profile),null}let t;switch(e.profile){case 1:t="42e0";break;case 2:t="4200";break;case 3:t="4d00";break;case 4:t="640c";break;case 5:t="6400";break;default:return a("profileLevelIdToString() | unrecognized profile:%s",e.profile),null}let r=e.level.toString(16);return 1===r.length&&(r=`0${r}`),`${t}${r}`},t.parseSdpProfileLevelId=function(e={}){const r=e["profile-level-id"];return r?t.parseProfileLevelId(r):s},t.isSameProfile=function(e={},r={}){const a=t.parseSdpProfileLevelId(e),n=t.parseSdpProfileLevelId(r);return Boolean(a&&n&&a.profile===n.profile)},t.generateProfileLevelIdForAnswer=function(e={},r={}){if(!e["profile-level-id"]&&!r["profile-level-id"])return a("generateProfileLevelIdForAnswer() | no profile-level-id in local and remote params"),null;const s=t.parseSdpProfileLevelId(e),o=t.parseSdpProfileLevelId(r);if(!s)throw new TypeError("invalid local_profile_level_id");if(!o)throw new TypeError("invalid remote_profile_level_id");if(s.profile!==o.profile)throw new TypeError("H264 Profile mismatch");const c=u(e)&&u(r),d=s.level,p=o.level,l=function(e,t){return 0===e?t!==n&&0!==t:0===t?e!==n:e<t}(h=d,m=p)?h:m;var h,m;const f=c?d:l;return a("generateProfileLevelIdForAnswer() | result: [profile:%s, level:%s]",s.profile,f),t.profileLevelIdToString(new i(s.profile,f))}},function(e,t,r){(function(a){t.log=function(...e){return"object"==typeof console&&console.log&&console.log(...e)},t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;t.splice(1,0,r,"color: inherit");let a=0,n=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(a++,"%c"===e&&(n=a))})),t.splice(n,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}!e&&void 0!==a&&"env"in a&&(e=a.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.exports=r(66)(t);const{formatters:n}=e.exports;n.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this,r(29))},function(e,t,r){e.exports=function(e){function t(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return a.colors[Math.abs(t)%a.colors.length]}function a(e){let r;function s(...e){if(!s.enabled)return;const t=s,n=Number(new Date),i=n-(r||n);t.diff=i,t.prev=r,t.curr=n,r=n,e[0]=a.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let o=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((r,n)=>{if("%%"===r)return r;o++;const i=a.formatters[n];if("function"==typeof i){const a=e[o];r=i.call(t,a),e.splice(o,1),o--}return r})),a.formatArgs.call(t,e);(t.log||a.log).apply(t,e)}return s.namespace=e,s.enabled=a.enabled(e),s.useColors=a.useColors(),s.color=t(e),s.destroy=n,s.extend=i,"function"==typeof a.init&&a.init(s),a.instances.push(s),s}function n(){const e=a.instances.indexOf(this);return-1!==e&&(a.instances.splice(e,1),!0)}function i(e,t){const r=a(this.namespace+(void 0===t?":":t)+e);return r.log=this.log,r}function s(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return a.debug=a,a.default=a,a.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},a.disable=function(){const e=[...a.names.map(s),...a.skips.map(s).map((e=>"-"+e))].join(",");return a.enable(""),e},a.enable=function(e){let t;a.save(e),a.names=[],a.skips=[];const r=("string"==typeof e?e:"").split(/[\s,]+/),n=r.length;for(t=0;t<n;t++)r[t]&&("-"===(e=r[t].replace(/\*/g,".*?"))[0]?a.skips.push(new RegExp("^"+e.substr(1)+"$")):a.names.push(new RegExp("^"+e+"$")));for(t=0;t<a.instances.length;t++){const e=a.instances[t];e.enabled=a.enabled(e.namespace)}},a.enabled=function(e){if("*"===e[e.length-1])return!0;let t,r;for(t=0,r=a.skips.length;t<r;t++)if(a.skips[t].test(e))return!1;for(t=0,r=a.names.length;t<r;t++)if(a.names[t].test(e))return!0;return!1},a.humanize=r(30),Object.keys(e).forEach((t=>{a[t]=e[t]})),a.instances=[],a.names=[],a.skips=[],a.formatters={},a.selectColor=t,a.enable(a.load()),a}},function(e,t,r){"use strict";var a=this&&this.__awaiter||function(e,t,r,a){return new(r||(r=Promise))((function(n,i){function s(e){try{c(a.next(e))}catch(e){i(e)}}function o(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,o)}c((a=a.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.AwaitQueue=class{constructor({ClosedErrorClass:e=Error,StoppedErrorClass:t=Error}={ClosedErrorClass:Error,StoppedErrorClass:Error}){this.closed=!1,this.pendingTasks=[],this.ClosedErrorClass=Error,this.StoppedErrorClass=Error,this.ClosedErrorClass=e,this.StoppedErrorClass=t}get size(){return this.pendingTasks.length}close(){if(!this.closed){this.closed=!0;for(const e of this.pendingTasks)e.stopped=!0,e.reject(new this.ClosedErrorClass("AwaitQueue closed"));this.pendingTasks.length=0}}push(e,t){return a(this,void 0,void 0,(function*(){if(this.closed)throw new this.ClosedErrorClass("AwaitQueue closed");if("function"!=typeof e)throw new TypeError("given task is not a function");if(!e.name&&t)try{Object.defineProperty(e,"name",{value:t})}catch(e){}return new Promise(((r,a)=>{const n={task:e,name:t,resolve:r,reject:a,stopped:!1,enqueuedAt:new Date,executedAt:void 0};this.pendingTasks.push(n),1===this.pendingTasks.length&&this.next()}))}))}stop(){if(!this.closed){for(const e of this.pendingTasks)e.stopped=!0,e.reject(new this.StoppedErrorClass("AwaitQueue stopped"));this.pendingTasks.length=0}}dump(){const e=new Date;return this.pendingTasks.map((t=>({task:t.task,name:t.name,enqueuedTime:t.executedAt?t.executedAt.getTime()-t.enqueuedAt.getTime():e.getTime()-t.enqueuedAt.getTime(),executingTime:t.executedAt?e.getTime()-t.executedAt.getTime():0})))}next(){return a(this,void 0,void 0,(function*(){const e=this.pendingTasks[0];e&&(yield this.executeTask(e),this.pendingTasks.shift(),this.next())}))}executeTask(e){return a(this,void 0,void 0,(function*(){if(!e.stopped){e.executedAt=new Date;try{const t=yield e.task();if(e.stopped)return;e.resolve(t)}catch(t){if(e.stopped)return;e.reject(t)}}}))}}},function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.hasOwnProperty.call(e,r)&&a(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Chrome74=void 0;const s=i(r(9)),o=r(5),c=i(r(6)),d=i(r(7)),p=i(r(13)),u=i(r(21)),l=r(10),h=r(14),m=r(24),f=new o.Logger("Chrome74"),g={OS:1024,MIS:1024};class _ extends l.HandlerInterface{constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new _}get name(){return"Chrome74"}close(){if(f.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){f.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");const t=await e.createOffer();try{e.close()}catch(e){}const r=s.parse(t.sdp);return p.extractRtpCapabilities({sdpObject:r})}catch(t){try{e.close()}catch(e){}throw t}}async getNativeSctpCapabilities(){return f.debug("getNativeSctpCapabilities()"),{numStreams:g}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:i,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:p}){f.debug("run()"),this._direction=e,this._remoteSdp=new h.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n}),this._sendingRtpParametersByKind={audio:d.getSendingRtpParameters("audio",p),video:d.getSendingRtpParameters("video",p)},this._sendingRemoteRtpParametersByKind={audio:d.getSendingRemoteRtpParameters("audio",p),video:d.getSendingRemoteRtpParameters("video",p)},this._pc=new RTCPeerConnection(Object.assign({iceServers:i||[],iceTransportPolicy:s||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"},o),c),this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}async updateIceServers(e){f.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(f.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});f.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();f.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:a}){this._assertSendDirection(),f.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&t.length>1&&t.forEach(((e,t)=>{e.rid=`r${t}`}));const n=c.clone(this._sendingRtpParametersByKind[e.kind],{});n.codecs=d.reduceCodecs(n.codecs,a);const i=c.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});i.codecs=d.reduceCodecs(i.codecs,a);const o=this._remoteSdp.getNextMediaSectionIdx(),l=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:t});let h,g=await this._pc.createOffer(),_=s.parse(g.sdp);this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:_});let v=!1;const b=m.parse((t||[{}])[0].scalabilityMode);t&&1===t.length&&b.spatialLayers>1&&"video/vp9"===n.codecs[0].mimeType.toLowerCase()&&(f.debug("send() | enabling legacy simulcast for VP9 SVC"),v=!0,_=s.parse(g.sdp),h=_.media[o.idx],u.addLegacySimulcast({offerMediaObject:h,numStreams:b.spatialLayers}),g={type:"offer",sdp:s.write(_)}),f.debug("send() | calling pc.setLocalDescription() [offer:%o]",g),await this._pc.setLocalDescription(g);const y=l.mid;if(n.mid=y,_=s.parse(this._pc.localDescription.sdp),h=_.media[o.idx],n.rtcp.cname=p.getCname({offerMediaObject:h}),t)if(1===t.length){let e=u.getRtpEncodings({offerMediaObject:h});Object.assign(e[0],t[0]),v&&(e=[e[0]]),n.encodings=e}else n.encodings=t;else n.encodings=u.getRtpEncodings({offerMediaObject:h});if(n.encodings.length>1&&("video/vp8"===n.codecs[0].mimeType.toLowerCase()||"video/h264"===n.codecs[0].mimeType.toLowerCase()))for(const e of n.encodings)e.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:h,reuseMid:o.reuseMid,offerRtpParameters:n,answerRtpParameters:i,codecOptions:r,extmapAllowMixed:!0});const w={type:"answer",sdp:this._remoteSdp.getSdp()};return f.debug("send() | calling pc.setRemoteDescription() [answer:%o]",w),await this._pc.setRemoteDescription(w),this._mapMidTransceiver.set(y,l),{localId:y,rtpParameters:n,rtpSender:l.sender}}async stopSending(e){this._assertSendDirection(),f.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid);const r=await this._pc.createOffer();f.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const a={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async replaceTrack(e,t){this._assertSendDirection(),t?f.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):f.debug("replaceTrack() [localId:%s, no track]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");await r.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this._assertSendDirection(),f.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const a=r.sender.getParameters();a.encodings.forEach(((e,r)=>{e.active=r<=t})),await r.sender.setParameters(a)}async setRtpEncodingParameters(e,t){this._assertSendDirection(),f.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const a=r.sender.getParameters();a.encodings.forEach(((e,r)=>{a.encodings[r]=Object.assign(Object.assign({},e),t)})),await r.sender.setParameters(a)}async getSenderStats(e){this._assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:a,protocol:n}){this._assertSendDirection();const i={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:n};f.debug("sendDataChannel() [options:%o]",i);const o=this._pc.createDataChannel(a,i);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%g.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=s.parse(e.sdp),r=t.media.find((e=>"application"===e.type));this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:t}),f.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const a={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a),this._hasDataChannelMediaSection=!0}return{dataChannel:o,sctpStreamParameters:{streamId:i.id,ordered:i.ordered,maxPacketLifeTime:i.maxPacketLifeTime,maxRetransmits:i.maxRetransmits}}}async receive({trackId:e,kind:t,rtpParameters:r}){this._assertRecvDirection(),f.debug("receive() [trackId:%s, kind:%s]",e,t);const a=r.mid||String(this._mapMidTransceiver.size);this._remoteSdp.receive({mid:a,kind:t,offerRtpParameters:r,streamId:r.rtcp.cname,trackId:e});const n={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);let i=await this._pc.createAnswer();const o=s.parse(i.sdp),c=o.media.find((e=>String(e.mid)===a));p.applyCodecParameters({offerRtpParameters:r,answerMediaObject:c}),i={type:"answer",sdp:s.write(o)},this._transportReady||await this._setupTransport({localDtlsRole:"client",localSdpObject:o}),f.debug("receive() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);const d=this._pc.getTransceivers().find((e=>e.mid===a));if(!d)throw new Error("new RTCRtpTransceiver not found");return this._mapMidTransceiver.set(a,d),{localId:a,track:d.receiver.track,rtpReceiver:d.receiver}}async stopReceiving(e){this._assertRecvDirection(),f.debug("stopReceiving() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(t.mid);const r={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const a=await this._pc.createAnswer();f.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a)}async getReceiverStats(e){this._assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this._assertRecvDirection();const{streamId:a,ordered:n,maxPacketLifeTime:i,maxRetransmits:o}=e,c={negotiated:!0,id:a,ordered:n,maxPacketLifeTime:i,maxRetransmits:o,protocol:r};f.debug("receiveDataChannel() [options:%o]",c);const d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const e={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=s.parse(t.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:e})}f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=s.parse(this._pc.localDescription.sdp));const r=p.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:r}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}t.Chrome74=_},function(e,t,r){var a=function(e){return String(Number(e))===e?Number(e):e},n=function(e,t,r){var n=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:n&&!t[e.name]&&(t[e.name]={});var i=e.push?{}:n?t[e.name]:t;!function(e,t,r,n){if(n&&!r)t[n]=a(e[1]);else for(var i=0;i<r.length;i+=1)null!=e[i+1]&&(t[r[i]]=a(e[i+1]))}(r.match(e.reg),i,e.names,e.name),e.push&&t[e.push].push(i)},i=r(39),s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},r=[],a=t;return e.split(/(\r\n|\r|\n)/).filter(s).forEach((function(e){var t=e[0],s=e.slice(2);"m"===t&&(r.push({rtp:[],fmtp:[]}),a=r[r.length-1]);for(var o=0;o<(i[t]||[]).length;o+=1){var c=i[t][o];if(c.reg.test(s))return n(c,a,s)}})),t.media=r,t};var o=function(e,t){var r=t.split(/=(.+)/,2);return 2===r.length?e[r[0]]=a(r[1]):1===r.length&&t.length>1&&(e[r[0]]=void 0),e};t.parseParams=function(e){return e.split(/;\s?/).reduce(o,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],r=e.split(" ").map(a),n=0;n<r.length;n+=3)t.push({component:r[n],ip:r[n+1],port:r[n+2]});return t},t.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(o,{})}))},t.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var t,r=!1;return"~"!==e[0]?t=a(e):(t=a(e.substring(1,e.length)),r=!0),{scid:t,paused:r}}))}))}},function(e,t,r){var a=r(39),n=/%[sdv%]/g,i=function(e){var t=1,r=arguments,a=r.length;return e.replace(n,(function(e){if(t>=a)return e;var n=r[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(n);case"%d":return Number(n);case"%v":return""}}))},s=function(e,t,r){var a=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var n=0;n<t.names.length;n+=1){var s=t.names[n];t.name?a.push(r[t.name][s]):a.push(r[t.names[n]])}else a.push(r[t.name]);return i.apply(null,a)},o=["v","o","s","i","u","e","p","c","b","t","r","z","a"],c=["i","c","b","a"];e.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var r=t.outerOrder||o,n=t.innerOrder||c,i=[];return r.forEach((function(t){a[t].forEach((function(r){r.name in e&&null!=e[r.name]?i.push(s(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){i.push(s(t,r,e))}))}))})),e.media.forEach((function(e){i.push(s("m",a.m[0],e)),n.forEach((function(t){a[t].forEach((function(r){r.name in e&&null!=e[r.name]?i.push(s(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){i.push(s(t,r,e))}))}))}))})),i.join("\r\n")+"\r\n"}},function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.hasOwnProperty.call(e,r)&&a(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.OfferMediaSection=t.AnswerMediaSection=t.MediaSection=void 0;const s=i(r(6));class o{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,planB:a=!1}){if(this._mediaObject={},this._planB=a,e&&this.setIceParameters(e),t){this._mediaObject.candidates=[];for(const e of t){const t={component:1};t.foundation=e.foundation,t.ip=e.ip,t.port=e.port,t.priority=e.priority,t.transport=e.protocol,t.type=e.type,e.tcpType&&(t.tcptype=e.tcpType),this._mediaObject.candidates.push(t)}this._mediaObject.endOfCandidates="end-of-candidates",this._mediaObject.iceOptions="renomination"}r&&this.setDtlsRole(r.role)}get mid(){return String(this._mediaObject.mid)}get closed(){return 0===this._mediaObject.port}getObject(){return this._mediaObject}setIceParameters(e){this._mediaObject.iceUfrag=e.usernameFragment,this._mediaObject.icePwd=e.password}disable(){this._mediaObject.direction="inactive",delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids}close(){this._mediaObject.direction="inactive",this._mediaObject.port=0,delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids,delete this._mediaObject.extmapAllowMixed}}t.MediaSection=o;t.AnswerMediaSection=class extends o{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:a,plainRtpParameters:n,planB:i=!1,offerMediaObject:o,offerRtpParameters:d,answerRtpParameters:p,codecOptions:u,extmapAllowMixed:l=!1}){switch(super({iceParameters:e,iceCandidates:t,dtlsParameters:r,planB:i}),this._mediaObject.mid=String(o.mid),this._mediaObject.type=o.type,this._mediaObject.protocol=o.protocol,n?(this._mediaObject.connection={ip:n.ip,version:n.ipVersion},this._mediaObject.port=n.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.port=7),o.type){case"audio":case"video":this._mediaObject.direction="recvonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[];for(const e of p.codecs){const t={payload:e.payloadType,codec:c(e),rate:e.clockRate};e.channels>1&&(t.encoding=e.channels),this._mediaObject.rtp.push(t);const r=s.clone(e.parameters,{});if(u){const{opusStereo:t,opusFec:a,opusDtx:n,opusMaxPlaybackRate:i,opusMaxAverageBitrate:s,opusPtime:o,videoGoogleStartBitrate:c,videoGoogleMaxBitrate:p,videoGoogleMinBitrate:l}=u,h=d.codecs.find((t=>t.payloadType===e.payloadType));switch(e.mimeType.toLowerCase()){case"audio/opus":void 0!==t&&(h.parameters["sprop-stereo"]=t?1:0,r.stereo=t?1:0),void 0!==a&&(h.parameters.useinbandfec=a?1:0,r.useinbandfec=a?1:0),void 0!==n&&(h.parameters.usedtx=n?1:0,r.usedtx=n?1:0),void 0!==i&&(r.maxplaybackrate=i),void 0!==s&&(r.maxaveragebitrate=s),void 0!==o&&(h.parameters.ptime=o,r.ptime=o);break;case"video/vp8":case"video/vp9":case"video/h264":case"video/h265":void 0!==c&&(r["x-google-start-bitrate"]=c),void 0!==p&&(r["x-google-max-bitrate"]=p),void 0!==l&&(r["x-google-min-bitrate"]=l)}}const a={payload:e.payloadType,config:""};for(const e of Object.keys(r))a.config&&(a.config+=";"),a.config+=`${e}=${r[e]}`;a.config&&this._mediaObject.fmtp.push(a);for(const t of e.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:e.payloadType,type:t.type,subtype:t.parameter})}this._mediaObject.payloads=p.codecs.map((e=>e.payloadType)).join(" "),this._mediaObject.ext=[];for(const e of p.headerExtensions){(o.ext||[]).some((t=>t.uri===e.uri))&&this._mediaObject.ext.push({uri:e.uri,value:e.id})}if(l&&"extmap-allow-mixed"===o.extmapAllowMixed&&(this._mediaObject.extmapAllowMixed="extmap-allow-mixed"),o.simulcast){this._mediaObject.simulcast={dir1:"recv",list1:o.simulcast.list1},this._mediaObject.rids=[];for(const e of o.rids||[])"send"===e.direction&&this._mediaObject.rids.push({id:e.id,direction:"recv"})}else if(o.simulcast_03){this._mediaObject.simulcast_03={value:o.simulcast_03.value.replace(/send/g,"recv")},this._mediaObject.rids=[];for(const e of o.rids||[])"send"===e.direction&&this._mediaObject.rids.push({id:e.id,direction:"recv"})}this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize",this._planB&&"video"===this._mediaObject.type&&(this._mediaObject.xGoogleFlag="conference");break;case"application":"number"==typeof o.sctpPort?(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=a.port,this._mediaObject.maxMessageSize=a.maxMessageSize):o.sctpmap&&(this._mediaObject.payloads=a.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:a.port,maxMessageSize:a.maxMessageSize})}}setDtlsRole(e){switch(e){case"client":this._mediaObject.setup="active";break;case"server":this._mediaObject.setup="passive";break;case"auto":this._mediaObject.setup="actpass"}}};function c(e){const t=new RegExp("^(audio|video)/(.+)","i").exec(e.mimeType);if(!t)throw new TypeError("invalid codec.mimeType");return t[2]}t.OfferMediaSection=class extends o{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:a,plainRtpParameters:n,planB:i=!1,mid:s,kind:o,offerRtpParameters:d,streamId:p,trackId:u,oldDataChannelSpec:l=!1}){switch(super({iceParameters:e,iceCandidates:t,dtlsParameters:r,planB:i}),this._mediaObject.mid=String(s),this._mediaObject.type=o,n?(this._mediaObject.connection={ip:n.ip,version:n.ipVersion},this._mediaObject.protocol="RTP/AVP",this._mediaObject.port=n.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.protocol=a?"UDP/DTLS/SCTP":"UDP/TLS/RTP/SAVPF",this._mediaObject.port=7),o){case"audio":case"video":{this._mediaObject.direction="sendonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[],this._planB||(this._mediaObject.msid=`${p||"-"} ${u}`);for(const e of d.codecs){const t={payload:e.payloadType,codec:c(e),rate:e.clockRate};e.channels>1&&(t.encoding=e.channels),this._mediaObject.rtp.push(t);const r={payload:e.payloadType,config:""};for(const t of Object.keys(e.parameters))r.config&&(r.config+=";"),r.config+=`${t}=${e.parameters[t]}`;r.config&&this._mediaObject.fmtp.push(r);for(const t of e.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:e.payloadType,type:t.type,subtype:t.parameter})}this._mediaObject.payloads=d.codecs.map((e=>e.payloadType)).join(" "),this._mediaObject.ext=[];for(const e of d.headerExtensions)this._mediaObject.ext.push({uri:e.uri,value:e.id});this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize";const e=d.encodings[0],t=e.ssrc,r=e.rtx&&e.rtx.ssrc?e.rtx.ssrc:void 0;this._mediaObject.ssrcs=[],this._mediaObject.ssrcGroups=[],d.rtcp.cname&&this._mediaObject.ssrcs.push({id:t,attribute:"cname",value:d.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:t,attribute:"msid",value:`${p||"-"} ${u}`}),r&&(d.rtcp.cname&&this._mediaObject.ssrcs.push({id:r,attribute:"cname",value:d.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:r,attribute:"msid",value:`${p||"-"} ${u}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${t} ${r}`}));break}case"application":l?(this._mediaObject.payloads=a.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:a.port,maxMessageSize:a.maxMessageSize}):(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=a.port,this._mediaObject.maxMessageSize=a.maxMessageSize)}}setDtlsRole(e){this._mediaObject.setup="actpass"}planBReceive({offerRtpParameters:e,streamId:t,trackId:r}){const a=e.encodings[0],n=a.ssrc,i=a.rtx&&a.rtx.ssrc?a.rtx.ssrc:void 0,s=this._mediaObject.payloads.split(" ");for(const t of e.codecs){if(s.includes(String(t.payloadType)))continue;const e={payload:t.payloadType,codec:c(t),rate:t.clockRate};t.channels>1&&(e.encoding=t.channels),this._mediaObject.rtp.push(e);const r={payload:t.payloadType,config:""};for(const e of Object.keys(t.parameters))r.config&&(r.config+=";"),r.config+=`${e}=${t.parameters[e]}`;r.config&&this._mediaObject.fmtp.push(r);for(const e of t.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:t.payloadType,type:e.type,subtype:e.parameter})}this._mediaObject.payloads+=` ${e.codecs.filter((e=>!this._mediaObject.payloads.includes(e.payloadType))).map((e=>e.payloadType)).join(" ")}`,this._mediaObject.payloads=this._mediaObject.payloads.trim(),e.rtcp.cname&&this._mediaObject.ssrcs.push({id:n,attribute:"cname",value:e.rtcp.cname}),this._mediaObject.ssrcs.push({id:n,attribute:"msid",value:`${t||"-"} ${r}`}),i&&(e.rtcp.cname&&this._mediaObject.ssrcs.push({id:i,attribute:"cname",value:e.rtcp.cname}),this._mediaObject.ssrcs.push({id:i,attribute:"msid",value:`${t||"-"} ${r}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${n} ${i}`}))}planBStopReceiving({offerRtpParameters:e}){const t=e.encodings[0],r=t.ssrc,a=t.rtx&&t.rtx.ssrc?t.rtx.ssrc:void 0;this._mediaObject.ssrcs=this._mediaObject.ssrcs.filter((e=>e.id!==r&&e.id!==a)),a&&(this._mediaObject.ssrcGroups=this._mediaObject.ssrcGroups.filter((e=>e.ssrcs!==`${r} ${a}`)))}}},function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.hasOwnProperty.call(e,r)&&a(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Chrome70=void 0;const s=i(r(9)),o=r(5),c=i(r(6)),d=i(r(7)),p=i(r(13)),u=i(r(21)),l=r(10),h=r(14),m=r(24),f=new o.Logger("Chrome70"),g={OS:1024,MIS:1024};class _ extends l.HandlerInterface{constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new _}get name(){return"Chrome70"}close(){if(f.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){f.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");const t=await e.createOffer();try{e.close()}catch(e){}const r=s.parse(t.sdp);return p.extractRtpCapabilities({sdpObject:r})}catch(t){try{e.close()}catch(e){}throw t}}async getNativeSctpCapabilities(){return f.debug("getNativeSctpCapabilities()"),{numStreams:g}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:i,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:p}){f.debug("run()"),this._direction=e,this._remoteSdp=new h.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n}),this._sendingRtpParametersByKind={audio:d.getSendingRtpParameters("audio",p),video:d.getSendingRtpParameters("video",p)},this._sendingRemoteRtpParametersByKind={audio:d.getSendingRemoteRtpParameters("audio",p),video:d.getSendingRemoteRtpParameters("video",p)},this._pc=new RTCPeerConnection(Object.assign({iceServers:i||[],iceTransportPolicy:s||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"},o),c),this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}async updateIceServers(e){f.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(f.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});f.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();f.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:a}){this._assertSendDirection(),f.debug("send() [kind:%s, track.id:%s]",e.kind,e.id);const n=c.clone(this._sendingRtpParametersByKind[e.kind],{});n.codecs=d.reduceCodecs(n.codecs,a);const i=c.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});i.codecs=d.reduceCodecs(i.codecs,a);const o=this._remoteSdp.getNextMediaSectionIdx(),l=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});let h,g=await this._pc.createOffer(),_=s.parse(g.sdp);this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:_}),t&&t.length>1&&(f.debug("send() | enabling legacy simulcast"),_=s.parse(g.sdp),h=_.media[o.idx],u.addLegacySimulcast({offerMediaObject:h,numStreams:t.length}),g={type:"offer",sdp:s.write(_)});let v=!1;const b=m.parse((t||[{}])[0].scalabilityMode);if(t&&1===t.length&&b.spatialLayers>1&&"video/vp9"===n.codecs[0].mimeType.toLowerCase()&&(f.debug("send() | enabling legacy simulcast for VP9 SVC"),v=!0,_=s.parse(g.sdp),h=_.media[o.idx],u.addLegacySimulcast({offerMediaObject:h,numStreams:b.spatialLayers}),g={type:"offer",sdp:s.write(_)}),f.debug("send() | calling pc.setLocalDescription() [offer:%o]",g),await this._pc.setLocalDescription(g),t){f.debug("send() | applying given encodings");const e=l.sender.getParameters();for(let r=0;r<(e.encodings||[]).length;++r){const a=e.encodings[r],n=t[r];if(!n)break;e.encodings[r]=Object.assign(a,n)}await l.sender.setParameters(e)}const y=l.mid;if(n.mid=y,_=s.parse(this._pc.localDescription.sdp),h=_.media[o.idx],n.rtcp.cname=p.getCname({offerMediaObject:h}),n.encodings=u.getRtpEncodings({offerMediaObject:h}),t)for(let e=0;e<n.encodings.length;++e)t[e]&&Object.assign(n.encodings[e],t[e]);if(v&&(n.encodings=[n.encodings[0]]),n.encodings.length>1&&("video/vp8"===n.codecs[0].mimeType.toLowerCase()||"video/h264"===n.codecs[0].mimeType.toLowerCase()))for(const e of n.encodings)e.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:h,reuseMid:o.reuseMid,offerRtpParameters:n,answerRtpParameters:i,codecOptions:r});const w={type:"answer",sdp:this._remoteSdp.getSdp()};return f.debug("send() | calling pc.setRemoteDescription() [answer:%o]",w),await this._pc.setRemoteDescription(w),this._mapMidTransceiver.set(y,l),{localId:y,rtpParameters:n,rtpSender:l.sender}}async stopSending(e){this._assertSendDirection(),f.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid);const r=await this._pc.createOffer();f.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const a={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async replaceTrack(e,t){this._assertSendDirection(),t?f.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):f.debug("replaceTrack() [localId:%s, no track]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");await r.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this._assertSendDirection(),f.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const a=r.sender.getParameters();a.encodings.forEach(((e,r)=>{e.active=r<=t})),await r.sender.setParameters(a)}async setRtpEncodingParameters(e,t){this._assertSendDirection(),f.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const a=r.sender.getParameters();a.encodings.forEach(((e,r)=>{a.encodings[r]=Object.assign(Object.assign({},e),t)})),await r.sender.setParameters(a)}async getSenderStats(e){this._assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:a,protocol:n}){this._assertSendDirection();const i={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:r,protocol:n};f.debug("sendDataChannel() [options:%o]",i);const o=this._pc.createDataChannel(a,i);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%g.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=s.parse(e.sdp),r=t.media.find((e=>"application"===e.type));this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:t}),f.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const a={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a),this._hasDataChannelMediaSection=!0}return{dataChannel:o,sctpStreamParameters:{streamId:i.id,ordered:i.ordered,maxPacketLifeTime:i.maxPacketLifeTime,maxRetransmits:i.maxRetransmits}}}async receive({trackId:e,kind:t,rtpParameters:r}){this._assertRecvDirection(),f.debug("receive() [trackId:%s, kind:%s]",e,t);const a=r.mid||String(this._mapMidTransceiver.size);this._remoteSdp.receive({mid:a,kind:t,offerRtpParameters:r,streamId:r.rtcp.cname,trackId:e});const n={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);let i=await this._pc.createAnswer();const o=s.parse(i.sdp),c=o.media.find((e=>String(e.mid)===a));p.applyCodecParameters({offerRtpParameters:r,answerMediaObject:c}),i={type:"answer",sdp:s.write(o)},this._transportReady||await this._setupTransport({localDtlsRole:"client",localSdpObject:o}),f.debug("receive() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);const d=this._pc.getTransceivers().find((e=>e.mid===a));if(!d)throw new Error("new RTCRtpTransceiver not found");return this._mapMidTransceiver.set(a,d),{localId:a,track:d.receiver.track,rtpReceiver:d.receiver}}async stopReceiving(e){this._assertRecvDirection(),f.debug("stopReceiving() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(t.mid);const r={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const a=await this._pc.createAnswer();f.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a)}async getReceiverStats(e){this._assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this._assertRecvDirection();const{streamId:a,ordered:n,maxPacketLifeTime:i,maxRetransmits:o}=e,c={negotiated:!0,id:a,ordered:n,maxPacketLifeTime:i,maxRetransmitTime:i,maxRetransmits:o,protocol:r};f.debug("receiveDataChannel() [options:%o]",c);const d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const e={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=s.parse(t.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:e})}f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=s.parse(this._pc.localDescription.sdp));const r=p.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:r}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}t.Chrome70=_},function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.hasOwnProperty.call(e,r)&&a(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Chrome67=void 0;const s=i(r(9)),o=r(5),c=i(r(6)),d=i(r(7)),p=i(r(13)),u=i(r(22)),l=r(10),h=r(14),m=new o.Logger("Chrome67"),f={OS:1024,MIS:1024};class g extends l.HandlerInterface{constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdRtpSender=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new g}get name(){return"Chrome67"}close(){if(m.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){m.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const t=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch(e){}const r=s.parse(t.sdp);return p.extractRtpCapabilities({sdpObject:r})}catch(t){try{e.close()}catch(e){}throw t}}async getNativeSctpCapabilities(){return m.debug("getNativeSctpCapabilities()"),{numStreams:f}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:i,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:p}){m.debug("run()"),this._direction=e,this._remoteSdp=new h.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,planB:!0}),this._sendingRtpParametersByKind={audio:d.getSendingRtpParameters("audio",p),video:d.getSendingRtpParameters("video",p)},this._sendingRemoteRtpParametersByKind={audio:d.getSendingRemoteRtpParameters("audio",p),video:d.getSendingRemoteRtpParameters("video",p)},this._pc=new RTCPeerConnection(Object.assign({iceServers:i||[],iceTransportPolicy:s||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"},o),c),this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}async updateIceServers(e){m.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(m.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});m.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();m.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:a}){this._assertSendDirection(),m.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),a&&m.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addTrack(e,this._sendStream);let n,i=await this._pc.createOffer(),o=s.parse(i.sdp);const l=c.clone(this._sendingRtpParametersByKind[e.kind],{});l.codecs=d.reduceCodecs(l.codecs);const h=c.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});if(h.codecs=d.reduceCodecs(h.codecs),this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:o}),"video"===e.kind&&t&&t.length>1&&(m.debug("send() | enabling simulcast"),o=s.parse(i.sdp),n=o.media.find((e=>"video"===e.type)),u.addLegacySimulcast({offerMediaObject:n,track:e,numStreams:t.length}),i={type:"offer",sdp:s.write(o)}),m.debug("send() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i),o=s.parse(this._pc.localDescription.sdp),n=o.media.find((t=>t.type===e.kind)),l.rtcp.cname=p.getCname({offerMediaObject:n}),l.encodings=u.getRtpEncodings({offerMediaObject:n,track:e}),t)for(let e=0;e<l.encodings.length;++e)t[e]&&Object.assign(l.encodings[e],t[e]);if(l.encodings.length>1&&"video/vp8"===l.codecs[0].mimeType.toLowerCase())for(const e of l.encodings)e.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:n,offerRtpParameters:l,answerRtpParameters:h,codecOptions:r});const f={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("send() | calling pc.setRemoteDescription() [answer:%o]",f),await this._pc.setRemoteDescription(f);const g=String(this._nextSendLocalId);this._nextSendLocalId++;const _=this._pc.getSenders().find((t=>t.track===e));return this._mapSendLocalIdRtpSender.set(g,_),{localId:g,rtpParameters:l,rtpSender:_}}async stopSending(e){this._assertSendDirection(),m.debug("stopSending() [localId:%s]",e);const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");this._pc.removeTrack(t),t.track&&this._sendStream.removeTrack(t.track),this._mapSendLocalIdRtpSender.delete(e);const r=await this._pc.createOffer();m.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r);try{await this._pc.setLocalDescription(r)}catch(e){if(0===this._sendStream.getTracks().length)return void m.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.toString());throw e}if("stable"===this._pc.signalingState)return;const a={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async replaceTrack(e,t){this._assertSendDirection(),t?m.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):m.debug("replaceTrack() [localId:%s, no track]",e);const r=this._mapSendLocalIdRtpSender.get(e);if(!r)throw new Error("associated RTCRtpSender not found");const a=r.track;await r.replaceTrack(t),a&&this._sendStream.removeTrack(a),t&&this._sendStream.addTrack(t)}async setMaxSpatialLayer(e,t){this._assertSendDirection(),m.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapSendLocalIdRtpSender.get(e);if(!r)throw new Error("associated RTCRtpSender not found");const a=r.getParameters();a.encodings.forEach(((e,r)=>{e.active=r<=t})),await r.setParameters(a)}async setRtpEncodingParameters(e,t){this._assertSendDirection(),m.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapSendLocalIdRtpSender.get(e);if(!r)throw new Error("associated RTCRtpSender not found");const a=r.getParameters();a.encodings.forEach(((e,r)=>{a.encodings[r]=Object.assign(Object.assign({},e),t)})),await r.setParameters(a)}async getSenderStats(e){this._assertSendDirection();const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");return t.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:a,protocol:n}){this._assertSendDirection();const i={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:r,protocol:n};m.debug("sendDataChannel() [options:%o]",i);const o=this._pc.createDataChannel(a,i);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%f.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=s.parse(e.sdp),r=t.media.find((e=>"application"===e.type));this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:t}),m.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const a={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a),this._hasDataChannelMediaSection=!0}return{dataChannel:o,sctpStreamParameters:{streamId:i.id,ordered:i.ordered,maxPacketLifeTime:i.maxPacketLifeTime,maxRetransmits:i.maxRetransmits}}}async receive({trackId:e,kind:t,rtpParameters:r}){this._assertRecvDirection(),m.debug("receive() [trackId:%s, kind:%s]",e,t);const a=e,n=t;this._remoteSdp.receive({mid:n,kind:t,offerRtpParameters:r,streamId:r.rtcp.cname,trackId:e});const i={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let o=await this._pc.createAnswer();const c=s.parse(o.sdp),d=c.media.find((e=>String(e.mid)===n));p.applyCodecParameters({offerRtpParameters:r,answerMediaObject:d}),o={type:"answer",sdp:s.write(c)},this._transportReady||await this._setupTransport({localDtlsRole:"client",localSdpObject:c}),m.debug("receive() | calling pc.setLocalDescription() [answer:%o]",o),await this._pc.setLocalDescription(o);const u=this._pc.getReceivers().find((e=>e.track&&e.track.id===a));if(!u)throw new Error("new RTCRtpReceiver not");return this._mapRecvLocalIdInfo.set(a,{mid:n,rtpParameters:r,rtpReceiver:u}),{localId:a,track:u.track,rtpReceiver:u}}async stopReceiving(e){this._assertRecvDirection(),m.debug("stopReceiving() [localId:%s]",e);const{mid:t,rtpParameters:r}=this._mapRecvLocalIdInfo.get(e)||{};this._mapRecvLocalIdInfo.delete(e),this._remoteSdp.planBStopReceiving({mid:t,offerRtpParameters:r});const a={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",a),await this._pc.setRemoteDescription(a);const n=await this._pc.createAnswer();m.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}async getReceiverStats(e){this._assertRecvDirection();const{rtpReceiver:t}=this._mapRecvLocalIdInfo.get(e)||{};if(!t)throw new Error("associated RTCRtpReceiver not found");return t.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this._assertRecvDirection();const{streamId:a,ordered:n,maxPacketLifeTime:i,maxRetransmits:o}=e,c={negotiated:!0,id:a,ordered:n,maxPacketLifeTime:i,maxRetransmitTime:i,maxRetransmits:o,protocol:r};m.debug("receiveDataChannel() [options:%o]",c);const d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const e={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=s.parse(t.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:e})}m.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=s.parse(this._pc.localDescription.sdp));const r=p.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:r}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}t.Chrome67=g},function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.hasOwnProperty.call(e,r)&&a(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Chrome55=void 0;const s=i(r(9)),o=r(5),c=r(8),d=i(r(6)),p=i(r(7)),u=i(r(13)),l=i(r(22)),h=r(10),m=r(14),f=new o.Logger("Chrome55"),g={OS:1024,MIS:1024};class _ extends h.HandlerInterface{constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdTrack=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new _}get name(){return"Chrome55"}close(){if(f.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){f.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const t=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch(e){}const r=s.parse(t.sdp);return u.extractRtpCapabilities({sdpObject:r})}catch(t){try{e.close()}catch(e){}throw t}}async getNativeSctpCapabilities(){return f.debug("getNativeSctpCapabilities()"),{numStreams:g}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:i,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:d}){f.debug("run()"),this._direction=e,this._remoteSdp=new m.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,planB:!0}),this._sendingRtpParametersByKind={audio:p.getSendingRtpParameters("audio",d),video:p.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:p.getSendingRemoteRtpParameters("audio",d),video:p.getSendingRemoteRtpParameters("video",d)},this._pc=new RTCPeerConnection(Object.assign({iceServers:i||[],iceTransportPolicy:s||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"},o),c),this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}async updateIceServers(e){f.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(f.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});f.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();f.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:a}){this._assertSendDirection(),f.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),a&&f.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addStream(this._sendStream);let n,i=await this._pc.createOffer(),o=s.parse(i.sdp);const c=d.clone(this._sendingRtpParametersByKind[e.kind],{});c.codecs=p.reduceCodecs(c.codecs);const h=d.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});if(h.codecs=p.reduceCodecs(h.codecs),this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:o}),"video"===e.kind&&t&&t.length>1&&(f.debug("send() | enabling simulcast"),o=s.parse(i.sdp),n=o.media.find((e=>"video"===e.type)),l.addLegacySimulcast({offerMediaObject:n,track:e,numStreams:t.length}),i={type:"offer",sdp:s.write(o)}),f.debug("send() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i),o=s.parse(this._pc.localDescription.sdp),n=o.media.find((t=>t.type===e.kind)),c.rtcp.cname=u.getCname({offerMediaObject:n}),c.encodings=l.getRtpEncodings({offerMediaObject:n,track:e}),t)for(let e=0;e<c.encodings.length;++e)t[e]&&Object.assign(c.encodings[e],t[e]);if(c.encodings.length>1&&"video/vp8"===c.codecs[0].mimeType.toLowerCase())for(const e of c.encodings)e.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:n,offerRtpParameters:c,answerRtpParameters:h,codecOptions:r});const m={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("send() | calling pc.setRemoteDescription() [answer:%o]",m),await this._pc.setRemoteDescription(m);const g=String(this._nextSendLocalId);return this._nextSendLocalId++,this._mapSendLocalIdTrack.set(g,e),{localId:g,rtpParameters:c}}async stopSending(e){this._assertSendDirection(),f.debug("stopSending() [localId:%s]",e);const t=this._mapSendLocalIdTrack.get(e);if(!t)throw new Error("track not found");this._mapSendLocalIdTrack.delete(e),this._sendStream.removeTrack(t),this._pc.addStream(this._sendStream);const r=await this._pc.createOffer();f.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r);try{await this._pc.setLocalDescription(r)}catch(e){if(0===this._sendStream.getTracks().length)return void f.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.toString());throw e}if("stable"===this._pc.signalingState)return;const a={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async replaceTrack(e,t){throw new c.UnsupportedError("not implemented")}async setMaxSpatialLayer(e,t){throw new c.UnsupportedError(" not implemented")}async setRtpEncodingParameters(e,t){throw new c.UnsupportedError("not supported")}async getSenderStats(e){throw new c.UnsupportedError("not implemented")}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:a,protocol:n}){this._assertSendDirection();const i={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:r,protocol:n};f.debug("sendDataChannel() [options:%o]",i);const o=this._pc.createDataChannel(a,i);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%g.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=s.parse(e.sdp),r=t.media.find((e=>"application"===e.type));this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:t}),f.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const a={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a),this._hasDataChannelMediaSection=!0}return{dataChannel:o,sctpStreamParameters:{streamId:i.id,ordered:i.ordered,maxPacketLifeTime:i.maxPacketLifeTime,maxRetransmits:i.maxRetransmits}}}async receive({trackId:e,kind:t,rtpParameters:r}){this._assertRecvDirection(),f.debug("receive() [trackId:%s, kind:%s]",e,t);const a=e,n=t,i=r.rtcp.cname;this._remoteSdp.receive({mid:n,kind:t,offerRtpParameters:r,streamId:i,trackId:e});const o={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",o),await this._pc.setRemoteDescription(o);let c=await this._pc.createAnswer();const d=s.parse(c.sdp),p=d.media.find((e=>String(e.mid)===n));u.applyCodecParameters({offerRtpParameters:r,answerMediaObject:p}),c={type:"answer",sdp:s.write(d)},this._transportReady||await this._setupTransport({localDtlsRole:"client",localSdpObject:d}),f.debug("receive() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c);const l=this._pc.getRemoteStreams().find((e=>e.id===i)).getTrackById(a);if(!l)throw new Error("remote track not found");return this._mapRecvLocalIdInfo.set(a,{mid:n,rtpParameters:r}),{localId:a,track:l}}async stopReceiving(e){this._assertRecvDirection(),f.debug("stopReceiving() [localId:%s]",e);const{mid:t,rtpParameters:r}=this._mapRecvLocalIdInfo.get(e)||{};this._mapRecvLocalIdInfo.delete(e),this._remoteSdp.planBStopReceiving({mid:t,offerRtpParameters:r});const a={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",a),await this._pc.setRemoteDescription(a);const n=await this._pc.createAnswer();f.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}async getReceiverStats(e){throw new c.UnsupportedError("not implemented")}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this._assertRecvDirection();const{streamId:a,ordered:n,maxPacketLifeTime:i,maxRetransmits:o}=e,c={negotiated:!0,id:a,ordered:n,maxPacketLifeTime:i,maxRetransmitTime:i,maxRetransmits:o,protocol:r};f.debug("receiveDataChannel() [options:%o]",c);const d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const e={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=s.parse(t.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:e})}f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=s.parse(this._pc.localDescription.sdp));const r=u.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:r}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}t.Chrome55=_},function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.hasOwnProperty.call(e,r)&&a(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Firefox60=void 0;const s=i(r(9)),o=r(5),c=r(8),d=i(r(6)),p=i(r(7)),u=i(r(13)),l=i(r(21)),h=r(10),m=r(14),f=new o.Logger("Firefox60"),g={OS:16,MIS:2048};class _ extends h.HandlerInterface{constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new _}get name(){return"Firefox60"}close(){if(f.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){f.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),t=document.createElement("canvas");t.getContext("2d");const r=t.captureStream().getVideoTracks()[0];try{e.addTransceiver("audio",{direction:"sendrecv"});const a=e.addTransceiver(r,{direction:"sendrecv"}),n=a.sender.getParameters(),i=[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}];n.encodings=i,await a.sender.setParameters(n);const o=await e.createOffer();try{t.remove()}catch(e){}try{r.stop()}catch(e){}try{e.close()}catch(e){}const c=s.parse(o.sdp);return u.extractRtpCapabilities({sdpObject:c})}catch(a){try{t.remove()}catch(e){}try{r.stop()}catch(e){}try{e.close()}catch(e){}throw a}}async getNativeSctpCapabilities(){return f.debug("getNativeSctpCapabilities()"),{numStreams:g}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:i,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:d}){f.debug("run()"),this._direction=e,this._remoteSdp=new m.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n}),this._sendingRtpParametersByKind={audio:p.getSendingRtpParameters("audio",d),video:p.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:p.getSendingRemoteRtpParameters("audio",d),video:p.getSendingRemoteRtpParameters("video",d)},this._pc=new RTCPeerConnection(Object.assign({iceServers:i||[],iceTransportPolicy:s||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},o),c),this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}async updateIceServers(e){throw new c.UnsupportedError("not supported")}async restartIce(e){if(f.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});f.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();f.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:a}){this._assertSendDirection(),f.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&(t=d.clone(t,[])).length>1&&(t.forEach(((e,t)=>{e.rid=`r${t}`})),t.reverse());const n=d.clone(this._sendingRtpParametersByKind[e.kind],{});n.codecs=p.reduceCodecs(n.codecs,a);const i=d.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});i.codecs=p.reduceCodecs(i.codecs,a);const o=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});if(t){const e=o.sender.getParameters();e.encodings=t,await o.sender.setParameters(e)}const c=await this._pc.createOffer();let h=s.parse(c.sdp);this._transportReady||await this._setupTransport({localDtlsRole:"client",localSdpObject:h}),f.debug("send() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c);const m=o.mid;n.mid=m,h=s.parse(this._pc.localDescription.sdp);const g=h.media[h.media.length-1];if(n.rtcp.cname=u.getCname({offerMediaObject:g}),t)if(1===t.length){const e=l.getRtpEncodings({offerMediaObject:g});Object.assign(e[0],t[0]),n.encodings=e}else n.encodings=t.reverse();else n.encodings=l.getRtpEncodings({offerMediaObject:g});if(n.encodings.length>1&&("video/vp8"===n.codecs[0].mimeType.toLowerCase()||"video/h264"===n.codecs[0].mimeType.toLowerCase()))for(const e of n.encodings)e.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:g,offerRtpParameters:n,answerRtpParameters:i,codecOptions:r,extmapAllowMixed:!0});const _={type:"answer",sdp:this._remoteSdp.getSdp()};return f.debug("send() | calling pc.setRemoteDescription() [answer:%o]",_),await this._pc.setRemoteDescription(_),this._mapMidTransceiver.set(m,o),{localId:m,rtpParameters:n,rtpSender:o.sender}}async stopSending(e){f.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated transceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.disableMediaSection(t.mid);const r=await this._pc.createOffer();f.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const a={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async replaceTrack(e,t){this._assertSendDirection(),t?f.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):f.debug("replaceTrack() [localId:%s, no track]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");await r.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this._assertSendDirection(),f.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated transceiver not found");const a=r.sender.getParameters();t=a.encodings.length-1-t,a.encodings.forEach(((e,r)=>{e.active=r>=t})),await r.sender.setParameters(a)}async setRtpEncodingParameters(e,t){this._assertSendDirection(),f.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const a=r.sender.getParameters();a.encodings.forEach(((e,r)=>{a.encodings[r]=Object.assign(Object.assign({},e),t)})),await r.sender.setParameters(a)}async getSenderStats(e){this._assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:a,protocol:n}){this._assertSendDirection();const i={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:n};f.debug("sendDataChannel() [options:%o]",i);const o=this._pc.createDataChannel(a,i);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%g.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=s.parse(e.sdp),r=t.media.find((e=>"application"===e.type));this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:t}),f.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const a={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a),this._hasDataChannelMediaSection=!0}return{dataChannel:o,sctpStreamParameters:{streamId:i.id,ordered:i.ordered,maxPacketLifeTime:i.maxPacketLifeTime,maxRetransmits:i.maxRetransmits}}}async receive({trackId:e,kind:t,rtpParameters:r}){this._assertRecvDirection(),f.debug("receive() [trackId:%s, kind:%s]",e,t);const a=r.mid||String(this._mapMidTransceiver.size);this._remoteSdp.receive({mid:a,kind:t,offerRtpParameters:r,streamId:r.rtcp.cname,trackId:e});const n={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);let i=await this._pc.createAnswer();const o=s.parse(i.sdp),c=o.media.find((e=>String(e.mid)===a));u.applyCodecParameters({offerRtpParameters:r,answerMediaObject:c}),i={type:"answer",sdp:s.write(o)},this._transportReady||await this._setupTransport({localDtlsRole:"client",localSdpObject:o}),f.debug("receive() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);const d=this._pc.getTransceivers().find((e=>e.mid===a));if(!d)throw new Error("new RTCRtpTransceiver not found");return this._mapMidTransceiver.set(a,d),{localId:a,track:d.receiver.track,rtpReceiver:d.receiver}}async stopReceiving(e){this._assertRecvDirection(),f.debug("stopReceiving() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(t.mid);const r={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const a=await this._pc.createAnswer();f.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a)}async getReceiverStats(e){this._assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this._assertRecvDirection();const{streamId:a,ordered:n,maxPacketLifeTime:i,maxRetransmits:o}=e,c={negotiated:!0,id:a,ordered:n,maxPacketLifeTime:i,maxRetransmits:o,protocol:r};f.debug("receiveDataChannel() [options:%o]",c);const d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const e={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=s.parse(t.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:e})}f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=s.parse(this._pc.localDescription.sdp));const r=u.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:r}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}t.Firefox60=_},function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.hasOwnProperty.call(e,r)&&a(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Safari12=void 0;const s=i(r(9)),o=r(5),c=i(r(6)),d=i(r(7)),p=i(r(13)),u=i(r(21)),l=r(10),h=r(14),m=new o.Logger("Safari12"),f={OS:1024,MIS:1024};class g extends l.HandlerInterface{constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new g}get name(){return"Safari12"}close(){if(m.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){m.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{e.addTransceiver("audio"),e.addTransceiver("video");const t=await e.createOffer();try{e.close()}catch(e){}const r=s.parse(t.sdp);return p.extractRtpCapabilities({sdpObject:r})}catch(t){try{e.close()}catch(e){}throw t}}async getNativeSctpCapabilities(){return m.debug("getNativeSctpCapabilities()"),{numStreams:f}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:i,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:p}){m.debug("run()"),this._direction=e,this._remoteSdp=new h.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n}),this._sendingRtpParametersByKind={audio:d.getSendingRtpParameters("audio",p),video:d.getSendingRtpParameters("video",p)},this._sendingRemoteRtpParametersByKind={audio:d.getSendingRemoteRtpParameters("audio",p),video:d.getSendingRemoteRtpParameters("video",p)},this._pc=new RTCPeerConnection(Object.assign({iceServers:i||[],iceTransportPolicy:s||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},o),c),this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}async updateIceServers(e){m.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(m.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});m.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();m.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:a}){this._assertSendDirection(),m.debug("send() [kind:%s, track.id:%s]",e.kind,e.id);const n=c.clone(this._sendingRtpParametersByKind[e.kind],{});n.codecs=d.reduceCodecs(n.codecs,a);const i=c.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});i.codecs=d.reduceCodecs(i.codecs,a);const o=this._remoteSdp.getNextMediaSectionIdx(),l=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});let h,f=await this._pc.createOffer(),g=s.parse(f.sdp);this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:g}),t&&t.length>1&&(m.debug("send() | enabling legacy simulcast"),g=s.parse(f.sdp),h=g.media[o.idx],u.addLegacySimulcast({offerMediaObject:h,numStreams:t.length}),f={type:"offer",sdp:s.write(g)}),m.debug("send() | calling pc.setLocalDescription() [offer:%o]",f),await this._pc.setLocalDescription(f);const _=l.mid;if(n.mid=_,g=s.parse(this._pc.localDescription.sdp),h=g.media[o.idx],n.rtcp.cname=p.getCname({offerMediaObject:h}),n.encodings=u.getRtpEncodings({offerMediaObject:h}),t)for(let e=0;e<n.encodings.length;++e)t[e]&&Object.assign(n.encodings[e],t[e]);if(n.encodings.length>1&&("video/vp8"===n.codecs[0].mimeType.toLowerCase()||"video/h264"===n.codecs[0].mimeType.toLowerCase()))for(const e of n.encodings)e.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:h,reuseMid:o.reuseMid,offerRtpParameters:n,answerRtpParameters:i,codecOptions:r});const v={type:"answer",sdp:this._remoteSdp.getSdp()};return m.debug("send() | calling pc.setRemoteDescription() [answer:%o]",v),await this._pc.setRemoteDescription(v),this._mapMidTransceiver.set(_,l),{localId:_,rtpParameters:n,rtpSender:l.sender}}async stopSending(e){this._assertSendDirection(),m.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid);const r=await this._pc.createOffer();m.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const a={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async replaceTrack(e,t){this._assertSendDirection(),t?m.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):m.debug("replaceTrack() [localId:%s, no track]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");await r.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this._assertSendDirection(),m.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const a=r.sender.getParameters();a.encodings.forEach(((e,r)=>{e.active=r<=t})),await r.sender.setParameters(a)}async setRtpEncodingParameters(e,t){this._assertSendDirection(),m.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const a=r.sender.getParameters();a.encodings.forEach(((e,r)=>{a.encodings[r]=Object.assign(Object.assign({},e),t)})),await r.sender.setParameters(a)}async getSenderStats(e){this._assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:a,protocol:n}){this._assertSendDirection();const i={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:n};m.debug("sendDataChannel() [options:%o]",i);const o=this._pc.createDataChannel(a,i);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%f.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=s.parse(e.sdp),r=t.media.find((e=>"application"===e.type));this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:t}),m.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const a={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a),this._hasDataChannelMediaSection=!0}return{dataChannel:o,sctpStreamParameters:{streamId:i.id,ordered:i.ordered,maxPacketLifeTime:i.maxPacketLifeTime,maxRetransmits:i.maxRetransmits}}}async receive({trackId:e,kind:t,rtpParameters:r}){this._assertRecvDirection(),m.debug("receive() [trackId:%s, kind:%s]",e,t);const a=r.mid||String(this._mapMidTransceiver.size);this._remoteSdp.receive({mid:a,kind:t,offerRtpParameters:r,streamId:r.rtcp.cname,trackId:e});const n={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);let i=await this._pc.createAnswer();const o=s.parse(i.sdp),c=o.media.find((e=>String(e.mid)===a));p.applyCodecParameters({offerRtpParameters:r,answerMediaObject:c}),i={type:"answer",sdp:s.write(o)},this._transportReady||await this._setupTransport({localDtlsRole:"client",localSdpObject:o}),m.debug("receive() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);const d=this._pc.getTransceivers().find((e=>e.mid===a));if(!d)throw new Error("new RTCRtpTransceiver not found");return this._mapMidTransceiver.set(a,d),{localId:a,track:d.receiver.track,rtpReceiver:d.receiver}}async stopReceiving(e){this._assertRecvDirection(),m.debug("stopReceiving() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(t.mid);const r={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const a=await this._pc.createAnswer();m.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a)}async getReceiverStats(e){this._assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this._assertRecvDirection();const{streamId:a,ordered:n,maxPacketLifeTime:i,maxRetransmits:o}=e,c={negotiated:!0,id:a,ordered:n,maxPacketLifeTime:i,maxRetransmits:o,protocol:r};m.debug("receiveDataChannel() [options:%o]",c);const d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const e={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=s.parse(t.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:e})}m.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=s.parse(this._pc.localDescription.sdp));const r=p.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:r}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}t.Safari12=g},function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.hasOwnProperty.call(e,r)&&a(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Safari11=void 0;const s=i(r(9)),o=r(5),c=i(r(6)),d=i(r(7)),p=i(r(13)),u=i(r(22)),l=r(10),h=r(14),m=new o.Logger("Safari11"),f={OS:1024,MIS:1024};class g extends l.HandlerInterface{constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdRtpSender=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new g}get name(){return"Safari11"}close(){if(m.debug("close()"),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){m.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const t=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch(e){}const r=s.parse(t.sdp);return p.extractRtpCapabilities({sdpObject:r})}catch(t){try{e.close()}catch(e){}throw t}}async getNativeSctpCapabilities(){return m.debug("getNativeSctpCapabilities()"),{numStreams:f}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:i,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:p}){m.debug("run()"),this._direction=e,this._remoteSdp=new h.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,planB:!0}),this._sendingRtpParametersByKind={audio:d.getSendingRtpParameters("audio",p),video:d.getSendingRtpParameters("video",p)},this._sendingRemoteRtpParametersByKind={audio:d.getSendingRemoteRtpParameters("audio",p),video:d.getSendingRemoteRtpParameters("video",p)},this._pc=new RTCPeerConnection(Object.assign({iceServers:i||[],iceTransportPolicy:s||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},o),c),this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}async updateIceServers(e){m.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(m.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});m.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();m.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:a}){this._assertSendDirection(),m.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),a&&m.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addTrack(e,this._sendStream);let n,i=await this._pc.createOffer(),o=s.parse(i.sdp);const l=c.clone(this._sendingRtpParametersByKind[e.kind],{});l.codecs=d.reduceCodecs(l.codecs);const h=c.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});if(h.codecs=d.reduceCodecs(h.codecs),this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:o}),"video"===e.kind&&t&&t.length>1&&(m.debug("send() | enabling simulcast"),o=s.parse(i.sdp),n=o.media.find((e=>"video"===e.type)),u.addLegacySimulcast({offerMediaObject:n,track:e,numStreams:t.length}),i={type:"offer",sdp:s.write(o)}),m.debug("send() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i),o=s.parse(this._pc.localDescription.sdp),n=o.media.find((t=>t.type===e.kind)),l.rtcp.cname=p.getCname({offerMediaObject:n}),l.encodings=u.getRtpEncodings({offerMediaObject:n,track:e}),t)for(let e=0;e<l.encodings.length;++e)t[e]&&Object.assign(l.encodings[e],t[e]);if(l.encodings.length>1&&"video/vp8"===l.codecs[0].mimeType.toLowerCase())for(const e of l.encodings)e.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:n,offerRtpParameters:l,answerRtpParameters:h,codecOptions:r});const f={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("send() | calling pc.setRemoteDescription() [answer:%o]",f),await this._pc.setRemoteDescription(f);const g=String(this._nextSendLocalId);this._nextSendLocalId++;const _=this._pc.getSenders().find((t=>t.track===e));return this._mapSendLocalIdRtpSender.set(g,_),{localId:g,rtpParameters:l,rtpSender:_}}async stopSending(e){this._assertSendDirection();const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");t.track&&this._sendStream.removeTrack(t.track),this._mapSendLocalIdRtpSender.delete(e);const r=await this._pc.createOffer();m.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r);try{await this._pc.setLocalDescription(r)}catch(e){if(0===this._sendStream.getTracks().length)return void m.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.toString());throw e}if("stable"===this._pc.signalingState)return;const a={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async replaceTrack(e,t){this._assertSendDirection(),t?m.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):m.debug("replaceTrack() [localId:%s, no track]",e);const r=this._mapSendLocalIdRtpSender.get(e);if(!r)throw new Error("associated RTCRtpSender not found");const a=r.track;await r.replaceTrack(t),a&&this._sendStream.removeTrack(a),t&&this._sendStream.addTrack(t)}async setMaxSpatialLayer(e,t){this._assertSendDirection(),m.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapSendLocalIdRtpSender.get(e);if(!r)throw new Error("associated RTCRtpSender not found");const a=r.getParameters();a.encodings.forEach(((e,r)=>{e.active=r<=t})),await r.setParameters(a)}async setRtpEncodingParameters(e,t){this._assertSendDirection(),m.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapSendLocalIdRtpSender.get(e);if(!r)throw new Error("associated RTCRtpSender not found");const a=r.getParameters();a.encodings.forEach(((e,r)=>{a.encodings[r]=Object.assign(Object.assign({},e),t)})),await r.setParameters(a)}async getSenderStats(e){this._assertSendDirection();const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");return t.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:a,protocol:n}){this._assertSendDirection();const i={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:n};m.debug("sendDataChannel() [options:%o]",i);const o=this._pc.createDataChannel(a,i);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%f.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=s.parse(e.sdp),r=t.media.find((e=>"application"===e.type));this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:t}),m.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const a={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a),this._hasDataChannelMediaSection=!0}return{dataChannel:o,sctpStreamParameters:{streamId:i.id,ordered:i.ordered,maxPacketLifeTime:i.maxPacketLifeTime,maxRetransmits:i.maxRetransmits}}}async receive({trackId:e,kind:t,rtpParameters:r}){this._assertRecvDirection(),m.debug("receive() [trackId:%s, kind:%s]",e,t);const a=e,n=t;this._remoteSdp.receive({mid:n,kind:t,offerRtpParameters:r,streamId:r.rtcp.cname,trackId:e});const i={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let o=await this._pc.createAnswer();const c=s.parse(o.sdp),d=c.media.find((e=>String(e.mid)===n));p.applyCodecParameters({offerRtpParameters:r,answerMediaObject:d}),o={type:"answer",sdp:s.write(c)},this._transportReady||await this._setupTransport({localDtlsRole:"client",localSdpObject:c}),m.debug("receive() | calling pc.setLocalDescription() [answer:%o]",o),await this._pc.setLocalDescription(o);const u=this._pc.getReceivers().find((e=>e.track&&e.track.id===a));if(!u)throw new Error("new RTCRtpReceiver not");return this._mapRecvLocalIdInfo.set(a,{mid:n,rtpParameters:r,rtpReceiver:u}),{localId:a,track:u.track,rtpReceiver:u}}async stopReceiving(e){this._assertRecvDirection(),m.debug("stopReceiving() [localId:%s]",e);const{mid:t,rtpParameters:r}=this._mapRecvLocalIdInfo.get(e)||{};this._mapRecvLocalIdInfo.delete(e),this._remoteSdp.planBStopReceiving({mid:t,offerRtpParameters:r});const a={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",a),await this._pc.setRemoteDescription(a);const n=await this._pc.createAnswer();m.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}async getReceiverStats(e){this._assertRecvDirection();const{rtpReceiver:t}=this._mapRecvLocalIdInfo.get(e)||{};if(!t)throw new Error("associated RTCRtpReceiver not found");return t.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this._assertRecvDirection();const{streamId:a,ordered:n,maxPacketLifeTime:i,maxRetransmits:o}=e,c={negotiated:!0,id:a,ordered:n,maxPacketLifeTime:i,maxRetransmits:o,protocol:r};m.debug("receiveDataChannel() [options:%o]",c);const d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const e={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=s.parse(t.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:e})}m.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=s.parse(this._pc.localDescription.sdp));const r=p.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:r}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}t.Safari11=g},function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.hasOwnProperty.call(e,r)&&a(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Edge11=void 0;const s=r(5),o=r(8),c=i(r(6)),d=i(r(7)),p=i(r(79)),u=r(10),l=new s.Logger("Edge11");class h extends u.HandlerInterface{constructor(){super(),this._rtpSenders=new Map,this._rtpReceivers=new Map,this._nextSendLocalId=0,this._transportReady=!1}static createFactory(){return()=>new h}get name(){return"Edge11"}close(){l.debug("close()");try{this._iceGatherer.close()}catch(e){}try{this._iceTransport.stop()}catch(e){}try{this._dtlsTransport.stop()}catch(e){}for(const e of this._rtpSenders.values())try{e.stop()}catch(e){}for(const e of this._rtpReceivers.values())try{e.stop()}catch(e){}}async getNativeRtpCapabilities(){return l.debug("getNativeRtpCapabilities()"),p.getCapabilities()}async getNativeSctpCapabilities(){return l.debug("getNativeSctpCapabilities()"),{numStreams:{OS:0,MIS:0}}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:i,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:p,extendedRtpCapabilities:u}){l.debug("run()"),this._sendingRtpParametersByKind={audio:d.getSendingRtpParameters("audio",u),video:d.getSendingRtpParameters("video",u)},this._remoteIceParameters=t,this._remoteIceCandidates=r,this._remoteDtlsParameters=a,this._cname=`CNAME-${c.generateRandomNumber()}`,this._setIceGatherer({iceServers:i,iceTransportPolicy:s}),this._setIceTransport(),this._setDtlsTransport()}async updateIceServers(e){throw new o.UnsupportedError("not supported")}async restartIce(e){if(l.debug("restartIce()"),this._remoteIceParameters=e,this._transportReady){l.debug("restartIce() | calling iceTransport.start()"),this._iceTransport.start(this._iceGatherer,e,"controlling");for(const e of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(e);this._iceTransport.addRemoteCandidate({})}}async getTransportStats(){return this._iceTransport.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:a}){l.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),this._transportReady||await this._setupTransport({localDtlsRole:"server"}),l.debug("send() | calling new RTCRtpSender()");const n=new RTCRtpSender(e,this._dtlsTransport),i=c.clone(this._sendingRtpParametersByKind[e.kind],{});i.codecs=d.reduceCodecs(i.codecs,a);const s=i.codecs.some((e=>/.+\/rtx$/i.test(e.mimeType)));t||(t=[{}]);for(const e of t)e.ssrc=c.generateRandomNumber(),s&&(e.rtx={ssrc:c.generateRandomNumber()});i.encodings=t,i.rtcp={cname:this._cname,reducedSize:!0,mux:!0};const o=p.mangleRtpParameters(i);l.debug("send() | calling rtpSender.send() [params:%o]",o),await n.send(o);const u=String(this._nextSendLocalId);return this._nextSendLocalId++,this._rtpSenders.set(u,n),{localId:u,rtpParameters:i,rtpSender:n}}async stopSending(e){l.debug("stopSending() [localId:%s]",e);const t=this._rtpSenders.get(e);if(!t)throw new Error("RTCRtpSender not found");this._rtpSenders.delete(e);try{l.debug("stopSending() | calling rtpSender.stop()"),t.stop()}catch(e){throw l.warn("stopSending() | rtpSender.stop() failed:%o",e),e}}async replaceTrack(e,t){t?l.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):l.debug("replaceTrack() [localId:%s, no track]",e);const r=this._rtpSenders.get(e);if(!r)throw new Error("RTCRtpSender not found");r.setTrack(t)}async setMaxSpatialLayer(e,t){l.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._rtpSenders.get(e);if(!r)throw new Error("RTCRtpSender not found");const a=r.getParameters();a.encodings.forEach(((e,r)=>{e.active=r<=t})),await r.setParameters(a)}async setRtpEncodingParameters(e,t){l.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._rtpSenders.get(e);if(!r)throw new Error("RTCRtpSender not found");const a=r.getParameters();a.encodings.forEach(((e,r)=>{a.encodings[r]=Object.assign(Object.assign({},e),t)})),await r.setParameters(a)}async getSenderStats(e){const t=this._rtpSenders.get(e);if(!t)throw new Error("RTCRtpSender not found");return t.getStats()}async sendDataChannel(e){throw new o.UnsupportedError("not implemented")}async receive({trackId:e,kind:t,rtpParameters:r}){l.debug("receive() [trackId:%s, kind:%s]",e,t),this._transportReady||await this._setupTransport({localDtlsRole:"server"}),l.debug("receive() | calling new RTCRtpReceiver()");const a=new RTCRtpReceiver(this._dtlsTransport,t);a.addEventListener("error",(e=>{l.error('rtpReceiver "error" event [event:%o]',e)}));const n=p.mangleRtpParameters(r);l.debug("receive() | calling rtpReceiver.receive() [params:%o]",n),await a.receive(n);const i=e;return this._rtpReceivers.set(i,a),{localId:i,track:a.track,rtpReceiver:a}}async stopReceiving(e){l.debug("stopReceiving() [localId:%s]",e);const t=this._rtpReceivers.get(e);if(!t)throw new Error("RTCRtpReceiver not found");this._rtpReceivers.delete(e);try{l.debug("stopReceiving() | calling rtpReceiver.stop()"),t.stop()}catch(e){l.warn("stopReceiving() | rtpReceiver.stop() failed:%o",e)}}async getReceiverStats(e){const t=this._rtpReceivers.get(e);if(!t)throw new Error("RTCRtpReceiver not found");return t.getStats()}async receiveDataChannel(e){throw new o.UnsupportedError("not implemented")}_setIceGatherer({iceServers:e,iceTransportPolicy:t}){const r=new RTCIceGatherer({iceServers:e||[],gatherPolicy:t||"all"});r.addEventListener("error",(e=>{l.error('iceGatherer "error" event [event:%o]',e)}));try{r.gather()}catch(e){l.debug("_setIceGatherer() | iceGatherer.gather() failed: %s",e.toString())}this._iceGatherer=r}_setIceTransport(){const e=new RTCIceTransport(this._iceGatherer);e.addEventListener("statechange",(()=>{switch(e.state){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})),e.addEventListener("icestatechange",(()=>{switch(e.state){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})),e.addEventListener("candidatepairchange",(e=>{l.debug('iceTransport "candidatepairchange" event [pair:%o]',e.pair)})),this._iceTransport=e}_setDtlsTransport(){const e=new RTCDtlsTransport(this._iceTransport);e.addEventListener("statechange",(()=>{l.debug('dtlsTransport "statechange" event [state:%s]',e.state)})),e.addEventListener("dtlsstatechange",(()=>{l.debug('dtlsTransport "dtlsstatechange" event [state:%s]',e.state),"closed"===e.state&&this.emit("@connectionstatechange","closed")})),e.addEventListener("error",(e=>{l.error('dtlsTransport "error" event [event:%o]',e)})),this._dtlsTransport=e}async _setupTransport({localDtlsRole:e}){l.debug("_setupTransport()");const t=this._dtlsTransport.getLocalParameters();t.role=e,await this.safeEmitAsPromise("@connect",{dtlsParameters:t}),this._iceTransport.start(this._iceGatherer,this._remoteIceParameters,"controlling");for(const e of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(e);this._iceTransport.addRemoteCandidate({}),this._remoteDtlsParameters.fingerprints=this._remoteDtlsParameters.fingerprints.filter((e=>"sha-256"===e.algorithm||"sha-384"===e.algorithm||"sha-512"===e.algorithm)),this._dtlsTransport.start(this._remoteDtlsParameters),this._transportReady=!0}}t.Edge11=h},function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.hasOwnProperty.call(e,r)&&a(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.mangleRtpParameters=t.getCapabilities=void 0;const s=i(r(6));t.getCapabilities=function(){const e=RTCRtpReceiver.getCapabilities(),t=s.clone(e,{});for(const e of t.codecs){if(e.channels=e.numChannels,delete e.numChannels,e.mimeType=e.mimeType||`${e.kind}/${e.name}`,e.parameters){const t=e.parameters;t.apt&&(t.apt=Number(t.apt)),t["packetization-mode"]&&(t["packetization-mode"]=Number(t["packetization-mode"]))}for(const t of e.rtcpFeedback||[])t.parameter||(t.parameter="")}return t},t.mangleRtpParameters=function(e){const t=s.clone(e,{});t.mid&&(t.muxId=t.mid,delete t.mid);for(const e of t.codecs)e.channels&&(e.numChannels=e.channels,delete e.channels),e.mimeType&&!e.name&&(e.name=e.mimeType.split("/")[1]),delete e.mimeType;return t}},function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.hasOwnProperty.call(e,r)&&a(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.ReactNative=void 0;const s=i(r(9)),o=r(5),c=r(8),d=i(r(6)),p=i(r(7)),u=i(r(13)),l=i(r(22)),h=r(10),m=r(14),f=new o.Logger("ReactNative"),g={OS:1024,MIS:1024};class _ extends h.HandlerInterface{constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdTrack=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}static createFactory(){return()=>new _}get name(){return"ReactNative"}close(){if(f.debug("close()"),this._sendStream.release(),this._pc)try{this._pc.close()}catch(e){}}async getNativeRtpCapabilities(){f.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const t=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch(e){}const r=s.parse(t.sdp);return u.extractRtpCapabilities({sdpObject:r})}catch(t){try{e.close()}catch(e){}throw t}}async getNativeSctpCapabilities(){return f.debug("getNativeSctpCapabilities()"),{numStreams:g}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:i,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:d}){f.debug("run()"),this._direction=e,this._remoteSdp=new m.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,planB:!0}),this._sendingRtpParametersByKind={audio:p.getSendingRtpParameters("audio",d),video:p.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:p.getSendingRemoteRtpParameters("audio",d),video:p.getSendingRemoteRtpParameters("video",d)},this._pc=new RTCPeerConnection(Object.assign({iceServers:i||[],iceTransportPolicy:s||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"},o),c),this._pc.addEventListener("iceconnectionstatechange",(()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}async updateIceServers(e){f.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(f.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});f.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();f.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:a}){this._assertSendDirection(),f.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),a&&f.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addStream(this._sendStream);let n,i=await this._pc.createOffer(),o=s.parse(i.sdp);const c=d.clone(this._sendingRtpParametersByKind[e.kind],{});c.codecs=p.reduceCodecs(c.codecs);const h=d.clone(this._sendingRemoteRtpParametersByKind[e.kind],{});if(h.codecs=p.reduceCodecs(h.codecs),this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:o}),"video"===e.kind&&t&&t.length>1&&(f.debug("send() | enabling simulcast"),o=s.parse(i.sdp),n=o.media.find((e=>"video"===e.type)),l.addLegacySimulcast({offerMediaObject:n,track:e,numStreams:t.length}),i={type:"offer",sdp:s.write(o)}),f.debug("send() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i),o=s.parse(this._pc.localDescription.sdp),n=o.media.find((t=>t.type===e.kind)),c.rtcp.cname=u.getCname({offerMediaObject:n}),c.encodings=l.getRtpEncodings({offerMediaObject:n,track:e}),t)for(let e=0;e<c.encodings.length;++e)t[e]&&Object.assign(c.encodings[e],t[e]);if(c.encodings.length>1&&("video/vp8"===c.codecs[0].mimeType.toLowerCase()||"video/h264"===c.codecs[0].mimeType.toLowerCase()))for(const e of c.encodings)e.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:n,offerRtpParameters:c,answerRtpParameters:h,codecOptions:r});const m={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("send() | calling pc.setRemoteDescription() [answer:%o]",m),await this._pc.setRemoteDescription(m);const g=String(this._nextSendLocalId);return this._nextSendLocalId++,this._mapSendLocalIdTrack.set(g,e),{localId:g,rtpParameters:c}}async stopSending(e){this._assertSendDirection(),f.debug("stopSending() [localId:%s]",e);const t=this._mapSendLocalIdTrack.get(e);if(!t)throw new Error("track not found");this._mapSendLocalIdTrack.delete(e),this._sendStream.removeTrack(t),this._pc.addStream(this._sendStream);const r=await this._pc.createOffer();f.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r);try{await this._pc.setLocalDescription(r)}catch(e){if(0===this._sendStream.getTracks().length)return void f.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.toString());throw e}if("stable"===this._pc.signalingState)return;const a={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async replaceTrack(e,t){throw new c.UnsupportedError("not implemented")}async setMaxSpatialLayer(e,t){throw new c.UnsupportedError("not implemented")}async setRtpEncodingParameters(e,t){throw new c.UnsupportedError("not implemented")}async getSenderStats(e){throw new c.UnsupportedError("not implemented")}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:a,protocol:n}){this._assertSendDirection();const i={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:r,protocol:n};f.debug("sendDataChannel() [options:%o]",i);const o=this._pc.createDataChannel(a,i);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%g.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=s.parse(e.sdp),r=t.media.find((e=>"application"===e.type));this._transportReady||await this._setupTransport({localDtlsRole:"server",localSdpObject:t}),f.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const a={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a),this._hasDataChannelMediaSection=!0}return{dataChannel:o,sctpStreamParameters:{streamId:i.id,ordered:i.ordered,maxPacketLifeTime:i.maxPacketLifeTime,maxRetransmits:i.maxRetransmits}}}async receive({trackId:e,kind:t,rtpParameters:r}){this._assertRecvDirection(),f.debug("receive() [trackId:%s, kind:%s]",e,t);const a=e,n=t;let i=r.rtcp.cname;f.debug("receive() | forcing a random remote streamId to avoid well known bug in react-native-webrtc"),i+=`-hack-${d.generateRandomNumber()}`,this._remoteSdp.receive({mid:n,kind:t,offerRtpParameters:r,streamId:i,trackId:e});const o={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",o),await this._pc.setRemoteDescription(o);let c=await this._pc.createAnswer();const p=s.parse(c.sdp),l=p.media.find((e=>String(e.mid)===n));u.applyCodecParameters({offerRtpParameters:r,answerMediaObject:l}),c={type:"answer",sdp:s.write(p)},this._transportReady||await this._setupTransport({localDtlsRole:"client",localSdpObject:p}),f.debug("receive() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c);const h=this._pc.getRemoteStreams().find((e=>e.id===i)).getTrackById(a);if(!h)throw new Error("remote track not found");return this._mapRecvLocalIdInfo.set(a,{mid:n,rtpParameters:r}),{localId:a,track:h}}async stopReceiving(e){this._assertRecvDirection(),f.debug("stopReceiving() [localId:%s]",e);const{mid:t,rtpParameters:r}=this._mapRecvLocalIdInfo.get(e)||{};this._mapRecvLocalIdInfo.delete(e),this._remoteSdp.planBStopReceiving({mid:t,offerRtpParameters:r});const a={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",a),await this._pc.setRemoteDescription(a);const n=await this._pc.createAnswer();f.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}async getReceiverStats(e){throw new c.UnsupportedError("not implemented")}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this._assertRecvDirection();const{streamId:a,ordered:n,maxPacketLifeTime:i,maxRetransmits:o}=e,c={negotiated:!0,id:a,ordered:n,maxPacketLifeTime:i,maxRetransmitTime:i,maxRetransmits:o,protocol:r};f.debug("receiveDataChannel() [options:%o]",c);const d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const e={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=s.parse(t.sdp);await this._setupTransport({localDtlsRole:"client",localSdpObject:e})}f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async _setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=s.parse(this._pc.localDescription.sdp));const r=u.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await this.safeEmitAsPromise("@connect",{dtlsParameters:r}),this._transportReady=!0}_assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}_assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}t.ReactNative=_},function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(33),t),n(r(34),t),n(r(35),t),n(r(36),t),n(r(37),t),n(r(38),t),n(r(82),t),n(r(83),t),n(r(10),t),n(r(8),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t){e.exports=function(e,t){return t.get?t.get.call(e):t.value},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t){e.exports=function(e,t,r){if(t.set)t.set.call(e,r);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=r}},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){"use strict";r.r(t),r.d(t,"VideoSDK",(function(){return at})),r.d(t,"ZujoSDK",(function(){return nt}));var a=r(3),n=r.n(a),i=r(4),s=r.n(i),o=r(2),c=r.n(o),d=r(25),p=function(){return Math.random().toString(36).substring(7).split("").join(".")},u={INIT:"@@redux/INIT"+p(),REPLACE:"@@redux/REPLACE"+p(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+p()}};function l(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function h(e,t,r){var a;if("function"==typeof t&&"function"==typeof r||"function"==typeof r&&"function"==typeof arguments[3])throw new Error("It looks like you are passing several store enhancers to createStore(). This is not supported. Instead, compose them together to a single function.");if("function"==typeof t&&void 0===r&&(r=t,t=void 0),void 0!==r){if("function"!=typeof r)throw new Error("Expected the enhancer to be a function.");return r(h)(e,t)}if("function"!=typeof e)throw new Error("Expected the reducer to be a function.");var n=e,i=t,s=[],o=s,c=!1;function p(){o===s&&(o=s.slice())}function m(){if(c)throw new Error("You may not call store.getState() while the reducer is executing. The reducer has already received the state as an argument. Pass it down from the top reducer instead of reading it from the store.");return i}function f(e){if("function"!=typeof e)throw new Error("Expected the listener to be a function.");if(c)throw new Error("You may not call store.subscribe() while the reducer is executing. If you would like to be notified after the store has been updated, subscribe from a component and invoke store.getState() in the callback to access the latest state. See https://redux.js.org/api-reference/store#subscribelistener for more details.");var t=!0;return p(),o.push(e),function(){if(t){if(c)throw new Error("You may not unsubscribe from a store listener while the reducer is executing. See https://redux.js.org/api-reference/store#subscribelistener for more details.");t=!1,p();var r=o.indexOf(e);o.splice(r,1),s=null}}}function g(e){if(!l(e))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if(void 0===e.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(c)throw new Error("Reducers may not dispatch actions.");try{c=!0,i=n(i,e)}finally{c=!1}for(var t=s=o,r=0;r<t.length;r++){(0,t[r])()}return e}function _(e){if("function"!=typeof e)throw new Error("Expected the nextReducer to be a function.");n=e,g({type:u.REPLACE})}function v(){var e,t=f;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw new TypeError("Expected the observer to be an object.");function r(){e.next&&e.next(m())}return r(),{unsubscribe:t(r)}}})[d.a]=function(){return this},e}return g({type:u.INIT}),(a={dispatch:g,subscribe:f,getState:m,replaceReducer:_})[d.a]=v,a}function m(e,t){var r=t&&t.type;return"Given "+(r&&'action "'+String(r)+'"'||"an action")+', reducer "'+e+'" returned undefined. To ignore an action, you must explicitly return the previous state. If you want this reducer to hold no value, you can return null instead of undefined.'}function f(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function g(e,t){var r=Object.keys(e);return Object.getOwnPropertySymbols&&r.push.apply(r,Object.getOwnPropertySymbols(e)),t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r}function _(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?g(r,!0).forEach((function(t){f(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function v(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce((function(e,t){return function(){return e(t.apply(void 0,arguments))}}))}function b(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e){return function(){var r=e.apply(void 0,arguments),a=function(){throw new Error("Dispatching while constructing your middleware is not allowed. Other middleware would not be applied to this dispatch.")},n={getState:r.getState,dispatch:function(){return a.apply(void 0,arguments)}},i=t.map((function(e){return e(n)}));return _({},r,{dispatch:a=v.apply(void 0,i)(r.dispatch)})}}}function y(e){return function(t){var r=t.dispatch,a=t.getState;return function(t){return function(n){return"function"==typeof n?n(r,a,e):t(n)}}}}var w=y();w.withExtraArgument=y;var S=w,P=r(18),R=r.n(P);function C(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function k(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?C(Object(r),!0).forEach((function(t){c()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):C(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var E={url:null,state:"new",activeSpeakerId:null,statsPeerId:null,faceDetection:!1},T=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:E,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_ROOM_URL":var r=t.payload.url;return k(k({},e),{},{url:r});case"SET_ROOM_STATE":var a=t.payload.state;return k(k({},e),{},"connected"===a?{state:a}:{state:a,activeSpeakerId:null,statsPeerId:null});case"SET_ROOM_ACTIVE_SPEAKER":var n=t.payload.peerId;return k(k({},e),{},{activeSpeakerId:n});case"SET_ROOM_STATS_PEER_ID":var i=t.payload.peerId;return e.statsPeerId===i?k(k({},e),{},{statsPeerId:null}):k(k({},e),{},{statsPeerId:i});case"SET_FACE_DETECTION":var s=t.payload;return k(k({},e),{},{faceDetection:s});case"REMOVE_PEER":var o=t.payload.peerId,c=k({},e);return o&&o===e.activeSpeakerId&&(c.activeSpeakerId=null),o&&o===e.statsPeerId&&(c.statsPeerId=null),c;default:return e}};function x(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function O(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?x(Object(r),!0).forEach((function(t){c()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):x(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var D={id:null,displayName:null,displayNameSet:!1,device:null,canSendMic:!1,canSendWebcam:!1,canChangeWebcam:!1,webcamInProgress:!1,shareInProgress:!1,audioOnly:!1,audioOnlyInProgress:!1,audioMuted:!1,restartIceInProgress:!1},I=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_ROOM_STATE":var r=t.payload.state;return"closed"===r?O(O({},e),{},{webcamInProgress:!1,shareInProgress:!1,audioOnly:!1,audioOnlyInProgress:!1,audioMuted:!1,restartIceInProgress:!1}):e;case"SET_ME":var a=t.payload,n=a.peerId,i=a.displayName,s=a.displayNameSet,o=a.device;return O(O({},e),{},{id:n,displayName:i,displayNameSet:s,device:o});case"SET_MEDIA_CAPABILITIES":var c=t.payload,d=c.canSendMic,p=c.canSendWebcam;return O(O({},e),{},{canSendMic:d,canSendWebcam:p});case"SET_CAN_CHANGE_WEBCAM":var u=t.payload;return O(O({},e),{},{canChangeWebcam:u});case"SET_WEBCAM_IN_PROGRESS":var l=t.payload.flag;return O(O({},e),{},{webcamInProgress:l});case"SET_SHARE_IN_PROGRESS":var h=t.payload.flag;return O(O({},e),{},{shareInProgress:h});case"SET_DISPLAY_NAME":var m=t.payload.displayName;return m||(m=e.displayName),O(O({},e),{},{displayName:m,displayNameSet:!0});case"SET_AUDIO_ONLY_STATE":var f=t.payload.enabled;return O(O({},e),{},{audioOnly:f});case"SET_AUDIO_ONLY_IN_PROGRESS":var g=t.payload.flag;return O(O({},e),{},{audioOnlyInProgress:g});case"SET_AUDIO_MUTED_STATE":var _=t.payload.enabled;return O(O({},e),{},{audioMuted:_});case"SET_RESTART_ICE_IN_PROGRESS":var v=t.payload.flag;return O(O({},e),{},{restartIceInProgress:v});default:return e}};function M(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function j(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?M(Object(r),!0).forEach((function(t){c()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):M(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var L={},A=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:L,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_ROOM_STATE":var r=t.payload.state;return"closed"===r?{}:e;case"ADD_PRODUCER":var a=t.payload.producer;return j(j({},e),{},c()({},a.id,a));case"REMOVE_PRODUCER":var n=t.payload.producerId,i=j({},e);return delete i[n],i;case"SET_PRODUCER_PAUSED":var s=t.payload.producerId,o=e[s],d=j(j({},o),{},{paused:!0});return j(j({},e),{},c()({},s,d));case"SET_PRODUCER_RESUMED":var p=t.payload.producerId,u=e[p],l=j(j({},u),{},{paused:!1});return j(j({},e),{},c()({},p,l));case"SET_PRODUCER_TRACK":var h=t.payload,m=h.producerId,f=h.track,g=e[m],_=j(j({},g),{},{track:f});return j(j({},e),{},c()({},m,_));case"SET_PRODUCER_SCORE":var v=t.payload,b=v.producerId,y=v.score,w=e[b];if(!w)return e;var S=j(j({},w),{},{score:y});return j(j({},e),{},c()({},b,S));default:return e}};function N(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function F(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?N(Object(r),!0).forEach((function(t){c()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):N(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var B={},V=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_ROOM_STATE":var r=t.payload.state;return"closed"===r?{}:e;case"ADD_DATA_PRODUCER":var a=t.payload.dataProducer;return F(F({},e),{},c()({},a.id,a));case"REMOVE_DATA_PRODUCER":var n=t.payload.dataProducerId,i=F({},e);return delete i[n],i;default:return e}},W=r(16),U=r.n(W);function q(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function G(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?q(Object(r),!0).forEach((function(t){c()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):q(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var z={};function $(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function K(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?$(Object(r),!0).forEach((function(t){c()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var H={};function Q(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function J(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Q(Object(r),!0).forEach((function(t){c()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Q(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Y={},Z=[],X=function(e){for(var t=Object.keys(e),r={},a=0;a<t.length;a++){var n=t[a];0,"function"==typeof e[n]&&(r[n]=e[n])}var i,s=Object.keys(r);try{!function(e){Object.keys(e).forEach((function(t){var r=e[t];if(void 0===r(void 0,{type:u.INIT}))throw new Error('Reducer "'+t+"\" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined. If you don't want to set a value for this reducer, you can use null instead of undefined.");if(void 0===r(void 0,{type:u.PROBE_UNKNOWN_ACTION()}))throw new Error('Reducer "'+t+"\" returned undefined when probed with a random type. Don't try to handle "+u.INIT+' or other actions in "redux/*" namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined, but can be null.')}))}(r)}catch(e){i=e}return function(e,t){if(void 0===e&&(e={}),i)throw i;for(var a=!1,n={},o=0;o<s.length;o++){var c=s[o],d=r[c],p=e[c],u=d(p,t);if(void 0===u){var l=m(c,t);throw new Error(l)}n[c]=u,a=a||u!==p}return(a=a||s.length!==Object.keys(e).length)?n:e}}({room:T,me:I,producers:A,dataProducers:V,peers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:z,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_ROOM_STATE":var r=t.payload.state;return"closed"===r?{}:e;case"ADD_PEER":var a=t.payload.peer;return G(G({},e),{},c()({},a.id,a));case"REMOVE_PEER":var n=t.payload.peerId,i=G({},e);return delete i[n],i;case"SET_PEER_DISPLAY_NAME":var s=t.payload,o=s.displayName,d=s.peerId,p=e[d];if(!p)throw new Error("no Peer found");var u=G(G({},p),{},{displayName:o});return G(G({},e),{},c()({},u.id,u));case"ADD_CONSUMER":var l=t.payload,h=l.consumer,m=l.peerId,f=e[m];if(!f)throw new Error("no Peer found for new Consumer");var g=[].concat(U()(f.consumers),[h.id]),_=G(G({},f),{},{consumers:g});return G(G({},e),{},c()({},_.id,_));case"REMOVE_CONSUMER":var v=t.payload,b=v.consumerId,y=v.peerId,w=e[y];if(!w)return e;var S=w.consumers.indexOf(b);if(-1===S)throw new Error("Consumer not found");var P=w.consumers.slice();P.splice(S,1);var R=G(G({},w),{},{consumers:P});return G(G({},e),{},c()({},R.id,R));case"ADD_DATA_CONSUMER":var C=t.payload,k=C.dataConsumer,E=C.peerId;if(!E)return e;var T=e[E];if(!T)throw new Error("no Peer found for new DataConsumer");var x=[].concat(U()(T.dataConsumers),[k.id]),O=G(G({},T),{},{dataConsumers:x});return G(G({},e),{},c()({},O.id,O));case"REMOVE_DATA_CONSUMER":var D=t.payload,I=D.dataConsumerId,M=D.peerId;if(!M)return e;var j=e[M];if(!j)return e;var L=j.dataConsumers.indexOf(I);if(-1===L)throw new Error("DataConsumer not found");var A=j.dataConsumers.slice();A.splice(L,1);var N=G(G({},j),{},{dataConsumers:A});return G(G({},e),{},c()({},N.id,N));default:return e}},consumers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:H,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_ROOM_STATE":var r=t.payload.state;return"closed"===r?{}:e;case"ADD_CONSUMER":var a=t.payload.consumer;return K(K({},e),{},c()({},a.id,a));case"REMOVE_CONSUMER":var n=t.payload.consumerId,i=K({},e);return delete i[n],i;case"SET_CONSUMER_PAUSED":var s,o=t.payload,d=o.consumerId,p=o.originator,u=e[d];return s=K(K({},u),{},"local"===p?{locallyPaused:!0}:{remotelyPaused:!0}),K(K({},e),{},c()({},d,s));case"SET_CONSUMER_RESUMED":var l,h=t.payload,m=h.consumerId,f=h.originator,g=e[m];return l=K(K({},g),{},"local"===f?{locallyPaused:!1}:{remotelyPaused:!1}),K(K({},e),{},c()({},m,l));case"SET_CONSUMER_CURRENT_LAYERS":var _=t.payload,v=_.consumerId,b=_.spatialLayer,y=_.temporalLayer,w=e[v],S=K(K({},w),{},{currentSpatialLayer:b,currentTemporalLayer:y});return K(K({},e),{},c()({},v,S));case"SET_CONSUMER_PREFERRED_LAYERS":var P=t.payload,R=P.consumerId,C=P.spatialLayer,k=P.temporalLayer,E=e[R],T=K(K({},E),{},{preferredSpatialLayer:C,preferredTemporalLayer:k});return K(K({},e),{},c()({},R,T));case"SET_CONSUMER_PRIORITY":var x=t.payload,O=x.consumerId,D=x.priority,I=e[O],M=K(K({},I),{},{priority:D});return K(K({},e),{},c()({},O,M));case"SET_CONSUMER_TRACK":var j=t.payload,L=j.consumerId,A=j.track,N=e[L],F=K(K({},N),{},{track:A});return K(K({},e),{},c()({},L,F));case"SET_CONSUMER_SCORE":var B=t.payload,V=B.consumerId,W=B.score,U=e[V];if(!U)return e;var q=K(K({},U),{},{score:W});return K(K({},e),{},c()({},V,q));default:return e}},dataConsumers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Y,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_ROOM_STATE":var r=t.payload.state;return"closed"===r?{}:e;case"ADD_DATA_CONSUMER":var a=t.payload.dataConsumer;return J(J({},e),{},c()({},a.id,a));case"REMOVE_DATA_CONSUMER":var n=t.payload.dataConsumerId,i=J({},e);return delete i[n],i;default:return e}},notifications:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Z,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ADD_NOTIFICATION":var r=t.payload.notification;return[].concat(U()(e),[r]);case"REMOVE_NOTIFICATION":var a=t.payload.notificationId;return e.filter((function(e){return e.id!==a}));case"REMOVE_ALL_NOTIFICATIONS":return[];default:return e}}}),ee=r(17),te=r(23),re=r.n(te);window.BOWSER=re.a;var ae=r(42),ne=r.n(ae),ie=r(1),se=r.n(ie),oe=r(0),ce=r.n(oe),de=r(11),pe=(r(17).default,function e(){n()(this,e),this.roomClient=null}),ue=new(function(){function e(){n()(this,e),e.instance||(e.instance=new pe)}return s()(e,[{key:"getInstance",value:function(){return e.instance}}]),e}());Object.freeze(ue);var le=ue.getInstance(),he="stream-enabled",me="stream-disabled",fe=function(){function e(t){n()(this,e),this.id=t.id,this.displayName=t.displayName,this.streams=new Map,this.quality="low",this.local=t.local||!1,this.pinState={cam:!1,share:!1},this.eventEmitter=new de.EventEmitter}var t;return s()(e,[{key:"_setPinState",value:function(e){null!=e.cam&&(this.pinState.cam=e.cam),null!=e.share&&(this.pinState.share=e.share)}},{key:"remove",value:function(){le.roomClient.removePeer(this.id)}},{key:"enableMic",value:function(){le.roomClient.enablePeerMic(this.id)}},{key:"disableMic",value:function(){le.roomClient.disablePeerMic(this.id)}},{key:"enableWebcam",value:function(){le.roomClient.enablePeerWebcam(this.id)}},{key:"disableWebcam",value:function(){le.roomClient.disablePeerWebcam(this.id)}},{key:"addStream",value:function(e){this.streams.set(e.id,e),"video"!==e.kind||this.local||le.roomClient.setConsumerQuality(e.id,this.quality),this.eventEmitter.emit(he,e)}},{key:"deleteStream",value:function(e){var t=this.streams.get(e);if(null!=t)return this.streams.delete(e),this.eventEmitter.emit(me,t),t}},{key:"setQuality",value:function(e){this.quality===e||this.local||(this.quality=e,U()(this.streams.entries()).forEach((function(t){var r=t[1];"video"===r.kind&&le.roomClient.setConsumerQuality(r.id,e)})))}},{key:"pin",value:function(e){switch(e){case"SHARE_AND_CAM":case void 0:this._setPinState({cam:!0,share:!0});break;case"CAM":this._setPinState({cam:!0});break;case"SHARE":this._setPinState({share:!0});break;default:throw new Error("Unknown pin type")}le.roomClient.pinStateChange({peerId:this.id,state:this.pinState})}},{key:"unpin",value:function(e){switch(e){case"SHARE_AND_CAM":case void 0:this._setPinState({cam:!1,share:!1});break;case"CAM":this._setPinState({cam:!1});break;case"SHARE":this._setPinState({share:!1});break;default:throw new Error("Unknown unpin type")}le.roomClient.pinStateChange({peerId:this.id,state:this.pinState})}},{key:"switchTo",value:(t=se()(ce.a.mark((function e(t){var r,a,n;return ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.meetingId,a=t.payload,n=t.token,e.next=3,le.roomClient.switchPeerRoom({peerId:this.id,roomId:r,payload:a,token:n});case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"on",value:function(e,t){switch(e){case he:case me:this.eventEmitter.on(e,t);break;default:throw new Error("Invalid event type")}}},{key:"off",value:function(e,t){switch(e){case he:case me:this.eventEmitter.off(e,t);break;default:throw new Error("Invalid event type")}}}]),e}(),ge=function(){function e(t){n()(this,e),this.id=t.id,this.kind=t.track.kind,this.codec=t.codec,this.track=t.track,this.producerOrConsumer=t.instance,t.appData&&!0===t.appData.share&&(this.kind="share")}return s()(e,[{key:"pause",value:function(){le.roomClient._pauseConsumer(this.producerOrConsumer)}},{key:"resume",value:function(){le.roomClient._resumeConsumer(this.producerOrConsumer)}},{key:"paused",get:function(){return this.producerOrConsumer.paused}}]),e}(),_e=r(43),ve=r.n(_e),be=r(44),ye=r.n(be),we=new WeakMap,Se=function(){function e(t,r){var a=t.id,i=t.displayName;n()(this,e),we.set(this,{writable:!0,value:void 0}),this.id=a,this.displayName=i,ye()(this,we,r)}var t;return s()(e,[{key:"switchTo",value:(t=se()(ce.a.mark((function e(t){var r,a,n;return ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.meetingId,a=t.payload,n=t.token,e.next=3,le.roomClient.connectionSwitchPeerRoom({roomId:r,connectionRoomId:ve()(this,we),payload:a,peerId:this.id,token:n});case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}(),Pe="participant-joined",Re="participant-left",Ce="chat-message",ke=function(){function e(t,r){var a=this;n()(this,e),this.eventEmitter=new de.EventEmitter,this.id=t,this.participants=new Map,r.forEach((function(e){a.participants.set(e.id,new Se(e,a.id))}))}var t;return s()(e,[{key:"participantJoin",value:function(e){var t=new Se(e,this.id);this.participants.set(e.id,t),this.eventEmitter.emit(Pe,t)}},{key:"participantLeft",value:function(e){this.participants.delete(e),this.eventEmitter.emit(Re,e)}},{key:"sendChatMessage",value:function(e){le.roomClient.connectionSendChatMessage({roomId:this.id,message:e})}},{key:"sendChatMessageEvent",value:function(e){var t=e.participantId,r=e.message;this.eventEmitter.emit(Ce,{participantId:t,message:r})}},{key:"end",value:(t=se()(ce.a.mark((function e(){return ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,le.roomClient.connectionEndMeeting({roomId:this.id});case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"on",value:function(e,t){switch(e){case Pe:case Re:case Ce:this.eventEmitter.on(e,t);break;default:throw new Error("Invalid event type")}}},{key:"off",value:function(e,t){switch(e){case Pe:case Re:case Ce:this.eventEmitter.off(e,t);break;default:throw new Error("Invalid event type")}}}]),e}(),Ee=function(){function e(t){var r=t.roomId,a=t.peers,i=t.payload;n()(this,e),this.id=r,this.payload=i,this.meeting=new ke(r,a)}return s()(e,[{key:"close",value:function(){le.roomClient.closeConnection(this.id)}}]),e}(),Te="error",xe="meeting-joined",Oe="meeting-left",De="participant-joined",Ie="participant-left",Me="speaker-changed",je="presenter-changed",Le="main-participant-changed",Ae="chat-message",Ne="entry-requested",Fe="entry-responded",Be="recording-started",Ve="recording-stopped",We="livestream-started",Ue="livestream-stopped",qe="whiteboard-started",Ge="whiteboard-stopped",ze="video-state-changed",$e="video-seeked",Ke="mic-requested",He="webcam-requested",Qe="stream-enabled",Je="stream-disabled",Ye="pin-state-changed",Ze="connection-open",Xe="connection-close",et="switch-meeting",tt=function(){function e(t,r,a){var i=this;n()(this,e),this.id=t,this.roomClient=a,this.activeSpeakerId=null,this.activePresenterId=null,this.mainParticipantId=null,this.connections=new Map,this.localParticipant=r,this.participants=new Map,this.messages=[],this.eventEmitter=new de.EventEmitter,this.roomClient.on("ERROR",(function(e){return i.handleError(e)})),this.roomClient.on("ADD_PEER",(function(e){return i.handlePeerAdd(e)})),this.roomClient.on("REMOVE_PEER",(function(e){return i.handlePeerRemove(e)})),this.roomClient.on("ADD_PRODUCER",(function(e){return i.handleProducerAdd(e)})),this.roomClient.on("REMOVE_PRODUCER",(function(e){return i.handleProducerRemove(e)})),this.roomClient.on("ADD_CONSUMER",(function(e){return i.handleConsumerAdd(e)})),this.roomClient.on("REMOVE_CONSUMER",(function(e){return i.handleConsumerRemove(e)})),this.roomClient.on("CHAT_MESSAGE",(function(e){return i.handleNewChatMessage(e)})),this.roomClient.on("SET_ROOM_ACTIVE_SPEAKER",(function(e){return i.handleSpeakerChange(e)})),this.roomClient.on("ENTRY_REQUESTED",(function(e){return i.handleEntryRequested(e)})),this.roomClient.on("ENTRY_RESPONDED",(function(e){return i.handleEntryResponded(e)})),this.roomClient.on("MEETING_JOINED",(function(e){return i.handleMeetingJoined(e)})),this.roomClient.on("MEETING_LEFT",(function(e){return i.handleMeetingLeft(e)})),this.roomClient.on("RECORDING_STARTED",(function(e){return i.handleRecordingStarted(e)})),this.roomClient.on("RECORDING_STOPPED",(function(e){return i.handleRecordingStopped(e)})),this.roomClient.on("LIVESTREAM_STARTED",(function(e){return i.handleLivestreamStarted(e)})),this.roomClient.on("LIVESTREAM_STOPPED",(function(e){return i.handleLivestreamStopped(e)})),this.roomClient.on("WHITEBOARD_STARTED",(function(e){return i.handleWhiteboardStarted(e)})),this.roomClient.on("WHITEBOARD_STOPPED",(function(e){return i.handleWhiteboardStopped(e)})),this.roomClient.on("VIDEO_STATE_CHANGED",(function(e){return i.handleVideoStateChanged(e)})),this.roomClient.on("VIDEO_SEEKED",(function(e){return i.handleVideoSeeked(e)})),this.roomClient.on("PIN_STATE_CHANGED",(function(e){i.handlePinStateChanged(e)})),this.roomClient.on("MIC_REQUESTED",(function(e){return i.handleMicRequested(e)})),this.roomClient.on("WEBCAM_REQUESTED",(function(e){return i.handleWebcamRequested(e)})),this.roomClient.on("CONNECTION_OPEN",(function(e){return i.handleConnectionOpen(e)})),this.roomClient.on("CONNECTION_CLOSE",(function(e){return i.handleConnectionClose(e)})),this.roomClient.on("CONNECTION_PARTICIPANT_JOIN",(function(e){return i.handleConnectionParticipantJoin(e)})),this.roomClient.on("SWITCH_ROOM",(function(e){return i.handleSwitchMeeting(e)})),this.roomClient.on("CONNECTION_CHAT_MESSAGE",(function(e){return i.handleConnectionChatMessage(e)})),this.roomClient.on("CONNECTION_PARTICIPANT_LEFT",(function(e){i.handleConnectionParticipantLeft(e)})),this.updateMainParticipant(this.localParticipant.id)}var t,r,a;return s()(e,[{key:"handleError",value:function(e){this.eventEmitter.emit(Te,e)}},{key:"join",value:function(){this.roomClient.join()}},{key:"leave",value:function(){this.roomClient.close()}},{key:"end",value:function(){this.roomClient.closeRoom()}},{key:"respondEntry",value:function(e,t){this.roomClient.respondEntry(e,t)}},{key:"pinnedParticipants",get:function(){return this.roomClient._pinnedParticipants}},{key:"muteMic",value:function(){this.roomClient.disableMic()}},{key:"unmuteMic",value:function(){this.roomClient.enableMic()}},{key:"disableWebcam",value:function(){this.roomClient.disableWebcam()}},{key:"enableWebcam",value:function(){this.roomClient.enableWebcam()}},{key:"disableScreenShare",value:function(){this.roomClient.disableShare()}},{key:"enableScreenShare",value:function(){this.roomClient.enableShare()}},{key:"sendChatMessage",value:function(e){this.roomClient.sendChatMessage(e);var t={text:e,timestamp:(new Date).getTime(),senderId:this.localParticipant.id,senderName:this.localParticipant.displayName};this.handleNewChatMessage(t)}},{key:"startRecording",value:function(e,t,r){this.roomClient.startRecording(e,t,r)}},{key:"stopRecording",value:function(){this.roomClient.stopRecording()}},{key:"startLivestream",value:function(e){this.roomClient.startLivestream(e)}},{key:"stopLivestream",value:function(){this.roomClient.stopLivestream()}},{key:"getMics",value:(a=se()(ce.a.mark((function e(){return ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.roomClient.getMics();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"getWebcams",value:(r=se()(ce.a.mark((function e(){return ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.roomClient.getWebcams();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"changeMic",value:function(e){this.roomClient.changeMic(e)}},{key:"changeWebcam",value:function(e){this.roomClient.changeWebcam(e)}},{key:"setWebcamQuality",value:function(e){this.roomClient.setWebcamQuality(e)}},{key:"startWhiteboard",value:function(){this.roomClient.startWhiteboard()}},{key:"stopWhiteboard",value:function(){this.roomClient.stopWhiteboard()}},{key:"startVideo",value:function(e){var t=e.link;this.roomClient.startVideo({link:t})}},{key:"stopVideo",value:function(){this.roomClient.stopVideo()}},{key:"resumeVideo",value:function(){this.roomClient.resumeVideo()}},{key:"pauseVideo",value:function(e){var t=e.currentTime;this.roomClient.pauseVideo(t)}},{key:"seekVideo",value:function(e){var t=e.currentTime;this.roomClient.seekVideo(t)}},{key:"handlePeerAdd",value:function(e){var t=e.peer,r=new fe(t);this.participants.set(r.id,r),this.eventEmitter.emit(De,r),1===this.participants.size&&this.updateMainParticipant(r.id)}},{key:"handlePeerRemove",value:function(e){var t=e.peerId,r=this.participants.get(t);null!=r&&(this.participants.delete(t),this.eventEmitter.emit(Ie,r),this.activePresenterId===r.id&&(this.activePresenterId=null,this.eventEmitter.emit(je,this.activePresenterId)),this.mainParticipantId===r.id&&(this.participants.size>0?this.updateMainParticipant(this.participants.entries().next().value[1].id):this.updateMainParticipant(this.localParticipant.id)))}},{key:"handleProducerAdd",value:function(e){var t=e.producer,r=new ge(t);this.localParticipant.addStream(r),"share"===r.kind&&(this.activePresenterId=this.localParticipant.id,this.eventEmitter.emit(je,this.activePresenterId),this.updateMainParticipant(this.localParticipant.id))}},{key:"handleProducerRemove",value:function(e){var t=e.producerId,r=this.localParticipant.deleteStream(t);if(r&&"share"===r.kind){this.activePresenterId=null,this.eventEmitter.emit(je,this.activePresenterId);var a=this.participants.size>0?this.participants.entries().next().value[1].id:null;this.updateMainParticipant(this.activeSpeakerId||a||this.localParticipant.id)}}},{key:"handleConsumerAdd",value:function(e){var t=e.consumer,r=e.peerId,a=this.participants.get(r);if(a){var n=new ge(t);a.addStream(n),this.eventEmitter.emit(Qe,n),"share"===n.kind&&(this.activePresenterId=a.id,this.eventEmitter.emit(je,this.activePresenterId),this.updateMainParticipant(a.id))}}},{key:"handleConsumerRemove",value:function(e){var t=e.consumerId,r=e.peerId,a=this.participants.get(r);if(null!=a&&a){var n=a.deleteStream(t);if(this.eventEmitter.emit(Je,n),n&&"share"===n.kind){this.activePresenterId=null,this.eventEmitter.emit(je,this.activePresenterId);var i=this.participants.size>0?this.participants.entries().next().value[1].id:null;this.updateMainParticipant(this.activeSpeakerId||i||this.localParticipant.id)}}}},{key:"handleSpeakerChange",value:function(e){var t=e.peerId;this.activeSpeakerId!==t&&(this.activeSpeakerId=t,this.eventEmitter.emit(Me,t),t&&t!==this.localParticipant.id&&this.activePresenterId!==this.mainParticipantId&&t!==this.mainParticipantId&&this.updateMainParticipant(t))}},{key:"handleNewChatMessage",value:function(e){var t=e.senderId,r={senderId:t,text:e.text,timestamp:e.timestamp};if(this.localParticipant.id===t)r.senderName=this.localParticipant.displayName;else{var a=this.participants.get(t);a&&(r.senderName=a.displayName)}this.messages.push(r),this.eventEmitter.emit(Ae,r)}},{key:"updateMainParticipant",value:function(e){this.mainParticipantId=e;var t=null;t=e===this.localParticipant.id?this.localParticipant:this.participants.get(this.mainParticipantId),this.eventEmitter.emit(Le,t)}},{key:"handleEntryRequested",value:function(e){var t=this,r=e.id,a=e.name;this.eventEmitter.emit(Ne,{participantId:r,name:a,allow:function(){t.roomClient.respondEntry(r,"allowed")},deny:function(){t.roomClient.respondEntry(r,"denied")}})}},{key:"handleEntryResponded",value:function(e){var t=e.id,r=e.decision;this.eventEmitter.emit(Fe,t,r)}},{key:"handleMeetingJoined",value:function(e){var t=e.peers,r=e.poll,a=e.messages;a.length>0&&(this.messages=a),this.eventEmitter.emit(xe,{peers:t,poll:r,messages:a})}},{key:"handleMeetingLeft",value:function(e){this.eventEmitter.emit(Oe,e)}},{key:"handleRecordingStarted",value:function(){this.eventEmitter.emit(Be)}},{key:"handleRecordingStopped",value:function(){this.eventEmitter.emit(Ve)}},{key:"handleLivestreamStarted",value:function(){this.eventEmitter.emit(We)}},{key:"handleLivestreamStopped",value:function(){this.eventEmitter.emit(Ue)}},{key:"handleWhiteboardStarted",value:function(e){var t=e.state;this.eventEmitter.emit(qe,t)}},{key:"handleWhiteboardStopped",value:function(e){ne()(e),this.eventEmitter.emit(Ge)}},{key:"handleVideoStateChanged",value:function(e){this.eventEmitter.emit(ze,e)}},{key:"handleVideoSeeked",value:function(e){var t=e.currentTime;this.eventEmitter.emit($e,{currentTime:t})}},{key:"handlePinStateChanged",value:function(e){var t=e.peerId,r=e.state,a=e.pinnedBy;this.eventEmitter.emit(Ye,{participantId:t,state:r,pinnedBy:a})}},{key:"handleMicRequested",value:function(e){var t=this,r=e.peerId;this.eventEmitter.emit(Ke,{participantId:r,accept:function(){return t.unmuteMic()},reject:function(){}})}},{key:"handleWebcamRequested",value:function(e){var t=this,r=e.peerId;this.eventEmitter.emit(He,{participantId:r,accept:function(){return t.enableWebcam()},reject:function(){}})}},{key:"handleConnectionParticipantJoin",value:function(e){var t=e.roomId,r=e.peer,a=this.connections.get(t);null!=a&&a.meeting.participantJoin(r)}},{key:"handleConnectionParticipantLeft",value:function(e){var t=e.roomId,r=e.peerId,a=this.connections.get(t);null!=a&&a.meeting.participantLeft(r)}},{key:"handleConnectionOpen",value:function(e){var t=e.peers,r=e.roomId,a=e.payload,n=new Ee({roomId:r,peers:t,payload:a});this.connections.set(n.id,n),this.eventEmitter.emit(Ze,n)}},{key:"handleConnectionClose",value:function(e){var t=e.roomId;null!=this.connections.get(t)&&(this.connections.delete(t),this.eventEmitter.emit(Xe,t))}},{key:"handleSwitchMeeting",value:function(e){var t=e.roomId,r=e.token,a=e.payload,n=e.peerId,i=e.connectionPeerId,s=e.connectionRoomId,o=n?{meetingId:t,payload:a,token:r,participantId:n}:{meetingId:t,payload:a,token:r,connectionParticipantId:i,connectionMeetingId:s};this.eventEmitter.emit(et,o)}},{key:"handleConnectionChatMessage",value:function(e){var t=e.roomId,r=e.peerId,a=e.message,n=this.connections.get(t);null!=n&&n.meeting.sendChatMessageEvent({participantId:r,message:a})}},{key:"connectTo",value:(t=se()(ce.a.mark((function e(t){var r,a;return ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.meetingId,a=t.payload,e.next=3,this.roomClient.openConnection({roomId:r,payload:a});case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"on",value:function(e,t){switch(e){case De:case Ie:case Me:case je:case Le:case Ae:case Ne:case Fe:case Be:case Ve:case We:case Ue:case Qe:case Je:case qe:case Ge:case xe:case Oe:case ze:case $e:case Ke:case He:case Ye:case Ze:case Xe:case et:case Te:this.eventEmitter.on(e,t);break;default:throw new Error("Invalid event type")}}},{key:"off",value:function(e,t){switch(e){case De:case Ie:case Me:case je:case Le:case Ae:case Ne:case Fe:case Be:case Ve:case We:case Ue:case Qe:case Je:case qe:case Ge:case xe:case Oe:case ze:case $e:case Ke:case He:case Ye:case Ze:case Xe:case et:this.eventEmitter.off(e,t);break;default:throw new Error("Invalid event type")}}}]),e}(),rt=[S],at=function(){function e(){n()(this,e)}return s()(e,null,[{key:"config",value:function(e){if(!e)throw new Error("'token' is empty, please provide it in config");this.apiKey=e;var t=h(X,void 0,b.apply(void 0,rt));window.STORE=t,ee.default.init({store:t})}},{key:"initMeeting",value:function(e){var t=e.participantId,r=e.meetingId,a=e.name,n=e.micEnabled,i=e.webcamEnabled,s=e.maxResolution,o=e.chatEnabled;if(!r)throw new Error("'meetingId' is empty, please verify it or generate new meetingId using the API.");var c=t||R()({length:8}).toLowerCase(),d=a||R()({length:6}).toLowerCase(),p=new ee.default({roomId:r,peerId:c,secret:this.apiKey,device:"unknown",displayName:d,produce:!0,consume:!0,useSimulcast:!0,useSharingSimulcast:!0,datachannel:!1!==o,micEnabled:!1!==n,webcamEnabled:!1!==i,maxResolution:s||"hd"});le.roomClient=p;var u=new fe({id:c,displayName:d,local:!0});return new tt(r,u,p)}}]),e}();c()(at,"Constants",{errors:{INVALID_TOKEN:4002,INVALID_API_KEY:4001,INVALID_PERMISSIONS:4008,INVALID_MEETING_ID:4003,INVALID_PARTICIPANT_ID:4004,DUPLICATE_PARTICIPANT:4005,ACCOUNT_DEACTIVATED:4006,ACCOUNT_DISCONTINUED:4007,START_RECORDING_FAILED:4011,STOP_RECORDING_FAILED:4012,START_LIVESTREAM_FAILED:4013,STOP_LIVESTREAM_FAILED:4014,INVALID_LIVESTREAM_CONFIG:4015,RECORDING_FAILED:5001,LIVESTREAM_FAILED:5002}});var nt=at}])}));